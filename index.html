<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أذكار القرآن الكريم - Complete Islamic Resources</title>

    <!-- PWA -->
    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#27ae60">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="أذكار">

    <!-- Google Fonts for Arabic -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&family=Scheherazade+New:wght@400;500;600;700&family=Noto+Naskh+Arabic:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Celestial Night Sky Palette */
            --night-deep: #0a0e1a;
            --night-mid: #121a2e;
            --night-soft: #1a2540;
            --night-glow: #243156;

            /* Sacred Green Palette */
            --gold-bright: #2ecc71;
            --gold-warm: #27ae60;
            --gold-soft: #a8e6cf;
            --gold-glow: rgba(46, 204, 113, 0.3);

            /* Spiritual Accents */
            --emerald: #1a5c3a;
            --emerald-soft: #27ae60;
            --cream: #faf6ed;
            --cream-soft: #f5f0e3;
            --ivory: #fffef9;

            /* Text Colors */
            --text-light: #e8e4dc;
            --text-muted: #a8a298;
            --text-gold: #2ecc71;
            --text-dark: #1a1a1a;

            /* Shadows & Glows */
            --glow-gold: 0 0 20px rgba(46, 204, 113, 0.4);
            --glow-soft: 0 0 40px rgba(46, 204, 113, 0.2);
            --shadow-deep: 0 10px 40px rgba(0, 0, 0, 0.4);
            --shadow-card: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
        }

        body {
            font-family: 'Amiri', 'Scheherazade New', 'Noto Naskh Arabic', 'Traditional Arabic', serif;
            background: var(--night-deep);
            min-height: 100vh;
            color: var(--text-light);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            overflow-y: auto;
            overflow-x: hidden;
        }

        /* Animated Starfield Background */
        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration) ease-in-out infinite;
            opacity: 0;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0; transform: scale(0.5); }
            50% { opacity: var(--opacity); transform: scale(1); }
        }

        /* Islamic Geometric Pattern Overlay */
        .pattern-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Cg fill='%232ecc71' fill-opacity='1'%3E%3Cpath d='M40 0L48.66 20H60L50 32.36L54.64 52.36L40 42L25.36 52.36L30 32.36L20 20H31.34L40 0zM0 40L8.66 60H20L10 72.36L14.64 92.36L0 82L-14.64 92.36L-10 72.36L-20 60H-8.66L0 40zM80 40L88.66 60H100L90 72.36L94.64 92.36L80 82L65.36 92.36L70 72.36L60 60H71.34L80 40z'/%3E%3C/g%3E%3C/svg%3E");
        }

        .container {
            position: relative;
            z-index: 2;
            max-width: 100%;
            width: 100%;
            margin: 0;
            background: transparent;
            min-height: 100vh;
        }

        /* Majestic Header */
        .header {
            background: linear-gradient(180deg,
                var(--night-mid) 0%,
                var(--night-soft) 50%,
                var(--night-glow) 100%);
            color: var(--text-light);
            padding: 50px 40px;
            text-align: center;
            border-bottom: 2px solid var(--gold-warm);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg,
                transparent,
                var(--gold-bright),
                transparent);
        }

        .header::after {
            content: '☪';
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5em;
            color: var(--gold-bright);
            opacity: 0.6;
            animation: gentlePulse 4s ease-in-out infinite;
        }

        @keyframes gentlePulse {
            0%, 100% { opacity: 0.4; transform: translateX(-50%) scale(1); }
            50% { opacity: 0.8; transform: translateX(-50%) scale(1.1); }
        }

        .header h1 {
            font-family: 'Scheherazade New', 'Amiri', serif;
            font-size: 4.5em;
            margin-bottom: 15px;
            text-shadow: 0 0 30px rgba(46, 204, 113, 0.5),
                         0 4px 15px rgba(0, 0, 0, 0.5);
            font-weight: 700;
            letter-spacing: 0.03em;
            color: var(--gold-soft);
            animation: titleGlow 6s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 30px rgba(46, 204, 113, 0.5), 0 4px 15px rgba(0, 0, 0, 0.5); }
            50% { text-shadow: 0 0 50px rgba(46, 204, 113, 0.7), 0 4px 20px rgba(0, 0, 0, 0.5); }
        }

        .header p {
            font-size: 1.8em;
            opacity: 0.85;
            font-weight: 400;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            font-style: italic;
        }

        /* Ornamental Divider */
        .ornament {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            gap: 15px;
        }

        .ornament-line {
            height: 1px;
            width: 80px;
            background: linear-gradient(90deg, transparent, var(--gold-warm), transparent);
        }

        .ornament-symbol {
            color: var(--gold-bright);
            font-size: 1.2em;
            opacity: 0.7;
        }

        /* Elegant Tab Navigation */
        .tabs-nav {
            display: flex;
            background: linear-gradient(180deg, var(--night-soft) 0%, var(--night-mid) 100%);
            border-bottom: 1px solid var(--gold-warm);
            overflow-x: auto;
            flex-wrap: wrap;
            padding: 10px 20px;
            gap: 10px;
        }

        .tabs-nav button {
            flex: 1;
            min-width: 160px;
            padding: 20px 25px;
            border: 1px solid transparent;
            background: rgba(255, 255, 255, 0.03);
            cursor: pointer;
            font-family: 'Amiri', serif;
            font-size: 1.6em;
            font-weight: 600;
            color: var(--text-muted);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 12px;
            white-space: nowrap;
            letter-spacing: 0.02em;
            position: relative;
            overflow: hidden;
        }

        .tabs-nav button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent,
                rgba(46, 204, 113, 0.1),
                transparent);
            transition: left 0.5s ease;
        }

        .tabs-nav button:hover::before {
            left: 100%;
        }

        .tabs-nav button:hover {
            background: rgba(46, 204, 113, 0.1);
            color: var(--gold-soft);
            border-color: rgba(46, 204, 113, 0.3);
            transform: translateY(-2px);
        }

        .tabs-nav button.active {
            color: var(--night-deep);
            background: linear-gradient(135deg, var(--gold-warm) 0%, var(--gold-bright) 100%);
            border-color: var(--gold-bright);
            box-shadow: var(--glow-gold);
            transform: translateY(-2px);
        }

        /* Sub-navigation pills inside tabs */
        .sub-nav {
            display: flex; gap: 8px; margin-bottom: 22px; overflow-x: auto;
            padding-bottom: 8px; flex-wrap: wrap;
        }
        .sub-nav-btn {
            padding: 10px 20px; border-radius: 20px;
            border: 1px solid rgba(46,204,113,0.25); background: rgba(255,255,255,0.04);
            color: var(--text-muted); font-family: 'Amiri', serif; font-size: 1.15em;
            cursor: pointer; transition: all 0.3s; white-space: nowrap;
        }
        .sub-nav-btn:hover { background: rgba(46,204,113,0.1); color: var(--gold-soft); }
        .sub-nav-btn.active {
            background: linear-gradient(135deg, var(--gold-warm), var(--gold-bright));
            color: var(--night-deep); border-color: var(--gold-bright); font-weight: 600;
        }
        .sub-section { display: none; animation: fadeInUp 0.4s ease; }
        .sub-section.active { display: block; }

        /* Home dashboard cards */
        .home-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .home-card {
            background: linear-gradient(135deg, rgba(26,37,64,0.95), rgba(18,26,46,0.98));
            border: 1px solid rgba(212,175,55,0.18); border-radius: 16px;
            padding: 22px; transition: all 0.3s; cursor: pointer;
        }
        .home-card:hover { transform: translateY(-3px); border-color: rgba(46,204,113,0.4); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
        .home-card-icon { font-size: 2.2em; margin-bottom: 8px; }
        .home-card-title { font-family: 'Scheherazade New', serif; font-size: 1.4em; color: var(--gold-soft); margin-bottom: 4px; }
        .home-card-desc { font-size: 0.95em; color: var(--text-muted); }

        /* Event countdown cards */
        .event-countdowns { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 14px; margin-bottom: 24px; }
        .event-card {
            text-align: center; padding: 20px 16px; border-radius: 16px;
            background: linear-gradient(135deg, rgba(26,37,64,0.95), rgba(18,26,46,0.98));
            border: 1px solid rgba(46,204,113,0.15); transition: all 0.3s; position: relative; overflow: hidden;
        }
        .event-card.active-event { border-color: var(--gold-bright); box-shadow: 0 0 20px rgba(46,204,113,0.2); }
        .event-card-icon { font-size: 2em; margin-bottom: 6px; }
        .event-card-name { font-family: 'Scheherazade New', serif; font-size: 1.3em; color: var(--gold-soft); margin-bottom: 4px; }
        .event-card-days { font-size: 2.4em; font-weight: 700; color: var(--gold-bright); font-family: 'Amiri', serif; }
        .event-card-label { font-size: 0.9em; color: var(--text-muted); margin-top: 2px; }
        .event-card-date { font-size: 0.85em; color: var(--text-muted); margin-top: 6px; opacity: 0.7; }

        /* Live prayer countdown */
        .live-countdown-bar {
            background: linear-gradient(135deg, rgba(26,37,64,0.98), rgba(18,26,46,0.98));
            border: 1px solid rgba(46,204,113,0.25); border-radius: 16px;
            padding: 20px 24px; margin: 16px 0; text-align: center;
        }
        .countdown-next-label { font-size: 1.1em; color: var(--text-muted); margin-bottom: 6px; }
        .countdown-next-name { font-family: 'Scheherazade New', serif; font-size: 1.6em; color: var(--gold-soft); }
        .countdown-next-timer { font-size: 2.8em; font-weight: 700; color: var(--gold-bright); font-family: 'Amiri', serif; direction: ltr; margin: 8px 0; }
        .countdown-fasting {
            display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;
            margin-top: 14px; padding-top: 14px; border-top: 1px solid rgba(46,204,113,0.1);
        }
        .fasting-item { text-align: center; }
        .fasting-label { font-size: 0.9em; color: var(--text-muted); margin-bottom: 2px; }
        .fasting-value { font-size: 1.3em; font-weight: 600; color: var(--gold-soft); font-family: 'Amiri', serif; direction: ltr; }

        /* Ramadan calendar */
        .ramadan-cal-table {
            width: 100%; border-collapse: collapse; margin: 16px 0;
            font-family: 'Amiri', serif; font-size: 1.05em;
        }
        .ramadan-cal-table th {
            background: linear-gradient(135deg, var(--gold-warm), var(--gold-bright));
            color: var(--night-deep); padding: 12px 8px; font-weight: 600;
            font-size: 1.1em; position: sticky; top: 0; z-index: 2;
        }
        .ramadan-cal-table td {
            padding: 10px 8px; text-align: center; border-bottom: 1px solid rgba(46,204,113,0.08);
            color: var(--text-light);
        }
        .ramadan-cal-table tr:hover td { background: rgba(46,204,113,0.05); }
        .ramadan-cal-table tr.today-row td { background: rgba(46,204,113,0.12); font-weight: 600; }
        .ramadan-cal-table tr.today-row td:first-child { border-right: 3px solid var(--gold-bright); }
        .ramadan-cal-scroll { max-height: 70vh; overflow-y: auto; border-radius: 14px; border: 1px solid rgba(46,204,113,0.15); }

        /* Prayer times */
        .prayer-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 12px; margin: 20px 0; }
        .prayer-card {
            text-align: center; padding: 18px 14px; border-radius: 14px;
            background: linear-gradient(135deg, rgba(26,37,64,0.95), rgba(18,26,46,0.98));
            border: 1px solid rgba(212,175,55,0.15); transition: all 0.3s;
        }
        .prayer-card.next { border-color: var(--gold-bright); box-shadow: var(--glow-gold); }
        .prayer-card-name { font-family: 'Scheherazade New', serif; font-size: 1.3em; color: var(--gold-soft); margin-bottom: 6px; }
        .prayer-card-time { font-size: 1.6em; color: var(--text-light); font-weight: 600; font-family: 'Amiri', serif; }

        /* Tasbeeh counter */
        .tasbeeh-container { text-align: center; padding: 30px 0; }
        .tasbeeh-count {
            font-size: 5em; font-weight: 700; color: var(--gold-bright);
            font-family: 'Amiri', serif; margin: 20px 0; text-shadow: 0 0 20px rgba(46,204,113,0.3);
        }
        .tasbeeh-btn {
            width: 160px; height: 160px; border-radius: 50%; border: 3px solid var(--gold-bright);
            background: linear-gradient(135deg, rgba(46,204,113,0.15), rgba(46,204,113,0.05));
            color: var(--gold-bright); font-size: 1.4em; font-family: 'Amiri', serif;
            cursor: pointer; transition: all 0.15s; margin: 20px auto; display: flex;
            align-items: center; justify-content: center;
        }
        .tasbeeh-btn:active { transform: scale(0.95); background: rgba(46,204,113,0.25); }
        .tasbeeh-presets { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin: 18px 0; }
        .tasbeeh-preset {
            padding: 8px 16px; border-radius: 12px; border: 1px solid rgba(46,204,113,0.25);
            background: rgba(255,255,255,0.04); color: var(--text-muted); cursor: pointer;
            font-family: 'Amiri', serif; font-size: 1.05em; transition: all 0.3s;
        }
        .tasbeeh-preset:hover, .tasbeeh-preset.active { background: rgba(46,204,113,0.15); color: var(--gold-soft); border-color: var(--gold-bright); }
        .tasbeeh-target { color: var(--text-muted); font-size: 1.1em; margin: 8px 0; }
        .tasbeeh-controls { display: flex; gap: 10px; justify-content: center; margin-top: 15px; }
        .tasbeeh-ctrl-btn {
            padding: 8px 20px; border-radius: 10px; border: 1px solid rgba(46,204,113,0.25);
            background: rgba(255,255,255,0.05); color: var(--gold-soft); cursor: pointer;
            font-family: 'Amiri', serif; font-size: 1.05em; transition: all 0.3s;
        }
        .tasbeeh-ctrl-btn:hover { background: rgba(46,204,113,0.15); }

        /* 99 Names grid */
        .names-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 12px; }
        .name-card {
            text-align: center; padding: 18px; border-radius: 14px;
            background: linear-gradient(135deg, rgba(26,37,64,0.95), rgba(18,26,46,0.98));
            border: 1px solid rgba(212,175,55,0.12); transition: all 0.3s;
        }
        .name-card:hover { border-color: rgba(46,204,113,0.3); transform: translateY(-2px); }
        .name-card-ar { font-family: 'Scheherazade New', serif; font-size: 1.8em; color: var(--gold-bright); margin-bottom: 4px; }
        .name-card-meaning { font-size: 0.95em; color: var(--text-muted); }

        /* Content Wrapper */
        .content-wrapper {
            padding: 30px 40px;
            background: linear-gradient(180deg,
                rgba(26, 37, 64, 0.95) 0%,
                rgba(18, 26, 46, 0.98) 100%);
            min-height: 100vh;
        }

        .content-area {
            display: none;
            animation: fadeInUp 0.6s ease;
        }

        .content-area.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Section Title */
        .section-title {
            font-family: 'Scheherazade New', serif;
            font-size: 3.2em;
            color: var(--gold-bright);
            margin-bottom: 25px;
            padding-bottom: 20px;
            text-align: center;
            font-weight: 600;
            letter-spacing: 0.04em;
            position: relative;
            text-shadow: 0 0 20px rgba(46, 204, 113, 0.4);
        }

        .section-title::after {
            content: '❋ ❋ ❋';
            display: block;
            margin-top: 15px;
            font-size: 0.4em;
            color: var(--gold-warm);
            letter-spacing: 0.5em;
            opacity: 0.7;
        }

        /* Dua Cards - Main Prayer Cards */
        .dua-card {
            background: linear-gradient(135deg,
                rgba(250, 246, 237, 0.97) 0%,
                rgba(255, 254, 249, 0.99) 100%);
            padding: 25px 30px;
            margin-bottom: 20px;
            border-radius: 16px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-card);
            border: 1px solid rgba(46, 204, 113, 0.2);
        }

        .dua-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--gold-bright), var(--gold-warm));
            border-radius: 0 16px 16px 0;
        }

        .dua-card::after {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50 0L61.8 38.2L100 50L61.8 61.8L50 100L38.2 61.8L0 50L38.2 38.2Z' fill='%232ecc71' fill-opacity='0.15'/%3E%3C/svg%3E");
            background-size: contain;
            opacity: 0.5;
        }

        .dua-card:hover {
            transform: translateY(-4px) scale(1.01);
            box-shadow: 0 8px 30px rgba(46, 204, 113, 0.2),
                        0 4px 15px rgba(0, 0, 0, 0.1);
            border-color: rgba(46, 204, 113, 0.4);
        }

        .dua-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--gold-warm) 0%, var(--gold-bright) 100%);
            color: var(--night-deep);
            width: 45px;
            height: 45px;
            border-radius: 50%;
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(46, 204, 113, 0.4);
        }

        .dua-counter {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, var(--emerald) 0%, var(--emerald-soft) 100%);
            color: white;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 1.1em;
            margin-right: 10px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(45, 90, 74, 0.3);
        }

        .dua-counter::before {
            content: "×";
            margin-left: 5px;
            opacity: 0.8;
        }

        .dua-text {
            font-family: 'Scheherazade New', 'Amiri', serif;
            font-size: 2em;
            line-height: 2.6;
            color: #1a5c3a;
            margin: 15px 0;
            font-weight: 500;
            padding: 15px 20px;
            background: rgba(46, 204, 113, 0.05);
            border-radius: 12px;
            letter-spacing: 0.03em;
            text-rendering: optimizeLegibility;
            position: relative;
        }

        .dua-text::first-line {
            color: var(--gold-warm);
        }

        .dua-source {
            font-size: 0.85em;
            color: var(--text-muted);
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid rgba(46,204,113,0.1);
        }
        .dua-source strong {
            color: var(--gold-warm);
        }

        .benefits {
            display: none;
        }

        /* Quran Verses - Special Styling */
        .quran-verse {
            background: linear-gradient(135deg,
                rgba(18, 26, 46, 0.98) 0%,
                rgba(26, 37, 64, 0.98) 100%);
            padding: 30px 35px;
            margin-bottom: 25px;
            border-radius: 20px;
            line-height: 2.8;
            font-family: 'Scheherazade New', serif;
            font-size: 2em;
            color: var(--gold-soft);
            text-align: right;
            font-weight: 400;
            letter-spacing: 0.04em;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3),
                        inset 0 0 100px rgba(46, 204, 113, 0.05);
            border: 2px solid rgba(46, 204, 113, 0.3);
        }

        .quran-verse::before {
            content: '﴾';
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 3em;
            color: var(--gold-warm);
            opacity: 0.15;
            font-family: 'Scheherazade New', serif;
        }

        .quran-verse::after {
            content: '﴿';
            position: absolute;
            bottom: 20px;
            left: 20px;
            font-size: 3em;
            color: var(--gold-warm);
            opacity: 0.15;
            font-family: 'Scheherazade New', serif;
        }

        .quran-verse:hover {
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4),
                        inset 0 0 120px rgba(46, 204, 113, 0.08),
                        0 0 30px rgba(46, 204, 113, 0.15);
            border-color: rgba(46, 204, 113, 0.5);
        }

        .verse-num {
            display: inline-block;
            color: var(--gold-bright);
            font-weight: bold;
            font-size: 1em;
            padding: 8px 16px;
            background: rgba(46, 204, 113, 0.15);
            border-radius: 8px;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
        }

        /* Section Headings */
        .section-heading {
            font-family: 'Scheherazade New', serif;
            font-size: 2.4em;
            color: var(--gold-warm);
            margin-top: 40px;
            margin-bottom: 25px;
            font-weight: 600;
            letter-spacing: 0.03em;
            text-align: center;
            position: relative;
            padding-bottom: 15px;
        }

        .section-heading::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 2px;
            background: linear-gradient(90deg,
                transparent,
                var(--gold-warm),
                transparent);
        }

        /* Info Boxes */
        .intro-box {
            background: linear-gradient(135deg,
                rgba(45, 90, 74, 0.95) 0%,
                rgba(58, 122, 100, 0.95) 100%);
            padding: 25px 30px;
            border-radius: 16px;
            margin-bottom: 25px;
            line-height: 2.2;
            font-size: 1.6em;
            color: var(--cream);
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(45, 90, 74, 0.3);
            border: 1px solid rgba(46, 204, 113, 0.2);
        }

        .intro-box::before {
            content: '✦';
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 1.5em;
            color: var(--gold-bright);
            opacity: 0.4;
        }

        .intro-box strong {
            color: var(--gold-soft);
            font-size: 1.1em;
            font-weight: 600;
            display: block;
            margin-bottom: 10px;
        }

        /* Benefits List */
        .benefits-list {
            margin-top: 15px;
            margin-right: 25px;
            list-style: none;
        }

        .benefits-list li {
            margin-bottom: 12px;
            line-height: 2;
            font-size: 1em;
            font-weight: 400;
            color: var(--cream-soft);
            position: relative;
            padding-right: 30px;
        }

        .benefits-list li::before {
            content: '✧';
            position: absolute;
            right: 0;
            color: var(--gold-bright);
            font-size: 0.9em;
        }

        .benefits-list li strong {
            color: var(--gold-soft);
            display: inline;
            font-size: 1em;
        }

        /* Custom Scrollbar - applies to full page scroll */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--night-mid);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--gold-warm), var(--gold-bright));
            border-radius: 5px;
            border: 2px solid var(--night-mid);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gold-bright);
        }

        /* Counter Display */
        .counter-display {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--emerald);
            font-size: 1.3em;
            margin-top: 10px;
            font-weight: 600;
        }

        .counter-display .dua-counter {
            background: linear-gradient(135deg, var(--emerald) 0%, var(--emerald-soft) 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.9em;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.8em;
            }

            .header p {
                font-size: 1.3em;
            }

            .tabs-nav {
                padding: 8px 10px;
                gap: 8px;
            }

            .tabs-nav button {
                min-width: 120px;
                padding: 15px 18px;
                font-size: 1.3em;
            }

            .content-wrapper {
                padding: 20px;
            }

            .section-title {
                font-size: 2.4em;
            }

            .dua-card {
                padding: 20px;
            }

            .dua-text {
                font-size: 1.6em;
                padding: 12px 15px;
            }

            .quran-verse {
                font-size: 1.6em;
                padding: 20px 25px;
            }

            .intro-box {
                font-size: 1.4em;
                padding: 20px;
            }
        }

        /* Breathing Animation for Focus */
        @keyframes breathe {
            0%, 100% { box-shadow: 0 4px 20px rgba(46, 204, 113, 0.1); }
            50% { box-shadow: 0 4px 30px rgba(46, 204, 113, 0.25); }
        }

        .dua-card:focus-within {
            animation: breathe 3s ease-in-out infinite;
        }

        /* Selection Styling */
        ::selection {
            background: var(--gold-warm);
            color: var(--night-deep);
        }

        ::-moz-selection {
            background: var(--gold-warm);
            color: var(--night-deep);
        }

        /* Scroll to Top Button */
        .scroll-top-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--gold-warm) 0%, var(--gold-bright) 100%);
            color: var(--night-deep);
            border: none;
            cursor: pointer;
            font-size: 1.5em;
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scroll-top-btn.visible {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .scroll-top-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(46, 204, 113, 0.6);
        }

        .scroll-top-btn:active {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .scroll-top-btn {
                bottom: 20px;
                left: 20px;
                width: 44px;
                height: 44px;
                font-size: 1.3em;
            }
        }

        /* ═══════════════════════════════════════ */
        /* Habits Tracker Styles */
        /* ═══════════════════════════════════════ */
        .habits-section-label {
            font-family: 'Scheherazade New', serif;
            font-size: 2.2em;
            color: var(--gold-bright);
            margin: 35px 0 20px;
            text-align: center;
            font-weight: 600;
            position: relative;
            padding-bottom: 12px;
        }

        .habits-section-label::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--gold-warm), transparent);
        }

        .habit-item {
            background: linear-gradient(135deg,
                rgba(250, 246, 237, 0.97) 0%,
                rgba(255, 254, 249, 0.99) 100%);
            padding: 18px 24px;
            margin-bottom: 12px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            transition: all 0.3s ease;
            border: 1px solid rgba(46, 204, 113, 0.2);
            box-shadow: var(--shadow-card);
        }

        .habit-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(46, 204, 113, 0.15);
            border-color: rgba(46, 204, 113, 0.4);
        }

        .habit-item.completed {
            opacity: 0.55;
            background: linear-gradient(135deg,
                rgba(46, 204, 113, 0.12) 0%,
                rgba(46, 204, 113, 0.06) 100%);
            border-color: var(--gold-bright);
        }

        .habit-item.completed .habit-name {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .habit-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 3px;
        }

        .habit-name {
            font-family: 'Amiri', serif;
            font-size: 1.45em;
            color: #1a5c3a;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .habit-schedule {
            font-size: 1.05em;
            color: #888;
            font-family: 'Amiri', serif;
        }

        .habit-check {
            position: relative;
        }

        .habit-check input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 34px;
            height: 34px;
            border: 2px solid var(--gold-warm);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .habit-check input[type="checkbox"]:checked {
            background: linear-gradient(135deg, var(--gold-warm), var(--gold-bright));
            border-color: var(--gold-bright);
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.4);
        }

        .habit-check input[type="checkbox"]::after {
            content: '✓';
            color: transparent;
            font-size: 1.1em;
            font-weight: bold;
            transition: color 0.2s ease;
        }

        .habit-check input[type="checkbox"]:checked::after {
            color: white;
        }

        .weekly-tracker {
            background: linear-gradient(135deg,
                rgba(18, 26, 46, 0.98) 0%,
                rgba(26, 37, 64, 0.98) 100%);
            border-radius: 20px;
            padding: 25px 20px;
            margin: 30px 0;
            border: 2px solid rgba(46, 204, 113, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .weekly-tracker h3 {
            font-family: 'Scheherazade New', serif;
            font-size: 1.8em;
            color: var(--gold-bright);
            text-align: center;
            margin-bottom: 20px;
        }

        .week-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            text-align: center;
        }

        .week-grid .day-header {
            font-family: 'Amiri', serif;
            font-size: 1.15em;
            color: var(--gold-soft);
            padding: 8px 4px;
            font-weight: 600;
        }

        .week-grid .day-cell {
            aspect-ratio: 1;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(46, 204, 113, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .week-grid .day-cell:hover {
            border-color: rgba(46, 204, 113, 0.5);
            background: rgba(46, 204, 113, 0.1);
        }

        .week-grid .day-cell.today {
            border-color: var(--gold-bright);
            box-shadow: 0 0 15px rgba(46, 204, 113, 0.3);
            color: var(--gold-bright);
            font-weight: bold;
        }

        .week-grid .day-cell.done {
            background: linear-gradient(135deg, var(--gold-warm), var(--gold-bright));
            color: var(--night-deep);
            font-weight: bold;
            border-color: var(--gold-bright);
        }

        .habits-controls {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        .habits-btn {
            font-family: 'Amiri', serif;
            font-size: 1.25em;
            padding: 12px 26px;
            border-radius: 12px;
            border: 1px solid rgba(46, 204, 113, 0.3);
            background: rgba(46, 204, 113, 0.1);
            color: var(--gold-soft);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .habits-btn:hover {
            background: linear-gradient(135deg, var(--gold-warm), var(--gold-bright));
            color: var(--night-deep);
            border-color: var(--gold-bright);
            box-shadow: var(--glow-gold);
        }

        /* === Enhanced Quran Browser === */
        .s-list.off { display: none; }
        .s-reader2 { display: none; }
        .s-reader2.on { display: block; }
        .quran-search {
            width: 100%; padding: 14px 20px; border-radius: 12px;
            border: 1px solid rgba(212,175,55,0.25); background: rgba(255,255,255,0.05);
            color: var(--text-light); font-family: 'Amiri', serif; font-size: 1.2em;
            outline: none; transition: all 0.3s; margin-bottom: 18px;
        }
        .quran-search::placeholder { color: var(--text-muted); }
        .quran-search:focus { border-color: var(--gold-bright); box-shadow: 0 0 15px rgba(46,204,113,0.15); }
        .surah-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 12px;
        }
        .surah-card {
            position: relative; background: linear-gradient(135deg, rgba(26,37,64,0.95), rgba(18,26,46,0.98));
            border: 1px solid rgba(212,175,55,0.15); border-radius: 14px;
            padding: 18px 20px; cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; gap: 14px;
        }
        .surah-card:hover { border-color: rgba(46,204,113,0.4); transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.3); }
        .surah-card.highlighted { border-color: rgba(212,175,55,0.5); background: linear-gradient(135deg, rgba(45,40,20,0.95), rgba(30,28,18,0.98)); box-shadow: 0 0 18px rgba(212,175,55,0.12); }
        .surah-card.highlighted .surah-card-num { background: linear-gradient(135deg, #d4af37, #f0c040); }
        .surah-hl-btn {
            position: absolute; top: 8px; left: 8px; width: 30px; height: 30px; border-radius: 50%;
            border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 0.85em; transition: all 0.2s; z-index: 2;
            background: rgba(255,255,255,0.06); color: var(--text-muted);
        }
        .surah-hl-btn:hover { background: rgba(212,175,55,0.2); color: var(--gold-soft); }
        .surah-hl-btn.on { background: rgba(212,175,55,0.25); color: var(--gold-bright); }
        .surah-card-num {
            min-width: 44px; height: 44px; display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, var(--gold-warm), var(--gold-bright));
            color: var(--night-deep); border-radius: 50%; font-weight: bold; font-size: 1.1em; flex-shrink: 0;
        }
        .surah-card-info { flex: 1; min-width: 0; }
        .surah-card-name {
            font-family: 'Scheherazade New', 'Amiri', serif; font-size: 1.35em;
            color: var(--text-light); font-weight: 600; margin-bottom: 2px;
        }
        .surah-card-meta { font-size: 0.95em; color: var(--text-muted); display: flex; align-items: center; gap: 8px; }
        .surah-card-type {
            display: inline-block; padding: 2px 10px; border-radius: 8px; font-size: 0.9em;
        }
        .surah-card-type.meccan { background: rgba(46,204,113,0.15); color: var(--gold-soft); }
        .surah-card-type.medinan { background: rgba(52,152,219,0.15); color: #85c1e9; }
        .last-read-card {
            background: linear-gradient(135deg, rgba(45,90,74,0.95), rgba(58,122,100,0.95));
            padding: 18px 24px; border-radius: 14px; margin-bottom: 20px;
            cursor: pointer; transition: all 0.3s; border: 1px solid rgba(212,175,55,0.3);
            display: flex; align-items: center; gap: 15px;
        }
        .last-read-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(45,90,74,0.4); }
        .bookmarks-bar { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 18px; }
        .bm-chip {
            background: rgba(212,175,55,0.12); border: 1px solid rgba(212,175,55,0.25);
            padding: 7px 14px; border-radius: 18px; cursor: pointer; transition: all 0.3s;
            font-family: 'Amiri', serif; font-size: 1.05em; color: var(--gold-soft);
            display: flex; align-items: center; gap: 6px;
        }
        .bm-chip:hover { background: rgba(212,175,55,0.22); transform: translateY(-1px); }
        .bm-chip .bm-x { opacity: 0.5; cursor: pointer; font-size: 0.85em; }
        .bm-chip .bm-x:hover { opacity: 1; color: #e74c3c; }
        .q-filters2 { display: flex; gap: 8px; margin-bottom: 22px; flex-wrap: wrap; }
        .q-filter2 {
            padding: 9px 18px; border-radius: 10px; border: 1px solid rgba(212,175,55,0.2);
            background: rgba(255,255,255,0.03); color: var(--text-muted);
            font-family: 'Amiri', serif; font-size: 1.15em; cursor: pointer; transition: all 0.3s;
        }
        .q-filter2:hover { background: rgba(212,175,55,0.1); color: var(--gold-soft); }
        .q-filter2.on { background: linear-gradient(135deg, var(--gold-warm), var(--gold-bright)); color: var(--night-deep); border-color: var(--gold-bright); }
        .r-head2 { display: flex; align-items: center; justify-content: space-between; margin-bottom: 22px; flex-wrap: wrap; gap: 12px; }
        .r-btn2 {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 10px 18px; border-radius: 10px;
            border: 1px solid rgba(212,175,55,0.25); background: rgba(255,255,255,0.05);
            color: var(--gold-soft); font-family: 'Amiri', serif; font-size: 1.15em;
            cursor: pointer; transition: all 0.3s;
        }
        .r-btn2:hover { background: rgba(212,175,55,0.12); }
        .r-btn2:disabled { opacity: 0.3; cursor: not-allowed; }
        .r-btn2.bm-on { background: rgba(212,175,55,0.18); border-color: var(--gold-bright); color: var(--gold-bright); }
        .r-title2 { text-align: center; flex: 1; min-width: 200px; }
        .r-title2 h3 { font-family: 'Scheherazade New', serif; font-size: 2.4em; color: var(--gold-bright); text-shadow: 0 0 18px rgba(212,175,55,0.35); }
        .r-title2 .r-meta2 { color: var(--text-muted); font-size: 1.05em; margin-top: 4px; }
        .r-nav2 { display: flex; gap: 8px; }
        .bismillah-box2 {
            text-align: center; font-family: 'Scheherazade New', serif; font-size: 2.1em;
            color: var(--gold-soft); padding: 22px;
            background: linear-gradient(135deg, rgba(18,26,46,0.98), rgba(26,37,64,0.98));
            border-radius: 14px; border: 1px solid rgba(212,175,55,0.18); margin-bottom: 18px;
        }
        .surah-para {
            background: linear-gradient(135deg, rgba(250,246,237,0.97), rgba(255,254,249,0.99));
            padding: 28px 30px; border-radius: 14px;
            border: 1px solid rgba(212,175,55,0.12);
            font-family: 'Scheherazade New', 'Amiri', serif;
            font-size: 1.8em; line-height: 2.4; color: var(--text-dark);
            text-align: justify; word-spacing: 2px;
        }
        .ayah-span { transition: background 0.3s; border-radius: 4px; padding: 0 2px; cursor: pointer; }
        .ayah-span.selected { background: rgba(46, 204, 113, 0.22); }
        .ayah-span.lr-hl { background: rgba(46, 204, 113, 0.15); }
        .ayah-span.bm-hl { background: rgba(212, 175, 55, 0.18); }
        .ayah-popup {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(80px);
            background: linear-gradient(135deg, var(--night-soft), var(--night-mid));
            border: 1px solid rgba(212,175,55,0.35); border-radius: 16px;
            padding: 12px 18px; display: flex; align-items: center; gap: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5); z-index: 998;
            opacity: 0; pointer-events: none; transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
        }
        .ayah-popup.show { opacity: 1; pointer-events: auto; transform: translateX(-50%) translateY(0); }
        .ayah-popup-text { color: var(--text-light); font-family: 'Amiri', serif; font-size: 1.1em; white-space: nowrap; }
        .ayah-popup-btn {
            padding: 8px 16px; border-radius: 10px; border: none; cursor: pointer;
            font-family: 'Amiri', serif; font-size: 1.05em; transition: all 0.2s; white-space: nowrap;
        }
        .ayah-popup-btn.save {
            background: linear-gradient(135deg, var(--gold-warm), var(--gold-bright));
            color: var(--night-deep); font-weight: 600;
        }
        .ayah-popup-btn.save:hover { box-shadow: var(--glow-gold); }
        .ayah-popup-btn.resume {
            background: rgba(46,204,113,0.15); color: var(--gold-soft);
            border: 1px solid rgba(46,204,113,0.3);
        }
        .ayah-popup-btn.resume:hover { background: rgba(46,204,113,0.25); }
        .ayah-popup-btn.close {
            background: rgba(255,255,255,0.08); color: var(--text-muted);
            padding: 8px 12px;
        }
        .ayah-popup-btn.close:hover { background: rgba(255,255,255,0.15); }
        .ayah-num-inline {
            display: inline; font-size: 0.65em; color: var(--gold-warm);
            cursor: pointer; margin: 0 4px; font-weight: bold;
            transition: color 0.3s; vertical-align: middle; user-select: none;
        }
        .ayah-num-inline:hover { color: var(--gold-bright); }
        .ayah-num-inline.on { color: var(--gold-bright); text-shadow: 0 0 8px rgba(46,204,113,0.5); }

        /* Tafseer Panel */
        .tafseer-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .tafseer-overlay.show { opacity: 1; pointer-events: auto; }
        .tafseer-panel {
            position: fixed; bottom: 0; left: 0; right: 0; z-index: 1001;
            max-height: 75vh; background: linear-gradient(180deg, var(--night-soft), var(--night-deep));
            border-top: 2px solid rgba(212,175,55,0.4);
            border-radius: 24px 24px 0 0; padding: 0;
            transform: translateY(100%); transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
            display: flex; flex-direction: column;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }
        .tafseer-panel.show { transform: translateY(0); }
        .tafseer-header {
            padding: 16px 20px 12px; display: flex; align-items: center; gap: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.08); flex-shrink: 0;
        }
        .tafseer-title {
            flex: 1; font-family: 'Amiri', serif; font-size: 1.2em;
            color: var(--gold-soft); font-weight: 600;
        }
        .tafseer-close {
            background: rgba(255,255,255,0.08); border: none; color: var(--text-muted);
            width: 36px; height: 36px; border-radius: 50%; cursor: pointer;
            font-size: 1.2em; display: flex; align-items: center; justify-content: center;
            transition: background 0.2s;
        }
        .tafseer-close:hover { background: rgba(255,255,255,0.15); }
        .tafseer-tabs {
            display: flex; gap: 6px; padding: 10px 20px;
            overflow-x: auto; flex-shrink: 0; scrollbar-width: none;
        }
        .tafseer-tabs::-webkit-scrollbar { display: none; }
        .tafseer-tab {
            padding: 7px 14px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.12);
            background: transparent; color: var(--text-muted); cursor: pointer;
            font-family: 'Amiri', serif; font-size: 0.95em; white-space: nowrap;
            transition: all 0.2s;
        }
        .tafseer-tab.active {
            background: linear-gradient(135deg, var(--gold-warm), var(--gold-bright));
            color: var(--night-deep); border-color: transparent; font-weight: 600;
        }
        .tafseer-tab:hover:not(.active) { border-color: rgba(212,175,55,0.3); color: var(--gold-soft); }
        .tafseer-body {
            padding: 20px; overflow-y: auto; flex: 1;
            font-family: 'Amiri', serif; font-size: 1.25em; line-height: 2.2;
            color: var(--cream-soft); direction: rtl;
        }
        .tafseer-body .tafseer-loading {
            text-align: center; padding: 40px; color: var(--text-muted); font-size: 0.9em;
        }
        .tafseer-ayah-text {
            background: rgba(212,175,55,0.08); border-right: 3px solid var(--gold-warm);
            padding: 12px 16px; margin-bottom: 16px; border-radius: 0 8px 8px 0;
            font-size: 1.05em; color: var(--gold-soft);
        }
        .ayah-popup-btn.tafseer {
            background: rgba(52,152,219,0.15); color: #85c1e9;
            border: 1px solid rgba(52,152,219,0.3);
        }
        .ayah-popup-btn.tafseer:hover { background: rgba(52,152,219,0.25); }
        .offline-progress {
            margin-bottom: 18px; padding: 14px 18px;
            background: rgba(18,26,46,0.8); border-radius: 12px;
            border: 1px solid rgba(212,175,55,0.2);
        }
        .offline-bar {
            width: 100%; height: 10px; background: rgba(255,255,255,0.08);
            border-radius: 6px; overflow: hidden; margin-bottom: 8px;
        }
        .offline-fill {
            height: 100%; width: 0%; border-radius: 6px;
            background: linear-gradient(90deg, var(--gold-warm), var(--gold-bright));
            transition: width 0.3s;
        }
        .offline-label { color: var(--text-muted); font-size: 1em; text-align: center; font-family: 'Amiri', serif; }
        .q-loading2 { text-align: center; padding: 50px; color: var(--gold-soft); font-size: 1.4em; }
        .q-spinner2 { display: block; width: 36px; height: 36px; margin: 18px auto;
            border: 3px solid rgba(212,175,55,0.18); border-top-color: var(--gold-bright);
            border-radius: 50%; animation: qspin2 0.8s linear infinite; }
        @keyframes qspin2 { to { transform: rotate(360deg); } }
        @media (max-width: 768px) {
            .r-head2 { flex-direction: column; align-items: stretch; text-align: center; }
            .r-title2 h3 { font-size: 1.9em; }
            .r-nav2 { justify-content: center; }
            .surah-para { font-size: 1.5em; padding: 20px 18px; }
            .surah-grid { grid-template-columns: 1fr; }
            .surah-card-name { font-size: 1.2em; }
        }
        /* Night/Reading Mode */
        body.night-mode { --night-deep: #000; --night-mid: #0a0a0a; --night-soft: #111; }
        .reading-controls {
            position: fixed; top: 12px; left: 12px; z-index: 999; display: flex; gap: 6px;
        }
        .rc-btn {
            width: 38px; height: 38px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.15);
            background: rgba(10,14,26,0.9); color: var(--text-muted); cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 1.1em;
            transition: all 0.2s; backdrop-filter: blur(10px);
        }
        .rc-btn:hover { border-color: rgba(212,175,55,0.4); color: var(--gold-soft); }
        .rc-btn.on { background: rgba(212,175,55,0.2); color: var(--gold-bright); border-color: rgba(212,175,55,0.5); }

        /* Qibla Compass */
        .qibla-container { text-align: center; padding: 20px; }
        .qibla-compass {
            width: 260px; height: 260px; margin: 20px auto; position: relative;
            border-radius: 50%; border: 3px solid rgba(212,175,55,0.3);
            background: radial-gradient(circle, rgba(26,37,64,0.95), rgba(10,14,26,0.98));
        }
        .qibla-arrow {
            position: absolute; top: 50%; left: 50%; width: 4px; height: 110px;
            background: linear-gradient(to top, transparent, var(--gold-bright));
            transform-origin: bottom center; transform: translateX(-50%) rotate(0deg);
            transition: transform 0.5s ease-out; border-radius: 2px;
        }
        .qibla-arrow::after {
            content: '🕋'; position: absolute; top: -20px; left: 50%;
            transform: translateX(-50%); font-size: 1.4em;
        }
        .qibla-degree {
            font-size: 2em; color: var(--gold-bright); font-weight: bold;
            margin-top: 15px; font-family: 'Amiri', serif;
        }
        .qibla-label { color: var(--text-muted); margin-top: 8px; font-size: 1.1em; }
        .qibla-n, .qibla-e, .qibla-s, .qibla-w {
            position: absolute; color: var(--text-muted); font-weight: bold; font-size: 0.9em;
        }
        .qibla-n { top: 8px; left: 50%; transform: translateX(-50%); color: var(--gold-soft); }
        .qibla-e { right: 8px; top: 50%; transform: translateY(-50%); }
        .qibla-s { bottom: 8px; left: 50%; transform: translateX(-50%); }
        .qibla-w { left: 8px; top: 50%; transform: translateY(-50%); }

        /* Khatm Tracker */
        .khatm-container { padding: 10px 0; }
        .khatm-progress-ring {
            width: 200px; height: 200px; margin: 0 auto 20px;
            position: relative; display: flex; align-items: center; justify-content: center;
        }
        .khatm-progress-ring svg { position: absolute; top: 0; left: 0; transform: rotate(-90deg); }
        .khatm-center {
            text-align: center; z-index: 1;
        }
        .khatm-pct { font-size: 2.5em; color: var(--gold-bright); font-weight: bold; }
        .khatm-label { color: var(--text-muted); font-size: 0.95em; }
        .khatm-stats {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px;
        }
        .khatm-stat {
            text-align: center; padding: 14px; background: rgba(26,37,64,0.8);
            border-radius: 12px; border: 1px solid rgba(255,255,255,0.06);
        }
        .khatm-stat-num { font-size: 1.6em; color: var(--gold-bright); font-weight: bold; }
        .khatm-stat-label { color: var(--text-muted); font-size: 0.85em; margin-top: 4px; }
        .khatm-juz-grid {
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 8px;
        }
        .khatm-juz {
            padding: 10px 4px; text-align: center; border-radius: 10px; cursor: pointer;
            border: 1px solid rgba(255,255,255,0.08); transition: all 0.2s;
            background: rgba(26,37,64,0.6); font-size: 0.95em; color: var(--text-muted);
        }
        .khatm-juz.done { background: rgba(46,204,113,0.15); border-color: rgba(46,204,113,0.3); color: var(--gold-soft); }
        .khatm-juz:hover { border-color: rgba(212,175,55,0.4); }
        .khatm-actions { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }

        /* Islamic Calendar */
        .hijri-cal { padding: 10px 0; }
        .hijri-cal-header {
            display: flex; align-items: center; justify-content: center; gap: 20px; margin-bottom: 20px;
        }
        .hijri-cal-nav {
            background: rgba(255,255,255,0.08); border: none; color: var(--text-muted);
            width: 36px; height: 36px; border-radius: 50%; cursor: pointer;
            font-size: 1.2em; display: flex; align-items: center; justify-content: center;
        }
        .hijri-cal-nav:hover { background: rgba(212,175,55,0.2); color: var(--gold-soft); }
        .hijri-cal-title { font-size: 1.3em; color: var(--gold-soft); font-family: 'Amiri', serif; }
        .hijri-cal-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center;
        }
        .hijri-cal-day-name { color: var(--text-muted); font-size: 0.85em; padding: 8px 0; }
        .hijri-cal-day {
            padding: 10px 4px; border-radius: 8px; font-size: 0.95em; color: var(--cream-soft);
            transition: background 0.2s;
        }
        .hijri-cal-day.today { background: rgba(46,204,113,0.2); color: var(--gold-bright); font-weight: bold; border: 1px solid rgba(46,204,113,0.4); }
        .hijri-cal-day.empty { opacity: 0; }
        .hijri-cal-day.event { background: rgba(212,175,55,0.12); color: var(--gold-soft); }

        /* Quran Search Results */
        .quran-search-results {
            max-height: 70vh; overflow-y: auto; display: none;
        }
        .qsr-item {
            padding: 14px 18px; border-bottom: 1px solid rgba(255,255,255,0.05);
            cursor: pointer; transition: background 0.2s;
        }
        .qsr-item:hover { background: rgba(46,204,113,0.08); }
        .qsr-ref { color: var(--gold-soft); font-size: 0.95em; margin-bottom: 6px; }
        .qsr-text { font-family: 'Amiri', serif; font-size: 1.2em; line-height: 1.8; color: var(--cream-soft); }
        .qsr-text mark { background: rgba(46,204,113,0.25); color: var(--gold-bright); border-radius: 2px; }

        /* Hadith Card */
        .hadith-card {
            background: linear-gradient(135deg, rgba(26,37,64,0.95), rgba(18,26,46,0.98));
            border: 1px solid rgba(212,175,55,0.15); border-radius: 14px;
            padding: 20px; margin-top: 20px; text-align: center;
        }
        .hadith-text { font-family: 'Amiri', serif; font-size: 1.25em; line-height: 2; color: var(--cream-soft); margin-bottom: 10px; }
        .hadith-ref { color: var(--gold-soft); font-size: 0.95em; }

        /* Hifz Memorization Tracker */
        .hifz-container { padding: 10px 0; }
        .hifz-legend {
            display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;
            margin-bottom: 18px;
        }
        .hifz-legend-item {
            display: flex; align-items: center; gap: 6px;
            font-size: 0.9em; color: var(--text-muted);
        }
        .hifz-legend-dot {
            width: 14px; height: 14px; border-radius: 4px;
        }
        .hifz-legend-dot.not-started { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); }
        .hifz-legend-dot.in-progress { background: rgba(52,152,219,0.35); border: 1px solid rgba(52,152,219,0.5); }
        .hifz-legend-dot.memorized { background: rgba(46,204,113,0.35); border: 1px solid rgba(46,204,113,0.5); }
        .hifz-legend-dot.review { background: rgba(243,156,18,0.35); border: 1px solid rgba(243,156,18,0.5); }
        .hifz-stats {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 18px;
        }
        .hifz-stat {
            text-align: center; padding: 12px 6px; background: rgba(26,37,64,0.8);
            border-radius: 10px; border: 1px solid rgba(255,255,255,0.06);
        }
        .hifz-stat-num { font-size: 1.4em; font-weight: bold; }
        .hifz-stat-num.not-started { color: var(--text-muted); }
        .hifz-stat-num.in-progress { color: #3498db; }
        .hifz-stat-num.memorized { color: var(--gold-bright); }
        .hifz-stat-num.review { color: #f39c12; }
        .hifz-stat-label { color: var(--text-muted); font-size: 0.75em; margin-top: 3px; }
        .hifz-grid {
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px;
        }
        .hifz-cell {
            padding: 8px 2px; text-align: center; border-radius: 6px; cursor: pointer;
            border: 1px solid rgba(255,255,255,0.06); transition: all 0.2s;
            background: rgba(26,37,64,0.4); font-size: 0.7em; color: var(--text-muted);
            user-select: none; -webkit-user-select: none;
            display: flex; flex-direction: column; align-items: center; gap: 1px;
            min-height: 44px; justify-content: center;
        }
        .hifz-cell:active { transform: scale(0.95); }
        .hifz-cell .hifz-cell-num { font-weight: bold; font-size: 1.1em; }
        .hifz-cell .hifz-cell-name { font-size: 0.85em; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 100%; }
        .hifz-cell.in-progress { background: rgba(52,152,219,0.18); border-color: rgba(52,152,219,0.35); color: #85c1e9; }
        .hifz-cell.memorized { background: rgba(46,204,113,0.18); border-color: rgba(46,204,113,0.35); color: var(--gold-soft); }
        .hifz-cell.review { background: rgba(243,156,18,0.18); border-color: rgba(243,156,18,0.35); color: #f5d76e; }
        .hifz-cell:hover { border-color: rgba(212,175,55,0.4); }
        .hifz-progress-bar {
            width: 100%; height: 8px; background: rgba(255,255,255,0.06);
            border-radius: 4px; overflow: hidden; margin-bottom: 18px;
            display: flex;
        }
        .hifz-bar-seg { height: 100%; transition: width 0.4s; }
        .hifz-bar-seg.memorized { background: var(--gold-bright); }
        .hifz-bar-seg.in-progress { background: #3498db; }
        .hifz-bar-seg.review { background: #f39c12; }
        .hifz-actions { display: flex; gap: 10px; justify-content: center; margin-top: 18px; }

        /* Reading History & Gamification */
        .reading-history-container { padding: 10px 0; }
        .streak-banner {
            background: linear-gradient(135deg, rgba(45,90,74,0.9), rgba(26,37,64,0.95));
            border: 1px solid rgba(46,204,113,0.3); border-radius: 14px;
            padding: 20px; text-align: center; margin-bottom: 20px;
        }
        .streak-flame { font-size: 2.5em; margin-bottom: 6px; }
        .streak-num { font-size: 2.2em; color: var(--gold-bright); font-weight: bold; }
        .streak-label { color: var(--text-muted); font-size: 0.95em; margin-top: 4px; }
        .streak-best { color: var(--gold-soft); font-size: 0.85em; margin-top: 8px; opacity: 0.7; }
        .reading-stats-row {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;
        }
        .reading-stat-card {
            text-align: center; padding: 14px 8px; background: rgba(26,37,64,0.8);
            border-radius: 12px; border: 1px solid rgba(255,255,255,0.06);
        }
        .reading-stat-num { font-size: 1.5em; color: var(--gold-bright); font-weight: bold; }
        .reading-stat-label { color: var(--text-muted); font-size: 0.8em; margin-top: 3px; }
        .week-heatmap {
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-bottom: 20px;
        }
        .week-day-cell {
            text-align: center; padding: 10px 4px; border-radius: 8px;
            background: rgba(26,37,64,0.5); border: 1px solid rgba(255,255,255,0.04);
        }
        .week-day-cell.active { background: rgba(46,204,113,0.2); border-color: rgba(46,204,113,0.3); }
        .week-day-cell.today { border-color: var(--gold-bright); }
        .week-day-name { font-size: 0.75em; color: var(--text-muted); }
        .week-day-dot {
            width: 10px; height: 10px; border-radius: 50%; margin: 6px auto 0;
            background: rgba(255,255,255,0.08);
        }
        .week-day-cell.active .week-day-dot { background: var(--gold-bright); }
        .history-feed { max-height: 300px; overflow-y: auto; }
        .history-item {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 16px; border-bottom: 1px solid rgba(255,255,255,0.04);
            cursor: pointer; transition: background 0.2s;
        }
        .history-item:hover { background: rgba(46,204,113,0.06); }
        .history-icon { font-size: 1.3em; }
        .history-info { flex: 1; }
        .history-title { color: var(--cream-soft); font-size: 1em; font-weight: 600; }
        .history-meta { color: var(--text-muted); font-size: 0.8em; margin-top: 2px; }
        .history-time { color: var(--text-muted); font-size: 0.85em; }
        .history-empty { text-align: center; padding: 30px; color: var(--text-muted); font-size: 1em; }

        /* Juz filter */
        .juz-grid {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px;
            max-height: 300px; overflow-y: auto; padding: 10px 0;
        }
        .juz-card {
            padding: 10px; text-align: center; border-radius: 10px; cursor: pointer;
            border: 1px solid rgba(255,255,255,0.08); transition: all 0.2s;
            background: rgba(26,37,64,0.6); color: var(--text-muted);
        }
        .juz-card:hover { border-color: rgba(46,204,113,0.4); }
        .juz-card-num { font-size: 1.2em; color: var(--gold-soft); font-weight: bold; }
        .juz-card-range { font-size: 0.75em; margin-top: 4px; }

        /* ═══════════════════════════════════════ */
        /* COMPREHENSIVE MOBILE OPTIMIZATION */
        /* ═══════════════════════════════════════ */

        /* iPhone safe areas */
        @supports (padding: env(safe-area-inset-bottom)) {
            .tabs-nav {
                padding-bottom: calc(10px + env(safe-area-inset-bottom));
            }
            .scroll-top-btn {
                bottom: calc(20px + env(safe-area-inset-bottom));
            }
            .ayah-popup {
                bottom: calc(20px + env(safe-area-inset-bottom));
            }
        }

        /* Small phones */
        @media (max-width: 480px) {
            /* Bottom sticky tab bar like native apps */
            .tabs-nav {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 990;
                flex-wrap: nowrap;
                padding: 6px 8px;
                gap: 4px;
                border-bottom: none;
                border-top: 1px solid var(--gold-warm);
                background: linear-gradient(0deg, var(--night-deep) 0%, var(--night-mid) 100%);
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
            }

            .tabs-nav button {
                min-width: 0;
                padding: 10px 6px;
                font-size: 0.85em;
                border-radius: 10px;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2px;
            }

            /* Add padding to body so content isn't hidden behind fixed tabs */
            body {
                padding-bottom: 80px;
            }

            /* Content area adjustments */
            .content-wrapper {
                padding: 14px;
            }

            /* Header compact */
            .header {
                padding: 20px 14px 16px;
            }
            .header h1 {
                font-size: 2.2em;
            }
            .header p {
                font-size: 1.1em;
            }

            /* Section titles */
            .section-title {
                font-size: 1.8em;
                margin-bottom: 14px;
            }

            /* Sub-nav scrollable horizontal */
            .sub-nav {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                gap: 6px;
                margin-bottom: 16px;
                padding-bottom: 4px;
            }
            .sub-nav::-webkit-scrollbar { display: none; }
            .sub-nav-btn {
                padding: 8px 14px;
                font-size: 1em;
                flex-shrink: 0;
            }

            /* Home cards grid */
            .home-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            .home-card {
                padding: 14px;
            }
            .home-card-icon { font-size: 1.8em; }
            .home-card-title { font-size: 1.15em; }
            .home-card-desc { font-size: 0.85em; }

            /* Event countdowns */
            .event-countdowns {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            .event-card { padding: 14px 10px; }

            /* Prayer times grid */
            .prayer-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 8px;
            }

            /* Quran surah grid - 2 columns on mobile */
            .surah-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            .surah-card {
                padding: 14px 16px;
                gap: 10px;
            }
            .surah-card-num {
                min-width: 38px;
                height: 38px;
                font-size: 1em;
            }
            .surah-card-name { font-size: 1.15em; }
            .surah-card-meta { font-size: 0.85em; }

            /* Quran reader */
            .surah-para {
                padding: 16px 14px;
                font-size: 1.4em;
                line-height: 2.2;
            }
            .r-title2 h3 { font-size: 1.6em; }
            .r-btn2 {
                padding: 8px 14px;
                font-size: 1em;
            }
            .r-nav2 { gap: 6px; }

            /* Ayah popup - full width on mobile */
            .ayah-popup {
                left: 10px;
                right: 10px;
                transform: translateY(80px);
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
                padding: 12px 14px;
            }
            .ayah-popup.show {
                transform: translateY(0);
            }
            .ayah-popup-btn {
                padding: 10px 14px;
                font-size: 1em;
                min-height: 44px;
            }

            /* Tafseer panel */
            .tafseer-panel { max-height: 85vh; }
            .tafseer-body { font-size: 1.15em; padding: 16px; }
            .tafseer-tabs { padding: 8px 12px; }

            /* Dua cards */
            .dua-text {
                font-size: 1.4em;
                padding: 14px;
            }
            .dua-card {
                padding: 16px;
            }

            /* Quran search */
            .quran-search {
                padding: 12px 16px;
                font-size: 1.1em;
            }

            /* Filters */
            .q-filters2 {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                gap: 6px;
            }
            .q-filters2::-webkit-scrollbar { display: none; }
            .q-filter2 {
                padding: 8px 12px;
                font-size: 1em;
                flex-shrink: 0;
            }

            /* Khatm tracker */
            .khatm-juz-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 6px;
            }
            .khatm-juz { font-size: 0.85em; padding: 8px 2px; }
            .khatm-stats { gap: 8px; }
            .khatm-stat { padding: 10px 6px; }
            .khatm-stat-num { font-size: 1.3em; }

            /* Hifz tracker */
            .hifz-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 4px;
            }
            .hifz-cell {
                padding: 6px 2px;
                font-size: 0.65em;
                min-height: 40px;
            }
            .hifz-stats { grid-template-columns: repeat(2, 1fr); gap: 6px; }
            .hifz-legend { gap: 8px; font-size: 0.85em; }

            /* Reading history */
            .reading-stats-row { gap: 6px; }
            .reading-stat-card { padding: 10px 6px; }
            .reading-stat-num { font-size: 1.2em; }
            .streak-num { font-size: 1.8em; }

            /* Juz grid */
            .juz-grid { grid-template-columns: repeat(3, 1fr); }

            /* Hijri calendar */
            .hijri-cal-day { padding: 8px 2px; font-size: 0.85em; }

            /* Qibla compass */
            .qibla-compass { width: 220px; height: 220px; }

            /* Tasbeeh touch-friendly */
            #tasbeehBtn {
                min-width: 180px !important;
                min-height: 180px !important;
            }

            /* 99 Names grid */
            .names-grid {
                grid-template-columns: repeat(2, 1fr) !important;
            }

            /* Reading controls */
            .reading-controls {
                top: 8px;
                left: 8px;
                gap: 4px;
            }
            .rc-btn {
                width: 34px;
                height: 34px;
                font-size: 0.95em;
            }

            /* Scroll to top */
            .scroll-top-btn {
                bottom: 85px;
                left: 16px;
                width: 42px;
                height: 42px;
            }

            /* Habit tracker */
            .habit-item { padding: 14px 16px; }
            .habit-name { font-size: 1.25em; }

            /* Last read card */
            .last-read-card { padding: 14px 16px; }

            /* Bookmark chips */
            .bm-chip { padding: 6px 10px; font-size: 0.95em; }

            /* Ramadan calendar scroll */
            .ramadan-cal-scroll {
                -webkit-overflow-scrolling: touch;
            }
            .ramadan-cal-table { font-size: 0.85em; }
            .ramadan-cal-table th,
            .ramadan-cal-table td { padding: 8px 6px; }

            /* Bismillah box */
            .bismillah-box2 { font-size: 1.6em; padding: 16px; }

            /* Touch targets - minimum 44px as per Apple HIG */
            button, [onclick], .surah-card, .bm-chip, .khatm-juz, .hifz-cell,
            .history-item, .sub-nav-btn, .q-filter2 {
                min-height: 44px;
            }
        }

        /* Larger phones (iPhone Pro Max) - specific optimizations */
        @media (min-width: 390px) and (max-width: 480px) {
            .surah-grid { grid-template-columns: 1fr; }
            .home-grid { grid-template-columns: repeat(2, 1fr); }
            .hifz-grid { grid-template-columns: repeat(6, 1fr); }
            .khatm-juz-grid { grid-template-columns: repeat(6, 1fr); }
        }

        /* Prevent text scaling on iOS rotation */
        @media (max-width: 768px) {
            html {
                -webkit-text-size-adjust: 100%;
                text-size-adjust: 100%;
            }
        }

        /* Dark mode handling for notch/dynamic island area */
        @media (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top, 0);
            }
            .header {
                padding-top: calc(20px + env(safe-area-inset-top, 0));
            }
        }

        /* Smooth scrolling for iOS */
        * {
            -webkit-overflow-scrolling: touch;
        }

        /* Prevent rubber banding revealing white background */
        html {
            background: var(--night-deep);
        }

        /* In-App Prayer Notification Banner */
        .prayer-notif {
            position: fixed;
            top: -120px;
            left: 12px;
            right: 12px;
            z-index: 10000;
            background: linear-gradient(135deg, rgba(26,92,58,0.98), rgba(39,174,96,0.95));
            border: 1px solid rgba(46,204,113,0.5);
            border-radius: 16px;
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 14px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4), 0 0 20px rgba(46,204,113,0.2);
            transition: top 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        .prayer-notif.show {
            top: calc(12px + env(safe-area-inset-top, 0px));
        }
        .prayer-notif-icon {
            font-size: 2.2em;
            flex-shrink: 0;
        }
        .prayer-notif-body { flex: 1; }
        .prayer-notif-title {
            font-family: 'Scheherazade New', serif;
            font-size: 1.3em;
            color: #fff;
            font-weight: 700;
        }
        .prayer-notif-text {
            font-family: 'Amiri', serif;
            font-size: 1em;
            color: rgba(255,255,255,0.85);
            margin-top: 2px;
        }
        .prayer-notif-close {
            width: 32px; height: 32px; border-radius: 50%;
            border: none; background: rgba(255,255,255,0.15);
            color: #fff; font-size: 1.1em; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0;
        }
        .prayer-notif-close:hover { background: rgba(255,255,255,0.25); }

        /* iOS Install Prompt */
        .ios-install-prompt {
            position: fixed;
            bottom: -200px;
            left: 12px;
            right: 12px;
            z-index: 10000;
            background: linear-gradient(135deg, var(--night-soft), var(--night-mid));
            border: 1px solid rgba(212,175,55,0.3);
            border-radius: 16px;
            padding: 18px 20px;
            box-shadow: 0 -4px 25px rgba(0,0,0,0.5);
            transition: bottom 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
        }
        .ios-install-prompt.show { bottom: calc(90px + env(safe-area-inset-bottom, 0px)); }
        .ios-install-title {
            font-family: 'Scheherazade New', serif;
            font-size: 1.3em; color: var(--gold-bright); margin-bottom: 8px;
        }
        .ios-install-text {
            font-family: 'Amiri', serif;
            font-size: 1em; color: var(--cream-soft); line-height: 1.6; margin-bottom: 12px;
        }
        .ios-install-steps {
            font-size: 0.95em; color: var(--text-muted); line-height: 1.8;
        }
        .ios-install-dismiss {
            margin-top: 12px; padding: 10px 24px; border-radius: 10px;
            border: 1px solid rgba(212,175,55,0.3); background: transparent;
            color: var(--gold-soft); font-family: 'Amiri', serif; font-size: 1em;
            cursor: pointer;
        }
        .ios-install-dismiss:hover { background: rgba(212,175,55,0.1); }

        /* Notification settings panel */
        .notif-settings {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            z-index: 10001;
            background: linear-gradient(135deg, var(--night-soft), var(--night-deep));
            border: 1px solid rgba(212,175,55,0.3);
            border-radius: 20px;
            padding: 24px;
            width: min(360px, 90vw);
            box-shadow: 0 15px 50px rgba(0,0,0,0.6);
            opacity: 0; pointer-events: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .notif-settings.show { opacity: 1; pointer-events: auto; transform: translate(-50%, -50%) scale(1); }
        .notif-settings-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6);
            z-index: 10000; opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .notif-settings-overlay.show { opacity: 1; pointer-events: auto; }
        .notif-settings h3 {
            font-family: 'Scheherazade New', serif; font-size: 1.5em;
            color: var(--gold-bright); text-align: center; margin-bottom: 16px;
        }
        .notif-option {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .notif-option:last-child { border-bottom: none; }
        .notif-option-label {
            font-family: 'Amiri', serif; font-size: 1.1em; color: var(--cream-soft);
        }
        .notif-toggle {
            width: 48px; height: 28px; border-radius: 14px; border: none;
            background: rgba(255,255,255,0.1); cursor: pointer; position: relative;
            transition: background 0.3s;
        }
        .notif-toggle.on { background: var(--gold-warm); }
        .notif-toggle::after {
            content: ''; position: absolute; top: 3px; left: 3px;
            width: 22px; height: 22px; border-radius: 50%; background: #fff;
            transition: transform 0.3s;
        }
        .notif-toggle.on::after { transform: translateX(20px); }
        .notif-volume {
            display: flex; align-items: center; gap: 10px; margin-top: 14px;
            padding: 12px 0;
        }
        .notif-volume-label { font-family: 'Amiri', serif; color: var(--cream-soft); font-size: 1em; flex-shrink: 0; }
        .notif-volume input[type="range"] {
            flex: 1; accent-color: var(--gold-warm);
        }
        .notif-test-btn {
            width: 100%; margin-top: 16px; padding: 12px;
            border-radius: 12px; border: none; cursor: pointer;
            background: linear-gradient(135deg, var(--gold-warm), var(--gold-bright));
            color: var(--night-deep); font-family: 'Amiri', serif;
            font-size: 1.1em; font-weight: 600;
        }
        .notif-test-btn:hover { box-shadow: var(--glow-gold); }

    </style>
</head>
<body>

<!-- Animated Stars Background -->
<div class="stars-container" id="stars"></div>

<!-- Islamic Pattern Overlay -->
<div class="pattern-overlay"></div>

<!-- Scroll to Top Button -->
<div class="reading-controls">
    <button class="rc-btn" onclick="toggleNightMode()" id="nightModeBtn" title="الوضع الليلي">🌙</button>
    <button class="rc-btn" onclick="changeFontSize(1)" title="تكبير الخط">A+</button>
    <button class="rc-btn" onclick="changeFontSize(-1)" title="تصغير الخط">A-</button>
    <button class="rc-btn" onclick="openNotifSettings()" id="notifBtn" title="إشعارات الصلاة">🔔</button>
</div>
<button class="scroll-top-btn" id="scrollTopBtn" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="العودة للأعلى">↑</button>

<!-- In-App Prayer Notification Banner (iOS compatible) -->
<div class="prayer-notif" id="prayerNotif">
    <div class="prayer-notif-icon">🕌</div>
    <div class="prayer-notif-body">
        <div class="prayer-notif-title" id="prayerNotifTitle">حان وقت الصلاة</div>
        <div class="prayer-notif-text" id="prayerNotifText"></div>
    </div>
    <button class="prayer-notif-close" onclick="dismissPrayerNotif()">✕</button>
</div>

<!-- Notification Settings Panel -->
<div class="notif-settings-overlay" id="notifOverlay" onclick="closeNotifSettings()"></div>
<div class="notif-settings" id="notifSettings">
    <h3>🔔 إعدادات الإشعارات</h3>
    <div class="notif-option">
        <span class="notif-option-label">صلاة الفجر</span>
        <button class="notif-toggle" id="notifFajr" onclick="togglePrayerNotif('Fajr')"></button>
    </div>
    <div class="notif-option">
        <span class="notif-option-label">صلاة الظهر</span>
        <button class="notif-toggle" id="notifDhuhr" onclick="togglePrayerNotif('Dhuhr')"></button>
    </div>
    <div class="notif-option">
        <span class="notif-option-label">صلاة العصر</span>
        <button class="notif-toggle" id="notifAsr" onclick="togglePrayerNotif('Asr')"></button>
    </div>
    <div class="notif-option">
        <span class="notif-option-label">صلاة المغرب</span>
        <button class="notif-toggle" id="notifMaghrib" onclick="togglePrayerNotif('Maghrib')"></button>
    </div>
    <div class="notif-option">
        <span class="notif-option-label">صلاة العشاء</span>
        <button class="notif-toggle" id="notifIsha" onclick="togglePrayerNotif('Isha')"></button>
    </div>
    <div class="notif-volume">
        <span class="notif-volume-label">🔊 الصوت</span>
        <input type="range" id="notifVolume" min="0" max="100" value="70" oninput="setNotifVolume(this.value)">
    </div>
    <button class="notif-test-btn" onclick="testPrayerNotif()">🔔 تجربة الإشعار</button>
</div>

<!-- iOS Install Prompt -->
<div class="ios-install-prompt" id="iosInstallPrompt">
    <div class="ios-install-title">📱 أضف التطبيق للشاشة الرئيسية</div>
    <div class="ios-install-text">للحصول على تجربة أفضل وإشعارات الصلاة</div>
    <div class="ios-install-steps">
        1. اضغط على <strong>مشاركة</strong> ⬆️ في أسفل المتصفح<br>
        2. اختر <strong>"إضافة إلى الشاشة الرئيسية"</strong><br>
        3. اضغط <strong>"إضافة"</strong>
    </div>
    <button class="ios-install-dismiss" onclick="dismissIosPrompt()">فهمت ✓</button>
</div>

<!-- Ayah Action Popup -->
<div class="ayah-popup" id="ayahPopup">
    <span class="ayah-popup-text" id="ayahPopupLabel"></span>
    <button class="ayah-popup-btn tafseer" onclick="openTafseer()">تفسير</button>
    <button class="ayah-popup-btn save" id="ayahPopupSave" onclick="saveSelectedAyah()">حفظ 🔖</button>
    <button class="ayah-popup-btn resume" id="ayahPopupResume" onclick="resumeFromSelected()">متابعة من هنا</button>
    <button class="ayah-popup-btn close" onclick="hideAyahPopup()">✕</button>
</div>

<!-- Tafseer Panel -->
<div class="tafseer-overlay" id="tafseerOverlay" onclick="closeTafseer()"></div>
<div class="tafseer-panel" id="tafseerPanel">
    <div class="tafseer-header">
        <div class="tafseer-title" id="tafseerTitle">تفسير</div>
        <button class="tafseer-close" onclick="closeTafseer()">✕</button>
    </div>
    <div class="tafseer-tabs" id="tafseerTabs">
        <button class="tafseer-tab active" onclick="switchTafseer('ar-tafseer-al-saddi',this)">السعدي</button>
        <button class="tafseer-tab" onclick="switchTafseer('ar-tafsir-ibn-kathir',this)">ابن كثير</button>
        <button class="tafseer-tab" onclick="switchTafseer('ar-tafsir-muyassar',this)">الميسر</button>
        <button class="tafseer-tab" onclick="switchTafseer('ar-tafseer-al-qurtubi',this)">القرطبي</button>
        <button class="tafseer-tab" onclick="switchTafseer('ar-tafsir-al-baghawi',this)">البغوي</button>
        <button class="tafseer-tab" onclick="switchTafseer('ar-tafsir-al-tabari',this)">الطبري</button>
    </div>
    <div class="tafseer-body" id="tafseerBody">
        <div class="tafseer-loading">اختر آية لعرض التفسير</div>
    </div>
</div>

<div class="container">
    <div class="header">
        <h1>📖 أذكار وأدعية إسلامية شاملة</h1>
        <div class="ornament">
            <span class="ornament-line"></span>
            <span class="ornament-symbol">❋</span>
            <span class="ornament-line"></span>
        </div>
        <p>رفيقك الإسلامي الشامل - Complete Muslim Companion</p>
    </div>

    <div class="tabs-nav">
        <button class="tab-btn active" onclick="switchTab('tabHome', this)">🏠 الرئيسية</button>
        <button class="tab-btn" onclick="switchTab('tabAthkar', this)">🤲 الأذكار</button>
        <button class="tab-btn" onclick="switchTab('tabDuas', this)">📿 الأدعية</button>
        <button class="tab-btn" onclick="switchTab('tab7', this)">📖 القرآن</button>
        <button class="tab-btn" onclick="switchTab('tabTools', this)">🛠️ أدوات</button>
    </div>

    <div class="content-wrapper">
        <!-- HOME TAB -->
        <div id="tabHome" class="content-area active">
            <h2 class="section-title">بسم الله الرحمن الرحيم</h2>
            <div id="hijriDate" style="text-align:center;font-size:1.3em;color:var(--gold-soft);margin-bottom:20px;font-family:'Scheherazade New',serif"></div>

            <!-- Event Countdowns -->
            <div class="event-countdowns" id="eventCountdowns">
                <div class="event-card" id="eventRamadan">
                    <div class="event-card-icon">🌙</div>
                    <div class="event-card-name">رمضان</div>
                    <div class="event-card-days" id="ramadanDays">--</div>
                    <div class="event-card-label" id="ramadanLabel">يوم متبقي</div>
                    <div class="event-card-date" id="ramadanDate"></div>
                </div>
                <div class="event-card" id="eventFitr">
                    <div class="event-card-icon">🎉</div>
                    <div class="event-card-name">عيد الفطر</div>
                    <div class="event-card-days" id="fitrDays">--</div>
                    <div class="event-card-label" id="fitrLabel">يوم متبقي</div>
                    <div class="event-card-date" id="fitrDate"></div>
                </div>
                <div class="event-card" id="eventAdha">
                    <div class="event-card-icon">🕋</div>
                    <div class="event-card-name">عيد الأضحى</div>
                    <div class="event-card-days" id="adhaDays">--</div>
                    <div class="event-card-label" id="adhaLabel">يوم متبقي</div>
                    <div class="event-card-date" id="adhaDate"></div>
                </div>
            </div>

            <!-- Live Prayer Countdown -->
            <div class="live-countdown-bar" id="liveCountdownBar">
                <div class="countdown-next-label">الصلاة القادمة</div>
                <div class="countdown-next-name" id="nextPrayerName">--</div>
                <div class="countdown-next-timer" id="nextPrayerTimer">--:--:--</div>
                <div class="countdown-fasting" id="fastingInfo">
                    <div class="fasting-item">
                        <div class="fasting-label">مدة الصيام</div>
                        <div class="fasting-value" id="fastingDuration">--</div>
                    </div>
                    <div class="fasting-item">
                        <div class="fasting-label">باقي للمغرب</div>
                        <div class="fasting-value" id="maghribRemaining">--</div>
                    </div>
                    <div class="fasting-item">
                        <div class="fasting-label">باقي للفجر</div>
                        <div class="fasting-value" id="fajrRemaining">--</div>
                    </div>
                </div>
            </div>

            <div class="home-grid">
                <div class="home-card" onclick="switchTab('tabAthkar',document.querySelectorAll('.tab-btn')[1])">
                    <div class="home-card-icon">🤲</div>
                    <div class="home-card-title">الأذكار</div>
                    <div class="home-card-desc">أذكار الاستيقاظ والصباح والمساء والنوم وبعد الصلاة</div>
                </div>
                <div class="home-card" onclick="switchTab('tabDuas',document.querySelectorAll('.tab-btn')[2])">
                    <div class="home-card-icon">📿</div>
                    <div class="home-card-title">الأدعية</div>
                    <div class="home-card-desc">أدعية الرزق والأدعية القرآنية والرقية الشرعية</div>
                </div>
                <div class="home-card" onclick="switchTab('tab7',document.querySelectorAll('.tab-btn')[3])">
                    <div class="home-card-icon">📖</div>
                    <div class="home-card-title">القرآن الكريم</div>
                    <div class="home-card-desc">تصفح جميع السور مع حفظ موضع القراءة</div>
                </div>
                <div class="home-card" onclick="switchTab('tabTools',document.querySelectorAll('.tab-btn')[4])">
                    <div class="home-card-icon">🛠️</div>
                    <div class="home-card-title">أدوات</div>
                    <div class="home-card-desc">مواقيت الصلاة وعداد التسبيح وأسماء الله الحسنى</div>
                </div>
            </div>

            <div class="section-title" style="font-size:1.6em;margin-top:30px">آية اليوم</div>
            <div class="dua-card" id="dailyAyah" style="text-align:center">
                <div class="dua-text" id="dailyAyahText" style="font-size:1.5em;line-height:2.2">جاري التحميل...</div>
                <div class="dua-source" id="dailyAyahRef"></div>
            </div>

            <div class="section-title" style="font-size:1.6em;margin-top:20px">حديث اليوم</div>
            <div class="hadith-card" id="dailyHadith">
                <div class="hadith-text" id="dailyHadithText">جاري التحميل...</div>
                <div class="hadith-ref" id="dailyHadithRef"></div>
            </div>

            <div class="section-title" style="font-size:1.6em;margin-top:20px">مواقيت الصلاة</div>
            <div class="prayer-grid" id="homePrayerGrid">
                <div class="prayer-card"><div class="prayer-card-name">الفجر</div><div class="prayer-card-time" id="homeFajr">--:--</div></div>
                <div class="prayer-card"><div class="prayer-card-name">الشروق</div><div class="prayer-card-time" id="homeSunrise">--:--</div></div>
                <div class="prayer-card"><div class="prayer-card-name">الظهر</div><div class="prayer-card-time" id="homeDhuhr">--:--</div></div>
                <div class="prayer-card"><div class="prayer-card-name">العصر</div><div class="prayer-card-time" id="homeAsr">--:--</div></div>
                <div class="prayer-card"><div class="prayer-card-name">المغرب</div><div class="prayer-card-time" id="homeMaghrib">--:--</div></div>
                <div class="prayer-card"><div class="prayer-card-name">العشاء</div><div class="prayer-card-time" id="homeIsha">--:--</div></div>
            </div>
        </div>

        <!-- ATHKAR TAB (all athkar consolidated) -->
        <div id="tabAthkar" class="content-area">
            <h2 class="section-title">الأذكار</h2>
            <div class="sub-nav">
                <button class="sub-nav-btn active" onclick="switchSub('tabAthkar','athkar-wake',this)">الاستيقاظ</button>
                <button class="sub-nav-btn" onclick="switchSub('tabAthkar','athkar-morning',this)">الصباح</button>
                <button class="sub-nav-btn" onclick="switchSub('tabAthkar','athkar-evening',this)">المساء</button>
                <button class="sub-nav-btn" onclick="switchSub('tabAthkar','athkar-sleep',this)">النوم</button>
                <button class="sub-nav-btn" onclick="switchSub('tabAthkar','athkar-prayer',this)">بعد الصلاة</button>
            </div>

            <!-- Sub: Wake up athkar (existing tab1 content) -->
            <div id="athkar-wake" class="sub-section active">
            <h2 class="section-title">أذكار الاستيقاظ من النوم</h2>

            <div class="dua-card">
                <div class="dua-number">1</div>
                <div class="dua-text">الحمد لله الذي أحيانا بعد ما أماتنا، وإليه النشور</div>
                <div class="dua-source"><strong>المصدر:</strong> صحيح البخاري مع الفتح، ١١/ ١١٣، برقم ٦٣١٤، وصحيح مسلم، ٤/ ٢٠٨٣، برقم ٢٧١١</div>
            </div>

            <div class="dua-card">
                <div class="dua-number">2</div>
                <div class="dua-text">لا إله إلا الله وحده لا شريك له، له الملك وله الحمد، وهو على كل شيء قدير، سبحان الله، والحمد لله، ولا إله إلا الله، والله أكبر، ولا حول ولا قوة إلا بالله العلي العظيم، رب اغفر لي</div>
                <div class="benefits">
                    <strong>الفائدة:</strong> من قال ذلك غُفِرَ له، فإن دعا استجيب له، فإن قام فتوضأ ثم صلى قُبلت صلاته
                </div>
                <div class="dua-source"><strong>المصدر:</strong> البخاري مع الفتح، ٣/ ٣٩، برقم ١١٥٤، وابن ماجه</div>
            </div>

            <div class="dua-card">
                <div class="dua-number">3</div>
                <div class="dua-text">الحمد لله الذي عافاني في جسدي، ورد علي روحي، وأذن لي بذكره</div>
                <div class="dua-source"><strong>المصدر:</strong> سنن الترمذي، ٥/ ٤٧٣، برقم ٣٤٠١</div>
            </div>

            <div class="dua-card">
                <div class="dua-number">4</div>
                <div class="dua-text">﴿إن في خلق السموات والأرض واختلاف الليل والنهار لآيات لأولي الألباب * الذين يذكرون الله قياما وقعودا وعلى جنوبهم ويتفكرون في خلق السموات والأرض ربنا ما خلقت هذا باطلا سبحانك فقنا عذاب النار* ربنا إنك من تدخل النار فقد أخزيته وما للظالمين من أنصار* ربنا إننا سمعنا مناديا ينادي للإيمان أن آمنوا بربكم فآمنا ربنا فاغفر لنا ذنوبنا وكفر عنا سيئاتنا وتوفنا مع الأبرار* ربنا وآتنا ما وعدتنا على رسلك ولا تخزنا يوم القيامة إنك لا تخلف الميعاد* فاستجاب لهم ربهم أني لا أضيع عمل عامل منكم من ذكر أو أنثى بعضكم من بعض فالذين هاجروا وأخرجوا من ديارهم وأوذوا في سبيلي وقاتلوا وقتلوا لأكفرن عنهم سيئاتهم ولأدخلنهم جنات تجري من تحتها الأنهار ثوابا من عند الله والله عنده حسن الثواب * لا يغرنك تقلب الذين كفروا في البلاد * متاع قليل ثم مأواهم جهنم وبئس المهاد * لكن الذين اتقوا ربهم لهم جنات تجري من تحتها الأنهار خالدين فيها نزلا من عند الله وما عند الله خير للأبرار * وإن من أهل الكتاب لمن يؤمن بالله وما أنزل إليكم ومآ أنزل إليهم خاشعين لله لا يشترون بآيات الله ثمنا قليلا أولئك لهم أجرهم عند ربهم إن الله سريع الحساب*يا أيها الذين آمنوا اصبروا وصابروا ورابطوا واتقوا الله لعلكم تفلحون﴾</div>
                <div class="dua-source"><strong>المصدر:</strong> آيات من سورة آل عمران (190-200)، البخاري ومسلم</div>
            </div>
            </div><!-- end athkar-wake -->

            <!-- Sub: Morning athkar (existing tab2 content) -->
            <div id="athkar-morning" class="sub-section">
            <h2 class="section-title">أذكار الصباح</h2>

            <div class="intro-box">
                <strong>مقدمة مهمة:</strong> أذكار الصباح هي من أعظم الحصون التي يتقي بها المسلم شرور يومه. رُوي عن رسول الله صلى الله عليه وسلم أنه كان يقول هذه الأذكار كل صباح. استمع لها بقلب حاضر واستشعر معانيها.
            </div>

            <div class="dua-card">
                <div class="dua-number">1</div>
                <div class="dua-text">أَعُوذُ بِاللهِ مِنْ الشَّيْطَانِ الرَّجِيمِ</div>
                <div class="counter-display">👆 <span class="dua-counter">1</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">2</div>
                <div class="dua-text">اللّهُ لاَ إِلَـهَ إِلاَّ هُوَ الْحَيُّ الْقَيُّومُ لاَ تَأْخُذُهُ سِنَةٌ وَلاَ نَوْمٌ لَّهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الأَرْضِ مَن ذَا الَّذِي يَشْفَعُ عِنْدَهُ إِلاَّ بِإِذْنِهِ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ وَلاَ يُحِيطُونَ بِشَيْءٍ مِّنْ عِلْمِهِ إِلاَّ بِمَا شَاء وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالأَرْضَ وَلاَ يَؤُودُهُ حِفْظُهُمَا وَهُوَ الْعَلِيُّ الْعَظِيمُ</div>
                <div class="benefits"><strong>الفائدة:</strong> من قالها حين يصبح أجير من الجن حتى يمسى ومن قالها حين يمسى أجير من الجن حتى يصبح</div>
                <div class="counter-display">👆 <span class="dua-counter">1</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">3</div>
                <div class="dua-text">بِسْمِ اللهِ الرَّحْمنِ الرَّحِيم ❋ قُلْ هُوَ ٱللَّهُ أَحَدٌ، ٱللَّهُ ٱلصَّمَدُ، لَمْ يَلِدْ وَلَمْ يُولَدْ، وَلَمْ يَكُن لَّهُۥ كُفُوًا أَحَدٌۢ</div>
                <div class="benefits"><strong>الفائدة:</strong> من قالها حين يصبح وحين يمسى كفته من كل شىء (الإخلاص والمعوذتين)</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">4</div>
                <div class="dua-text">بِسْمِ اللهِ الرَّحْمنِ الرَّحِيم ❋ قُلْ أَعُوذُ بِرَبِّ ٱلْفَلَقِ، مِن شَرِّ مَا خَلَقَ، وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ، وَمِن شَرِّ ٱلنَّفَّٰثَٰتِ فِى ٱلْعُقَدِ، وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">5</div>
                <div class="dua-text">بِسْمِ اللهِ الرَّحْمنِ الرَّحِيم ❋ قُلْ أَعُوذُ بِرَبِّ ٱلنَّاسِ، مَلِكِ ٱلنَّاسِ، إِلَٰهِ ٱلنَّاسِ، مِن شَرِّ ٱلْوَسْوَاسِ ٱلْخَنَّاسِ، ٱلَّذِى يُوَسْوِسُ فِى صُدُورِ ٱلنَّاسِ، مِنَ ٱلْجِنَّةِ وَٱلنَّاسِ</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">6</div>
                <div class="dua-text">أَصْـبَحْنا وَأَصْـبَحَ المُـلْكُ لله وَالحَمدُ لله ، لا إلهَ إلاّ اللّهُ وَحدَهُ لا شَريكَ لهُ، لهُ المُـلكُ ولهُ الحَمْـد، وهُوَ على كلّ شَيءٍ قدير ، رَبِّ أسْـأَلُـكَ خَـيرَ ما في هـذا اليوم وَخَـيرَ ما بَعْـدَه ، وَأَعـوذُ بِكَ مِنْ شَـرِّ ما في هـذا اليوم وَشَرِّ ما بَعْـدَه، رَبِّ أَعـوذُبِكَ مِنَ الْكَسَـلِ وَسـوءِ الْكِـبَر ، رَبِّ أَعـوذُ بِكَ مِنْ عَـذابٍ في النّـارِ وَعَـذابٍ في القَـبْر</div>
                <div class="counter-display">👆 <span class="dua-counter">1</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">7</div>
                <div class="dua-text">اللّهـمَّ أَنْتَ رَبِّـي لا إلهَ إلاّ أَنْتَ ، خَلَقْتَنـي وَأَنا عَبْـدُك ، وَأَنا عَلـى عَهْـدِكَ وَوَعْـدِكَ ما اسْتَـطَعْـت ، أَعـوذُبِكَ مِنْ شَـرِّ ما صَنَـعْت ، أَبـوءُ لَـكَ بِنِعْـمَتِـكَ عَلَـيَّ وَأَبـوءُ بِذَنْـبي فَاغْفـِرْ لي فَإِنَّـهُ لا يَغْـفِرُ الذُّنـوبَ إِلاّ أَنْتَ</div>
                <div class="benefits"><strong>الفائدة:</strong> من قالها موقنا بها حين يمسى ومات من ليلته دخل الجنة وكذلك حين يصبح</div>
                <div class="counter-display">👆 <span class="dua-counter">1</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">8</div>
                <div class="dua-text">رَضيـتُ بِاللهِ رَبَّـاً وَبِالإسْلامِ ديـناً وَبِمُحَـمَّدٍ صلى الله عليه وسلم نَبِيّـاً</div>
                <div class="benefits"><strong>الفائدة:</strong> من قالها حين يصبح وحين يمسى كان حقا على الله أن يرضيه يوم القيامة</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">9</div>
                <div class="dua-text">اللّهُـمَّ إِنِّـي أَصْبَـحْتُ أُشْـهِدُك ، وَأُشْـهِدُ حَمَلَـةَ عَـرْشِـك ، وَمَلَائِكَتَكَ ، وَجَمـيعَ خَلْـقِك ، أَنَّـكَ أَنْـتَ اللهُ لا إلهَ إلاّ أَنْـتَ وَحْـدَكَ لا شَريكَ لَـك ، وَأَنَّ ُ مُحَمّـداً عَبْـدُكَ وَرَسـولُـك</div>
                <div class="benefits"><strong>الفائدة:</strong> من قالها أعتقه الله من النار</div>
                <div class="counter-display">👆 <span class="dua-counter">4</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">10</div>
                <div class="dua-text">اللّهُـمَّ ما أَصْبَـَحَ بي مِـنْ نِعْـمَةٍ أَو بِأَحَـدٍ مِـنْ خَلْـقِك ، فَمِـنْكَ وَحْـدَكَ لا شريكَ لَـك ، فَلَـكَ الْحَمْـدُ وَلَـكَ الشُّكْـر</div>
                <div class="benefits"><strong>الفائدة:</strong> من قالها حين يصبح أدى شكر يومه</div>
                <div class="counter-display">👆 <span class="dua-counter">1</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">11</div>
                <div class="dua-text">حَسْبِـيَ اللّهُ لا إلهَ إلاّ هُوَ عَلَـيهِ تَوَكَّـلتُ وَهُوَ رَبُّ العَرْشِ العَظـيم</div>
                <div class="benefits"><strong>الفائدة:</strong> من قالها كفاه الله ما أهمه من أمر الدنيا والأخرة</div>
                <div class="counter-display">👆 <span class="dua-counter">7</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">12</div>
                <div class="dua-text">بِسـمِ اللهِ الذي لا يَضُـرُّ مَعَ اسمِـهِ شَيءٌ في الأرْضِ وَلا في السّمـاءِ وَهـوَ السّمـيعُ العَلـيم</div>
                <div class="benefits"><strong>الفائدة:</strong> لم يضره من الله شيء</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">13</div>
                <div class="dua-text">اللّهُـمَّ بِكَ أَصْـبَحْنا وَبِكَ أَمْسَـينا ، وَبِكَ نَحْـيا وَبِكَ نَمُـوتُ وَإِلَـيْكَ النُّـشُور</div>
                <div class="counter-display">👆 <span class="dua-counter">1</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">14</div>
                <div class="dua-text">أَصْبَـحْـنا عَلَى فِطْرَةِ الإسْلاَمِ، وَعَلَى كَلِمَةِ الإِخْلاَصِ، وَعَلَى دِينِ نَبِيِّنَا مُحَمَّدٍ صَلَّى اللهُ عَلَيْهِ وَسَلَّمَ، وَعَلَى مِلَّةِ أَبِينَا إبْرَاهِيمَ حَنِيفاً مُسْلِماً وَمَا كَانَ مِنَ المُشْرِكِينَ</div>
                <div class="counter-display">👆 <span class="dua-counter">1</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">15</div>
                <div class="dua-text">سُبْحـانَ اللهِ وَبِحَمْـدِهِ عَدَدَ خَلْـقِه ، وَرِضـا نَفْسِـه ، وَزِنَـةَ عَـرْشِـه ، وَمِـدادَ كَلِمـاتِـه</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">16</div>
                <div class="dua-text">اللّهُـمَّ عافِـني في بَدَنـي ، اللّهُـمَّ عافِـني في سَمْـعي ، اللّهُـمَّ عافِـني في بَصَـري ، لا إلهَ إلاّ أَنْـتَ</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">17</div>
                <div class="dua-text">اللّهُـمَّ إِنّـي أَعـوذُ بِكَ مِنَ الْكُـفر ، وَالفَـقْر ، وَأَعـوذُ بِكَ مِنْ عَذابِ القَـبْر ، لا إلهَ إلاّ أَنْـتَ</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">18</div>
                <div class="dua-text">اللّهُـمَّ إِنِّـي أسْـأَلُـكَ العَـفْوَ وَالعـافِـيةَ في الدُّنْـيا وَالآخِـرَة ، اللّهُـمَّ إِنِّـي أسْـأَلُـكَ العَـفْوَ وَالعـافِـيةَ في ديني وَدُنْـيايَ وَأهْـلي وَمالـي ، اللّهُـمَّ اسْتُـرْ عـوْراتي وَآمِـنْ رَوْعاتـي ، اللّهُـمَّ احْفَظْـني مِن بَـينِ يَدَيَّ وَمِن خَلْفـي وَعَن يَمـيني وَعَن شِمـالي ، وَمِن فَوْقـي ، وَأَعـوذُ بِعَظَمَـتِكَ أَن أُغْـتالَ مِن تَحْتـي</div>
                <div class="counter-display">👆 <span class="dua-counter">1</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">19</div>
                <div class="dua-text">يَا حَيُّ يَا قيُّومُ بِرَحْمَتِكَ أسْتَغِيثُ أصْلِحْ لِي شَأنِي كُلَّهُ وَلاَ تَكِلْنِي إلَى نَفْسِي طَـرْفَةَ عَيْنٍ</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">20</div>
                <div class="dua-text">أَصْبَـحْـنا وَأَصْبَـحْ المُـلكُ للهِ رَبِّ العـالَمـين ، اللّهُـمَّ إِنِّـي أسْـأَلُـكَ خَـيْرَ هـذا الـيَوْم ، فَـتْحَهُ ، وَنَصْـرَهُ ، وَنـورَهُ وَبَـرَكَتَـهُ ، وَهُـداهُ ، وَأَعـوذُ بِـكَ مِـنْ شَـرِّ ما فـيهِ وَشَـرِّ ما بَعْـدَه</div>
                <div class="counter-display">👆 <span class="dua-counter">1</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">21</div>
                <div class="dua-text">اللّهُـمَّ عالِـمَ الغَـيْبِ وَالشّـهادَةِ فاطِـرَ السّماواتِ وَالأرْضِ رَبَّ كـلِّ شَـيءٍ وَمَليـكَه ، أَشْهَـدُ أَنْ لا إِلـهَ إِلاّ أَنْت ، أَعـوذُ بِكَ مِن شَـرِّ نَفْسـي وَمِن شَـرِّ الشَّيْـطانِ وَشِرْكِهِ ، وَأَنْ أَقْتَـرِفَ عَلـى نَفْسـي سوءاً أَوْ أَجُـرَّهُ إِلـى مُسْـلِم</div>
                <div class="counter-display">👆 <span class="dua-counter">1</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">22</div>
                <div class="dua-text">أَعـوذُ بِكَلِمـاتِ اللّهِ التّـامّـاتِ مِنْ شَـرِّ ما خَلَـق</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">23</div>
                <div class="dua-text">اللَّهُمَّ صَلِّ وَسَلِّمْ وَبَارِكْ على نَبِيِّنَا مُحمَّد</div>
                <div class="benefits"><strong>الفائدة:</strong> من صلى على حين يصبح وحين يمسى ادركته شفاعتى يوم القيامة</div>
                <div class="counter-display">👆 <span class="dua-counter">10</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">24</div>
                <div class="dua-text">اللَّهُمَّ إِنَّا نَعُوذُ بِكَ مِنْ أَنْ نُشْرِكَ بِكَ شَيْئًا نَعْلَمُهُ ، وَنَسْتَغْفِرُكَ لِمَا لَا نَعْلَمُهُ</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">25</div>
                <div class="dua-text">اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ الْهَمِّ وَالْحَزَنِ، وَأَعُوذُ بِكَ مِنْ الْعَجْزِ وَالْكَسَلِ، وَأَعُوذُ بِكَ مِنْ الْجُبْنِ وَالْبُخْلِ، وَأَعُوذُ بِكَ مِنْ غَلَبَةِ الدَّيْنِ، وَقَهْرِ الرِّجَالِ</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">26</div>
                <div class="dua-text">أسْتَغْفِرُ اللهَ العَظِيمَ الَّذِي لاَ إلَهَ إلاَّ هُوَ، الحَيُّ القَيُّومُ، وَأتُوبُ إلَيهِ</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">27</div>
                <div class="dua-text">يَا رَبِّ , لَكَ الْحَمْدُ كَمَا يَنْبَغِي لِجَلَالِ وَجْهِكَ , وَلِعَظِيمِ سُلْطَانِكَ</div>
                <div class="counter-display">👆 <span class="dua-counter">3</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">28</div>
                <div class="dua-text">اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا، وَرِزْقًا طَيِّبًا، وَعَمَلًا مُتَقَبَّلًا</div>
                <div class="counter-display">👆 <span class="dua-counter">1</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">29</div>
                <div class="dua-text">اللَّهُمَّ أَنْتَ رَبِّي لا إِلَهَ إِلا أَنْتَ ، عَلَيْكَ تَوَكَّلْتُ ، وَأَنْتَ رَبُّ الْعَرْشِ الْعَظِيمِ , مَا شَاءَ اللَّهُ كَانَ ، وَمَا لَمْ يَشَأْ لَمْ يَكُنْ ، وَلا حَوْلَ وَلا قُوَّةَ إِلا بِاللَّهِ الْعَلِيِّ الْعَظِيمِ , أَعْلَمُ أَنَّ اللَّهَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ ، وَأَنَّ اللَّهَ قَدْ أَحَاطَ بِكُلِّ شَيْءٍ عِلْمًا , اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ شَرِّ نَفْسِي ، وَمِنْ شَرِّ كُلِّ دَابَّةٍ أَنْتَ آخِذٌ بِنَاصِيَتِهَا ، إِنَّ رَبِّي عَلَى صِرَاطٍ مُسْتَقِيمٍ</div>
                <div class="counter-display">👆 <span class="dua-counter">1</span></div>
            </div>

            <div class="dua-card">
                <div class="dua-number">30</div>
                <div class="dua-text">لَا إلَه إلّا اللهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءِ قَدِيرِ</div>
                <div class="benefits"><strong>الفائدة:</strong> كانت له عدل عشر رقاب، وكتبت له مئة حسنة، ومحيت عنه مئة سيئة، وكانت له حرزا من الشيطان</div>
                <div class="counter-display">👆 <span class="dua-counter">100</span></div>
            </div>
            </div><!-- end athkar-morning -->

            <!-- Sub: Evening athkar -->
            <div id="athkar-evening" class="sub-section">
            <h2 class="section-title">أذكار المساء</h2>
            <div class="intro-box">تُقرأ أذكار المساء من بعد صلاة العصر إلى غروب الشمس</div>
            <div class="dua-card"><div class="dua-number">1</div><div class="dua-text">أَمْسَيْنَا وَأَمْسَى الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ، رَبِّ أَسْأَلُكَ خَيْرَ مَا فِي هَذِهِ اللَّيْلَةِ وَخَيْرَ مَا بَعْدَهَا، وَأَعُوذُ بِكَ مِنْ شَرِّ مَا فِي هَذِهِ اللَّيْلَةِ وَشَرِّ مَا بَعْدَهَا، رَبِّ أَعُوذُ بِكَ مِنَ الْكَسَلِ وَسُوءِ الْكِبَرِ، رَبِّ أَعُوذُ بِكَ مِنْ عَذَابٍ فِي النَّارِ وَعَذَابٍ فِي الْقَبْرِ</div><div class="dua-source"><strong>المصدر:</strong> صحيح مسلم</div></div>
            <div class="dua-card"><div class="dua-number">2</div><div class="dua-text">اللَّهُمَّ بِكَ أَمْسَيْنَا، وَبِكَ أَصْبَحْنَا، وَبِكَ نَحْيَا، وَبِكَ نَمُوتُ، وَإِلَيْكَ الْمَصِيرُ</div><div class="dua-source"><strong>المصدر:</strong> الترمذي</div></div>
            <div class="dua-card"><div class="dua-number">3</div><div class="dua-text">اللَّهُمَّ أَنْتَ رَبِّي لَا إِلَهَ إِلَّا أَنْتَ، خَلَقْتَنِي وَأَنَا عَبْدُكَ، وَأَنَا عَلَى عَهْدِكَ وَوَعْدِكَ مَا اسْتَطَعْتُ، أَعُوذُ بِكَ مِنْ شَرِّ مَا صَنَعْتُ، أَبُوءُ لَكَ بِنِعْمَتِكَ عَلَيَّ، وَأَبُوءُ بِذَنْبِي فَاغْفِرْ لِي فَإِنَّهُ لَا يَغْفِرُ الذُّنُوبَ إِلَّا أَنْتَ</div><div class="dua-source"><strong>المصدر:</strong> صحيح البخاري - سيد الاستغفار</div></div>
            <div class="dua-card"><div class="dua-number">4</div><div class="dua-text">اللَّهُمَّ إِنِّي أَمْسَيْتُ أُشْهِدُكَ، وَأُشْهِدُ حَمَلَةَ عَرْشِكَ، وَمَلَائِكَتَكَ، وَجَمِيعَ خَلْقِكَ، أَنَّكَ أَنْتَ اللَّهُ لَا إِلَهَ إِلَّا أَنْتَ وَحْدَكَ لَا شَرِيكَ لَكَ، وَأَنَّ مُحَمَّدًا عَبْدُكَ وَرَسُولُكَ</div><div class="dua-source"><strong>المصدر:</strong> أبو داود - أربع مرات</div></div>
            <div class="dua-card"><div class="dua-number">5</div><div class="dua-text">اللَّهُمَّ مَا أَمْسَى بِي مِنْ نِعْمَةٍ أَوْ بِأَحَدٍ مِنْ خَلْقِكَ فَمِنْكَ وَحْدَكَ لَا شَرِيكَ لَكَ، فَلَكَ الْحَمْدُ وَلَكَ الشُّكْرُ</div><div class="dua-source"><strong>المصدر:</strong> أبو داود</div></div>
            <div class="dua-card"><div class="dua-number">6</div><div class="dua-text">اللَّهُمَّ عَافِنِي فِي بَدَنِي، اللَّهُمَّ عَافِنِي فِي سَمْعِي، اللَّهُمَّ عَافِنِي فِي بَصَرِي، لَا إِلَهَ إِلَّا أَنْتَ. اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْكُفْرِ، وَالْفَقْرِ، وَأَعُوذُ بِكَ مِنْ عَذَابِ الْقَبْرِ، لَا إِلَهَ إِلَّا أَنْتَ</div><div class="dua-source"><strong>المصدر:</strong> أبو داود - ثلاث مرات</div></div>
            <div class="dua-card"><div class="dua-number">7</div><div class="dua-text">حَسْبِيَ اللَّهُ لَا إِلَهَ إِلَّا هُوَ عَلَيْهِ تَوَكَّلْتُ وَهُوَ رَبُّ الْعَرْشِ الْعَظِيمِ</div><div class="dua-source"><strong>المصدر:</strong> أبو داود - سبع مرات</div></div>
            <div class="dua-card"><div class="dua-number">8</div><div class="dua-text">بِسْمِ اللَّهِ الَّذِي لَا يَضُرُّ مَعَ اسْمِهِ شَيْءٌ فِي الْأَرْضِ وَلَا فِي السَّمَاءِ وَهُوَ السَّمِيعُ الْعَلِيمُ</div><div class="dua-source"><strong>المصدر:</strong> أبو داود والترمذي - ثلاث مرات</div></div>
            <div class="dua-card"><div class="dua-number">9</div><div class="dua-text">رَضِيتُ بِاللَّهِ رَبًّا، وَبِالْإِسْلَامِ دِينًا، وَبِمُحَمَّدٍ صَلَّى اللَّهُ عَلَيْهِ وَسَلَّمَ نَبِيًّا</div><div class="dua-source"><strong>المصدر:</strong> أحمد وأبو داود - ثلاث مرات</div></div>
            <div class="dua-card"><div class="dua-number">10</div><div class="dua-text">يَا حَيُّ يَا قَيُّومُ بِرَحْمَتِكَ أَسْتَغِيثُ أَصْلِحْ لِي شَأْنِي كُلَّهُ وَلَا تَكِلْنِي إِلَى نَفْسِي طَرْفَةَ عَيْنٍ</div><div class="dua-source"><strong>المصدر:</strong> الحاكم - ثلاث مرات</div></div>
            <div class="dua-card"><div class="dua-number">11</div><div class="dua-text">أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ</div><div class="dua-source"><strong>المصدر:</strong> مسلم - ثلاث مرات مساءً</div></div>
            <div class="dua-card"><div class="dua-number">12</div><div class="dua-text">اللَّهُمَّ صَلِّ وَسَلِّمْ عَلَى نَبِيِّنَا مُحَمَّدٍ</div><div class="dua-source"><strong>المصدر:</strong> الترمذي - عشر مرات</div></div>
            <div class="dua-card"><div class="dua-number">13</div><div class="dua-text">سُبْحَانَ اللَّهِ وَبِحَمْدِهِ</div><div class="dua-source"><strong>المصدر:</strong> مسلم - مئة مرة</div></div>
            </div><!-- end athkar-evening -->

            <!-- Sub: Sleep athkar -->
            <div id="athkar-sleep" class="sub-section">
            <h2 class="section-title">أذكار النوم</h2>
            <div class="intro-box">تُقرأ عند النوم والاستعداد للنوم</div>
            <div class="dua-card"><div class="dua-number">1</div><div class="dua-text">بِاسْمِكَ رَبِّي وَضَعْتُ جَنْبِي، وَبِكَ أَرْفَعُهُ، فَإِنْ أَمْسَكْتَ نَفْسِي فَارْحَمْهَا، وَإِنْ أَرْسَلْتَهَا فَاحْفَظْهَا بِمَا تَحْفَظُ بِهِ عِبَادَكَ الصَّالِحِينَ</div><div class="dua-source"><strong>المصدر:</strong> البخاري ومسلم</div></div>
            <div class="dua-card"><div class="dua-number">2</div><div class="dua-text">اللَّهُمَّ إِنَّكَ خَلَقْتَ نَفْسِي وَأَنْتَ تَوَفَّاهَا، لَكَ مَمَاتُهَا وَمَحْيَاهَا، إِنْ أَحْيَيْتَهَا فَاحْفَظْهَا، وَإِنْ أَمَتَّهَا فَاغْفِرْ لَهَا، اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَافِيَةَ</div><div class="dua-source"><strong>المصدر:</strong> صحيح مسلم</div></div>
            <div class="dua-card"><div class="dua-number">3</div><div class="dua-text">اللَّهُمَّ قِنِي عَذَابَكَ يَوْمَ تَبْعَثُ عِبَادَكَ</div><div class="dua-source"><strong>المصدر:</strong> أبو داود والترمذي - ثلاث مرات</div></div>
            <div class="dua-card"><div class="dua-number">4</div><div class="dua-text">بِاسْمِكَ اللَّهُمَّ أَمُوتُ وَأَحْيَا</div><div class="dua-source"><strong>المصدر:</strong> البخاري</div></div>
            <div class="dua-card"><div class="dua-number">5</div><div class="dua-text">الْحَمْدُ لِلَّهِ الَّذِي أَطْعَمَنَا وَسَقَانَا، وَكَفَانَا، وَآوَانَا، فَكَمْ مِمَّنْ لَا كَافِيَ لَهُ وَلَا مُؤْوِيَ</div><div class="dua-source"><strong>المصدر:</strong> صحيح مسلم</div></div>
            <div class="dua-card"><div class="dua-number">6</div><div class="dua-text">اللَّهُمَّ عَالِمَ الْغَيْبِ وَالشَّهَادَةِ فَاطِرَ السَّمَاوَاتِ وَالْأَرْضِ، رَبَّ كُلِّ شَيْءٍ وَمَلِيكَهُ، أَشْهَدُ أَنْ لَا إِلَهَ إِلَّا أَنْتَ، أَعُوذُ بِكَ مِنْ شَرِّ نَفْسِي، وَمِنْ شَرِّ الشَّيْطَانِ وَشِرْكِهِ</div><div class="dua-source"><strong>المصدر:</strong> أبو داود والترمذي</div></div>
            <div class="dua-card"><div class="dua-number">7</div><div class="dua-text">اللَّهُمَّ أَسْلَمْتُ نَفْسِي إِلَيْكَ، وَفَوَّضْتُ أَمْرِي إِلَيْكَ، وَوَجَّهْتُ وَجْهِي إِلَيْكَ، وَأَلْجَأْتُ ظَهْرِي إِلَيْكَ، رَغْبَةً وَرَهْبَةً إِلَيْكَ، لَا مَلْجَأَ وَلَا مَنْجَا مِنْكَ إِلَّا إِلَيْكَ، آمَنْتُ بِكِتَابِكَ الَّذِي أَنْزَلْتَ وَبِنَبِيِّكَ الَّذِي أَرْسَلْتَ</div><div class="dua-source"><strong>المصدر:</strong> البخاري ومسلم</div></div>
            <div class="dua-card"><div class="dua-number">8</div><div class="dua-text">سُبْحَانَ اللَّهِ (33) وَالْحَمْدُ لِلَّهِ (33) وَاللَّهُ أَكْبَرُ (34)</div><div class="dua-source"><strong>المصدر:</strong> البخاري ومسلم</div></div>
            </div><!-- end athkar-sleep -->

            <!-- Sub: Post-prayer athkar -->
            <div id="athkar-prayer" class="sub-section">
            <h2 class="section-title">أذكار بعد الصلاة</h2>
            <div class="intro-box">تُقال بعد السلام من كل صلاة مفروضة</div>
            <div class="dua-card"><div class="dua-number">1</div><div class="dua-text">أَسْتَغْفِرُ اللَّهَ، أَسْتَغْفِرُ اللَّهَ، أَسْتَغْفِرُ اللَّهَ. اللَّهُمَّ أَنْتَ السَّلَامُ، وَمِنْكَ السَّلَامُ، تَبَارَكْتَ يَا ذَا الْجَلَالِ وَالْإِكْرَامِ</div><div class="dua-source"><strong>المصدر:</strong> صحيح مسلم</div></div>
            <div class="dua-card"><div class="dua-number">2</div><div class="dua-text">لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ، اللَّهُمَّ لَا مَانِعَ لِمَا أَعْطَيْتَ، وَلَا مُعْطِيَ لِمَا مَنَعْتَ، وَلَا يَنْفَعُ ذَا الْجَدِّ مِنْكَ الْجَدُّ</div><div class="dua-source"><strong>المصدر:</strong> البخاري ومسلم</div></div>
            <div class="dua-card"><div class="dua-number">3</div><div class="dua-text">لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ، لَا حَوْلَ وَلَا قُوَّةَ إِلَّا بِاللَّهِ، لَا إِلَهَ إِلَّا اللَّهُ، وَلَا نَعْبُدُ إِلَّا إِيَّاهُ، لَهُ النِّعْمَةُ وَلَهُ الْفَضْلُ، وَلَهُ الثَّنَاءُ الْحَسَنُ، لَا إِلَهَ إِلَّا اللَّهُ مُخْلِصِينَ لَهُ الدِّينَ وَلَوْ كَرِهَ الْكَافِرُونَ</div><div class="dua-source"><strong>المصدر:</strong> صحيح مسلم</div></div>
            <div class="dua-card"><div class="dua-number">4</div><div class="dua-text">سُبْحَانَ اللَّهِ (33) وَالْحَمْدُ لِلَّهِ (33) وَاللَّهُ أَكْبَرُ (33) ثم لَا إِلَهَ إِلَّا اللَّهُ وَحْدَهُ لَا شَرِيكَ لَهُ لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ</div><div class="dua-source"><strong>المصدر:</strong> صحيح مسلم - تمام المئة</div></div>
            <div class="dua-card"><div class="dua-number">5</div><div class="dua-text">قراءة آية الكرسي: ﴿اللَّهُ لَا إِلَهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ﴾</div><div class="dua-source"><strong>المصدر:</strong> النسائي - بعد كل صلاة</div></div>
            <div class="dua-card"><div class="dua-number">6</div><div class="dua-text">قراءة ﴿قُلْ هُوَ اللَّهُ أَحَدٌ﴾ و ﴿قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ﴾ و ﴿قُلْ أَعُوذُ بِرَبِّ النَّاسِ﴾</div><div class="dua-source"><strong>المصدر:</strong> أبو داود - مرة بعد كل صلاة، وثلاثاً بعد الفجر والمغرب</div></div>
            <div class="dua-card"><div class="dua-number">7</div><div class="dua-text">اللَّهُمَّ إِنِّي أَسْأَلُكَ عِلْمًا نَافِعًا، وَرِزْقًا طَيِّبًا، وَعَمَلًا مُتَقَبَّلًا</div><div class="dua-source"><strong>المصدر:</strong> ابن ماجه - بعد صلاة الفجر</div></div>
            </div><!-- end athkar-prayer -->
        </div><!-- end tabAthkar -->

        <!-- DUAS TAB -->
        <div id="tabDuas" class="content-area">
            <h2 class="section-title">الأدعية</h2>
            <div class="sub-nav">
                <button class="sub-nav-btn active" onclick="switchSub('tabDuas','duas-rizq',this)">أدعية الرزق</button>
                <button class="sub-nav-btn" onclick="switchSub('tabDuas','duas-quran',this)">أدعية قرآنية</button>
                <button class="sub-nav-btn" onclick="switchSub('tabDuas','duas-ruqyah',this)">الرقية الشرعية</button>
                <button class="sub-nav-btn" onclick="switchSub('tabDuas','duas-travel',this)">السفر</button>
                <button class="sub-nav-btn" onclick="switchSub('tabDuas','duas-food',this)">الطعام</button>
                <button class="sub-nav-btn" onclick="switchSub('tabDuas','duas-misc',this)">أدعية متنوعة</button>
            </div>

            <!-- Sub: Rizq duas (existing tab4 content) -->
            <div id="duas-rizq" class="sub-section active">
            <h2 class="section-title">أدعية مستجابة لجلب الرزق</h2>

            <div class="intro-box">
                <strong>المقدمة:</strong> من فضل الله على المسلمين أنه شرع لهم الدعاء، ووعدهم بالإجابة في قوله تعالى: "وَإِذَا سَأَلَكَ عِبَادِي عَنِّي فَإِنِّي قَرِيبٌ أُجِيبُ دَعْوَةَ الدَّاعِ إِذَا دَعَانِ" [البقرة: 186]
            </div>

            <div class="section-heading">أدعية مأثورة من السنة في طلب الرزق</div>

            <div class="dua-card">
                <div class="dua-number">1</div>
                <div class="dua-text">اللهُمّ إني أعوذُ بكَ منَ الهمِّ والحزَنِ، وأعوذُ بكَ منَ العجزِ والكسلِ، وأعوذُ بكَ منَ الجُبنِ والبخلِ، وأعوذُ بكَ مِن غلبةِ الدَّينِ وقهرِ الرجالِ</div>
            </div>

            <div class="dua-card">
                <div class="dua-number">2</div>
                <div class="dua-text">اللَّهمَّ اكفني بِحلالِكَ عن حرامِكَ، وأغنِني بِفَضلِكَ عَمن سواكَ</div>
                <div class="benefits"><strong>الفائدة:</strong> دعاء عظيم الشأن لطلب الرزق الحلال والاستغناء عن الآخرين</div>
            </div>

            <div class="dua-card">
                <div class="dua-number">3</div>
                <div class="dua-text">اللهمَّ مالِكَ المُلْكِ تُؤْتي المُلْكَ مَن تشاءُ، وتنزع الملك ممن تشاء، وتعز من تشاء، وتذل من تشاء، بيدك الخير إنك على كل شيء قدير</div>
                <div class="benefits"><strong>الفائدة:</strong> دعاء عظيم لطلب الرزق والملك من الله تعالى، وهو سهل على من لو كان عليه مثل جبل أحد دينا لأداه الله عنه</div>
            </div>

            <div class="dua-card">
                <div class="dua-number">4</div>
                <div class="dua-text">اللَّهُمَّ لا مَانِعَ لِما أعْطَيْتَ، ولَا مُعْطِيَ لِما مَنَعْتَ، ولَا يَنْفَعُ ذَا الجَدِّ مِنْكَ الجَدُّ</div>
            </div>

            <div class="dua-card">
                <div class="dua-number">5</div>
                <div class="dua-text">اللَّهمَّ ربَّ السَّماواتِ وربَّ الأرضِ، وربَّ كلِّ شيءٍ، فالقَ الحبِّ والنَّوَى، مُنزِلَ التَّوراةِ والإنجيلِ، أعِذْني من شرِّ كلِّ ذي شرٍّ، أنت آخِذٌ بناصيتِه، أنت الأوَّلُ فليس قبلك شيءٌ، وأنت الباطنُ فليس دونك شيءٌ، وأنت الظَّاهرُ فليس فوقك شيءٌ، اقْضِ عنِّي الدَّينَ وأغْنِني من الفقرِ</div>
            </div>

            <div class="dua-card">
                <div class="dua-number">6</div>
                <div class="dua-text">اللَّهُمَّ اغْفِرْ لِي، وَارْحَمْنِي، وَاهْدِنِي، وَعَافِنِي وَارْزُقْنِي</div>
            </div>

            <div class="section-heading">الاستغفار طريق الرزق</div>

            <div class="intro-box">
                <strong>قال الله تعالى:</strong> "فَقُلْتُ اسْتَغْفِرُوا رَبَّكُمْ إِنَّهُ كَانَ غَفَّارًا* يُرْسِلِ السَّمَاءَ عَلَيْكُم مِّدْرَارًا* وَيُمْدِدْكُم بِأَمْوَالٍ وَبَنِينَ وَيَجْعَل لَّكُمْ جَنَّاتٍ وَيَجْعَل لَّكُمْ أَنْهَارًا"
            </div>

            <div class="section-heading">أدعية لجلب الرزق والبركة</div>

            <div class="dua-card">
                <div class="dua-text">اللهم صل على سيدنا محمد، وعلى آل محمد، يا ذا الجلال والإكرام، يا قاضي الحاجات، يا أرحم الراحمين</div>
            </div>

            <div class="dua-card">
                <div class="dua-text">اللّهم إنّي أحمدك حمداً كثيراً وأشكرك شكراً كثيراً يليق بجلال وجهك وعظيم سلطانك، اللهم اكفني بحلالك عن حرامك وأغنني بفضلك عمن سواك</div>
            </div>

            <div class="dua-card">
                <div class="dua-text">يا الله، يا رب، يا حي يا قيوم، يا ذا الجلال والإكرام، أسألك باسمك العظيم الأعظم أن ترزقني رزقاً واسعاً حلالاً طيباً</div>
            </div>

            <div class="dua-card">
                <div class="dua-text">اللهم ارزقنا رزقا حلالاً طيباً مباركاً فيه كما تحب وترضى يا رب العالمين</div>
            </div>

            <div class="dua-card">
                <div class="dua-text">حسبنا الله سيؤتينا الله من فضله إنا إلى الله راغبون</div>
            </div>

            <div class="dua-card">
                <div class="dua-text">اللّهم إن كان رزقي في السّماء فأنزله، وإن كان في الأرض فأخرجه، وإن كان بعيداً فقرّبه وإن كان قريباً فيسّره، وإن كان قليلاً فكثّره، وإن كان كثيراً فبارك لي فيه</div>
            </div>

            <div class="section-heading">نصائح ذهبية للحصول على الرزق الحلال</div>

            <div class="intro-box">
                <ul class="benefits-list">
                    <li><strong>1. ادعُ بقلب خاشع:</strong> ادع الله بإخلاص وتوكل عليه في طلب الرزق</li>
                    <li><strong>2. خذ بالأسباب:</strong> اعمل واسع في تحصيل الرزق، فالعمل ركن الرزق</li>
                    <li><strong>3. تجنب الحرام:</strong> احذر من كسب الحرام فهو يلعن المال والصاحب</li>
                    <li><strong>4. تصدق وأعطِ:</strong> تصدق من مالك فالصدقة لا تنقص المال بل تزيده</li>
                    <li><strong>5. استغفر كثيراً:</strong> الاستغفار يفتح أبواب الرزق والبركة</li>
                    <li><strong>6. اتق الله:</strong> التقوى تجلب البركة والرزق: "وَمَن يَتَّقِ اللَّهَ يَجْعَل لَّهُ مَخْرَجًا ۝ وَيَرْزُقْهُ مِنْ حَيْثُ لَا يَحْتَسِبُ"</li>
                    <li><strong>7. لا تقنط:</strong> لا تيأس من رحمة الله فهو الكريم الرزاق</li>
                    <li><strong>8. احسن الظن بالله:</strong> يقول الله: "أنا عند ظن عبدي بي"</li>
                </ul>
            </div>
            </div><!-- end duas-rizq -->

            <!-- Sub: Quranic Duas -->
            <div id="duas-quran" class="sub-section">
            <h2 class="section-title">أدعية من القرآن الكريم</h2>
            <div class="intro-box">أدعية وردت في القرآن الكريم على لسان الأنبياء والصالحين</div>
            <div class="dua-card"><div class="dua-number">1</div><div class="dua-text">رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ</div><div class="dua-source"><strong>المصدر:</strong> البقرة: 201</div></div>
            <div class="dua-card"><div class="dua-number">2</div><div class="dua-text">رَبَّنَا لَا تُؤَاخِذْنَا إِن نَّسِينَا أَوْ أَخْطَأْنَا ۚ رَبَّنَا وَلَا تَحْمِلْ عَلَيْنَا إِصْرًا كَمَا حَمَلْتَهُ عَلَى الَّذِينَ مِن قَبْلِنَا ۚ رَبَّنَا وَلَا تُحَمِّلْنَا مَا لَا طَاقَةَ لَنَا بِهِ ۖ وَاعْفُ عَنَّا وَاغْفِرْ لَنَا وَارْحَمْنَا ۚ أَنتَ مَوْلَانَا فَانصُرْنَا عَلَى الْقَوْمِ الْكَافِرِينَ</div><div class="dua-source"><strong>المصدر:</strong> البقرة: 286</div></div>
            <div class="dua-card"><div class="dua-number">3</div><div class="dua-text">رَبَّنَا لَا تُزِغْ قُلُوبَنَا بَعْدَ إِذْ هَدَيْتَنَا وَهَبْ لَنَا مِن لَّدُنكَ رَحْمَةً ۚ إِنَّكَ أَنتَ الْوَهَّابُ</div><div class="dua-source"><strong>المصدر:</strong> آل عمران: 8</div></div>
            <div class="dua-card"><div class="dua-number">4</div><div class="dua-text">رَبَّنَا إِنَّنَا آمَنَّا فَاغْفِرْ لَنَا ذُنُوبَنَا وَقِنَا عَذَابَ النَّارِ</div><div class="dua-source"><strong>المصدر:</strong> آل عمران: 16</div></div>
            <div class="dua-card"><div class="dua-number">5</div><div class="dua-text">رَبِّ هَبْ لِي مِن لَّدُنكَ ذُرِّيَّةً طَيِّبَةً ۖ إِنَّكَ سَمِيعُ الدُّعَاءِ</div><div class="dua-source"><strong>المصدر:</strong> آل عمران: 38 - دعاء زكريا عليه السلام</div></div>
            <div class="dua-card"><div class="dua-number">6</div><div class="dua-text">رَبَّنَا اغْفِرْ لَنَا ذُنُوبَنَا وَإِسْرَافَنَا فِي أَمْرِنَا وَثَبِّتْ أَقْدَامَنَا وَانصُرْنَا عَلَى الْقَوْمِ الْكَافِرِينَ</div><div class="dua-source"><strong>المصدر:</strong> آل عمران: 147</div></div>
            <div class="dua-card"><div class="dua-number">7</div><div class="dua-text">رَبَّنَا ظَلَمْنَا أَنفُسَنَا وَإِن لَّمْ تَغْفِرْ لَنَا وَتَرْحَمْنَا لَنَكُونَنَّ مِنَ الْخَاسِرِينَ</div><div class="dua-source"><strong>المصدر:</strong> الأعراف: 23 - دعاء آدم وحواء</div></div>
            <div class="dua-card"><div class="dua-number">8</div><div class="dua-text">رَبِّ اشْرَحْ لِي صَدْرِي ﴿٢٥﴾ وَيَسِّرْ لِي أَمْرِي ﴿٢٦﴾ وَاحْلُلْ عُقْدَةً مِّن لِّسَانِي ﴿٢٧﴾ يَفْقَهُوا قَوْلِي</div><div class="dua-source"><strong>المصدر:</strong> طه: 25-28 - دعاء موسى عليه السلام</div></div>
            <div class="dua-card"><div class="dua-number">9</div><div class="dua-text">رَبِّ زِدْنِي عِلْمًا</div><div class="dua-source"><strong>المصدر:</strong> طه: 114</div></div>
            <div class="dua-card"><div class="dua-number">10</div><div class="dua-text">لَّا إِلَٰهَ إِلَّا أَنتَ سُبْحَانَكَ إِنِّي كُنتُ مِنَ الظَّالِمِينَ</div><div class="dua-source"><strong>المصدر:</strong> الأنبياء: 87 - دعاء يونس عليه السلام</div></div>
            <div class="dua-card"><div class="dua-number">11</div><div class="dua-text">رَبِّ أَعُوذُ بِكَ مِنْ هَمَزَاتِ الشَّيَاطِينِ ﴿٩٧﴾ وَأَعُوذُ بِكَ رَبِّ أَن يَحْضُرُونِ</div><div class="dua-source"><strong>المصدر:</strong> المؤمنون: 97-98</div></div>
            <div class="dua-card"><div class="dua-number">12</div><div class="dua-text">رَبَّنَا هَبْ لَنَا مِنْ أَزْوَاجِنَا وَذُرِّيَّاتِنَا قُرَّةَ أَعْيُنٍ وَاجْعَلْنَا لِلْمُتَّقِينَ إِمَامًا</div><div class="dua-source"><strong>المصدر:</strong> الفرقان: 74</div></div>
            <div class="dua-card"><div class="dua-number">13</div><div class="dua-text">رَبِّ أَوْزِعْنِي أَنْ أَشْكُرَ نِعْمَتَكَ الَّتِي أَنْعَمْتَ عَلَيَّ وَعَلَىٰ وَالِدَيَّ وَأَنْ أَعْمَلَ صَالِحًا تَرْضَاهُ وَأَدْخِلْنِي بِرَحْمَتِكَ فِي عِبَادِكَ الصَّالِحِينَ</div><div class="dua-source"><strong>المصدر:</strong> النمل: 19 - دعاء سليمان عليه السلام</div></div>
            <div class="dua-card"><div class="dua-number">14</div><div class="dua-text">رَبَّنَا اغْفِرْ لَنَا وَلِإِخْوَانِنَا الَّذِينَ سَبَقُونَا بِالْإِيمَانِ وَلَا تَجْعَلْ فِي قُلُوبِنَا غِلًّا لِّلَّذِينَ آمَنُوا رَبَّنَا إِنَّكَ رَءُوفٌ رَّحِيمٌ</div><div class="dua-source"><strong>المصدر:</strong> الحشر: 10</div></div>
            <div class="dua-card"><div class="dua-number">15</div><div class="dua-text">رَبَّنَا أَتْمِمْ لَنَا نُورَنَا وَاغْفِرْ لَنَا ۖ إِنَّكَ عَلَىٰ كُلِّ شَيْءٍ قَدِيرٌ</div><div class="dua-source"><strong>المصدر:</strong> التحريم: 8</div></div>
            </div><!-- end duas-quran -->

            <!-- Sub: Ruqyah -->
            <div id="duas-ruqyah" class="sub-section">
            <h2 class="section-title">الرقية الشرعية</h2>
            <div class="intro-box">آيات وأدعية الرقية الشرعية من القرآن والسنة للحفظ والشفاء بإذن الله</div>
            <div class="dua-card"><div class="dua-number">1</div><div class="dua-text">بِسْمِ اللَّهِ الرَّحْمَنِ الرَّحِيمِ ﴿١﴾ الْحَمْدُ لِلَّهِ رَبِّ الْعَالَمِينَ ﴿٢﴾ الرَّحْمَنِ الرَّحِيمِ ﴿٣﴾ مَالِكِ يَوْمِ الدِّينِ ﴿٤﴾ إِيَّاكَ نَعْبُدُ وَإِيَّاكَ نَسْتَعِينُ ﴿٥﴾ اهْدِنَا الصِّرَاطَ الْمُسْتَقِيمَ ﴿٦﴾ صِرَاطَ الَّذِينَ أَنْعَمْتَ عَلَيْهِمْ غَيْرِ الْمَغْضُوبِ عَلَيْهِمْ وَلَا الضَّالِّينَ ﴿٧﴾</div><div class="dua-source"><strong>المصدر:</strong> سورة الفاتحة كاملة</div></div>
            <div class="dua-card"><div class="dua-number">2</div><div class="dua-text">اللَّهُ لَا إِلَهَ إِلَّا هُوَ الْحَيُّ الْقَيُّومُ ۚ لَا تَأْخُذُهُ سِنَةٌ وَلَا نَوْمٌ ۚ لَّهُ مَا فِي السَّمَاوَاتِ وَمَا فِي الْأَرْضِ ۗ مَن ذَا الَّذِي يَشْفَعُ عِندَهُ إِلَّا بِإِذْنِهِ ۚ يَعْلَمُ مَا بَيْنَ أَيْدِيهِمْ وَمَا خَلْفَهُمْ ۖ وَلَا يُحِيطُونَ بِشَيْءٍ مِّنْ عِلْمِهِ إِلَّا بِمَا شَاءَ ۚ وَسِعَ كُرْسِيُّهُ السَّمَاوَاتِ وَالْأَرْضَ ۖ وَلَا يَئُودُهُ حِفْظُهُمَا ۚ وَهُوَ الْعَلِيُّ الْعَظِيمُ</div><div class="dua-source"><strong>المصدر:</strong> آية الكرسي - البقرة: 255</div></div>
            <div class="dua-card"><div class="dua-number">3</div><div class="dua-text">آمَنَ الرَّسُولُ بِمَا أُنزِلَ إِلَيْهِ مِن رَّبِّهِ وَالْمُؤْمِنُونَ ۚ كُلٌّ آمَنَ بِاللَّهِ وَمَلَائِكَتِهِ وَكُتُبِهِ وَرُسُلِهِ لَا نُفَرِّقُ بَيْنَ أَحَدٍ مِّن رُّسُلِهِ ۚ وَقَالُوا سَمِعْنَا وَأَطَعْنَا ۖ غُفْرَانَكَ رَبَّنَا وَإِلَيْكَ الْمَصِيرُ</div><div class="dua-source"><strong>المصدر:</strong> البقرة: 285</div></div>
            <div class="dua-card"><div class="dua-number">4</div><div class="dua-text">قُلْ هُوَ اللَّهُ أَحَدٌ ﴿١﴾ اللَّهُ الصَّمَدُ ﴿٢﴾ لَمْ يَلِدْ وَلَمْ يُولَدْ ﴿٣﴾ وَلَمْ يَكُن لَّهُ كُفُوًا أَحَدٌ ﴿٤﴾</div><div class="dua-source"><strong>المصدر:</strong> سورة الإخلاص - ثلاث مرات</div></div>
            <div class="dua-card"><div class="dua-number">5</div><div class="dua-text">قُلْ أَعُوذُ بِرَبِّ الْفَلَقِ ﴿١﴾ مِن شَرِّ مَا خَلَقَ ﴿٢﴾ وَمِن شَرِّ غَاسِقٍ إِذَا وَقَبَ ﴿٣﴾ وَمِن شَرِّ النَّفَّاثَاتِ فِي الْعُقَدِ ﴿٤﴾ وَمِن شَرِّ حَاسِدٍ إِذَا حَسَدَ ﴿٥﴾</div><div class="dua-source"><strong>المصدر:</strong> سورة الفلق - ثلاث مرات</div></div>
            <div class="dua-card"><div class="dua-number">6</div><div class="dua-text">قُلْ أَعُوذُ بِرَبِّ النَّاسِ ﴿١﴾ مَلِكِ النَّاسِ ﴿٢﴾ إِلَهِ النَّاسِ ﴿٣﴾ مِن شَرِّ الْوَسْوَاسِ الْخَنَّاسِ ﴿٤﴾ الَّذِي يُوَسْوِسُ فِي صُدُورِ النَّاسِ ﴿٥﴾ مِنَ الْجِنَّةِ وَالنَّاسِ ﴿٦﴾</div><div class="dua-source"><strong>المصدر:</strong> سورة الناس - ثلاث مرات</div></div>
            <div class="section-heading">أدعية الرقية من السنة</div>
            <div class="dua-card"><div class="dua-number">7</div><div class="dua-text">بِسْمِ اللَّهِ أَرْقِيكَ، مِنْ كُلِّ شَيْءٍ يُؤْذِيكَ، مِنْ شَرِّ كُلِّ نَفْسٍ أَوْ عَيْنِ حَاسِدٍ اللَّهُ يَشْفِيكَ، بِسْمِ اللَّهِ أَرْقِيكَ</div><div class="dua-source"><strong>المصدر:</strong> صحيح مسلم</div></div>
            <div class="dua-card"><div class="dua-number">8</div><div class="dua-text">أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّةِ مِنْ كُلِّ شَيْطَانٍ وَهَامَّةٍ، وَمِنْ كُلِّ عَيْنٍ لَامَّةٍ</div><div class="dua-source"><strong>المصدر:</strong> صحيح البخاري</div></div>
            <div class="dua-card"><div class="dua-number">9</div><div class="dua-text">أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ الَّتِي لَا يُجَاوِزُهُنَّ بَرٌّ وَلَا فَاجِرٌ، مِنْ شَرِّ مَا خَلَقَ وَذَرَأَ وَبَرَأَ، وَمِنْ شَرِّ مَا يَنْزِلُ مِنَ السَّمَاءِ، وَمِنْ شَرِّ مَا يَعْرُجُ فِيهَا، وَمِنْ شَرِّ مَا ذَرَأَ فِي الْأَرْضِ وَمِنْ شَرِّ مَا يَخْرُجُ مِنْهَا، وَمِنْ شَرِّ فِتَنِ اللَّيْلِ وَالنَّهَارِ، وَمِنْ شَرِّ كُلِّ طَارِقٍ إِلَّا طَارِقًا يَطْرُقُ بِخَيْرٍ يَا رَحْمَنُ</div><div class="dua-source"><strong>المصدر:</strong> أحمد</div></div>
            <div class="dua-card"><div class="dua-number">10</div><div class="dua-text">اللَّهُمَّ رَبَّ النَّاسِ، أَذْهِبِ الْبَأْسَ، اشْفِهِ وَأَنْتَ الشَّافِي، لَا شِفَاءَ إِلَّا شِفَاؤُكَ، شِفَاءً لَا يُغَادِرُ سَقَمًا</div><div class="dua-source"><strong>المصدر:</strong> البخاري ومسلم</div></div>
            </div><!-- end duas-ruqyah -->

            <!-- Sub: Travel Duas -->
            <div id="duas-travel" class="sub-section">
            <h2 class="section-title">أدعية السفر</h2>
            <div class="dua-card"><div class="dua-text">سُبْحَانَ الَّذِي سَخَّرَ لَنَا هَٰذَا وَمَا كُنَّا لَهُ مُقْرِنِينَ وَإِنَّا إِلَىٰ رَبِّنَا لَمُنقَلِبُونَ</div><div class="dua-source">دعاء ركوب الدابة - صحيح مسلم</div></div>
            <div class="dua-card"><div class="dua-text">اللَّهُمَّ إِنَّا نَسْأَلُكَ فِي سَفَرِنَا هَذَا الْبِرَّ وَالتَّقْوَى، وَمِنَ الْعَمَلِ مَا تَرْضَى، اللَّهُمَّ هَوِّنْ عَلَيْنَا سَفَرَنَا هَذَا وَاطْوِ عَنَّا بُعْدَهُ</div><div class="dua-source">دعاء السفر - رواه مسلم</div></div>
            <div class="dua-card"><div class="dua-text">اللَّهُمَّ أَنْتَ الصَّاحِبُ فِي السَّفَرِ، وَالْخَلِيفَةُ فِي الْأَهْلِ، اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ وَعْثَاءِ السَّفَرِ وَكَآبَةِ الْمَنْظَرِ وَسُوءِ الْمُنْقَلَبِ</div><div class="dua-source">صحيح مسلم</div></div>
            <div class="dua-card"><div class="dua-text">أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ</div><div class="dua-source">دعاء النزول في مكان - رواه مسلم</div></div>
            <div class="dua-card"><div class="dua-text">آيِبُونَ تَائِبُونَ عَابِدُونَ لِرَبِّنَا حَامِدُونَ</div><div class="dua-source">دعاء الرجوع من السفر - رواه مسلم</div></div>
            </div><!-- end duas-travel -->

            <!-- Sub: Food Duas -->
            <div id="duas-food" class="sub-section">
            <h2 class="section-title">أدعية الطعام</h2>
            <div class="dua-card"><div class="dua-text">بِسْمِ اللَّهِ</div><div class="dua-source">قبل الأكل - البخاري ومسلم</div></div>
            <div class="dua-card"><div class="dua-text">بِسْمِ اللَّهِ أَوَّلَهُ وَآخِرَهُ</div><div class="dua-source">إذا نسي التسمية في أوله - رواه أبو داود</div></div>
            <div class="dua-card"><div class="dua-text">الْحَمْدُ لِلَّهِ الَّذِي أَطْعَمَنِي هَذَا وَرَزَقَنِيهِ مِنْ غَيْرِ حَوْلٍ مِنِّي وَلَا قُوَّةٍ</div><div class="dua-source">بعد الأكل - رواه أبو داود والترمذي</div></div>
            <div class="dua-card"><div class="dua-text">الْحَمْدُ لِلَّهِ حَمْدًا كَثِيرًا طَيِّبًا مُبَارَكًا فِيهِ غَيْرَ مَكْفِيٍّ وَلَا مُوَدَّعٍ وَلَا مُسْتَغْنًى عَنْهُ رَبَّنَا</div><div class="dua-source">رواه البخاري</div></div>
            <div class="dua-card"><div class="dua-text">اللَّهُمَّ بَارِكْ لَنَا فِيهِ وَأَطْعِمْنَا خَيْرًا مِنْهُ</div><div class="dua-source">عند شرب اللبن - رواه الترمذي</div></div>
            <div class="dua-card"><div class="dua-text">اللَّهُمَّ أَطْعِمْ مَنْ أَطْعَمَنِي وَاسْقِ مَنْ سَقَانِي</div><div class="dua-source">دعاء لصاحب الطعام - رواه مسلم</div></div>
            </div><!-- end duas-food -->

            <!-- Sub: Misc Duas -->
            <div id="duas-misc" class="sub-section">
            <h2 class="section-title">أدعية متنوعة</h2>
            <div class="dua-card"><div class="dua-text">اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْهَمِّ وَالْحَزَنِ، وَأَعُوذُ بِكَ مِنَ الْعَجْزِ وَالْكَسَلِ، وَأَعُوذُ بِكَ مِنَ الْجُبْنِ وَالْبُخْلِ، وَأَعُوذُ بِكَ مِنْ غَلَبَةِ الدَّيْنِ وَقَهْرِ الرِّجَالِ</div><div class="dua-source">دعاء الكرب - رواه البخاري</div></div>
            <div class="dua-card"><div class="dua-text">لَا إِلَهَ إِلَّا اللَّهُ الْعَظِيمُ الْحَلِيمُ، لَا إِلَهَ إِلَّا اللَّهُ رَبُّ الْعَرْشِ الْعَظِيمِ، لَا إِلَهَ إِلَّا اللَّهُ رَبُّ السَّمَاوَاتِ وَرَبُّ الْأَرْضِ وَرَبُّ الْعَرْشِ الْكَرِيمِ</div><div class="dua-source">دعاء الكرب - متفق عليه</div></div>
            <div class="dua-card"><div class="dua-text">اللَّهُمَّ رَحْمَتَكَ أَرْجُو فَلَا تَكِلْنِي إِلَى نَفْسِي طَرْفَةَ عَيْنٍ وَأَصْلِحْ لِي شَأْنِي كُلَّهُ لَا إِلَهَ إِلَّا أَنْتَ</div><div class="dua-source">رواه أبو داود</div></div>
            <div class="dua-card"><div class="dua-text">اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَافِيَةَ فِي الدُّنْيَا وَالْآخِرَةِ، اللَّهُمَّ إِنِّي أَسْأَلُكَ الْعَفْوَ وَالْعَافِيَةَ فِي دِينِي وَدُنْيَايَ وَأَهْلِي وَمَالِي</div><div class="dua-source">رواه أبو داود وابن ماجه</div></div>
            <div class="dua-card"><div class="dua-text">اللَّهُمَّ اكْفِنِي بِحَلَالِكَ عَنْ حَرَامِكَ، وَأَغْنِنِي بِفَضْلِكَ عَمَّنْ سِوَاكَ</div><div class="dua-source">دعاء قضاء الدين - رواه الترمذي</div></div>
            <div class="dua-card"><div class="dua-text">اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنْ زَوَالِ نِعْمَتِكَ، وَتَحَوُّلِ عَافِيَتِكَ، وَفُجَاءَةِ نِقْمَتِكَ، وَجَمِيعِ سَخَطِكَ</div><div class="dua-source">رواه مسلم</div></div>
            <div class="dua-card"><div class="dua-text">حَسْبِيَ اللَّهُ لَا إِلَهَ إِلَّا هُوَ عَلَيْهِ تَوَكَّلْتُ وَهُوَ رَبُّ الْعَرْشِ الْعَظِيمِ</div><div class="dua-source">سبع مرات - رواه أبو داود</div></div>
            <div class="dua-card"><div class="dua-text">رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ</div><div class="dua-source">سورة البقرة: 201</div></div>
            </div><!-- end duas-misc -->

        </div><!-- end tabDuas -->

        <!-- TOOLS TAB -->
        <div id="tabTools" class="content-area">
            <h2 class="section-title">أدوات المسلم</h2>
            <div class="sub-nav">
                <button class="sub-nav-btn active" onclick="switchSub('tabTools','tools-prayer',this)">مواقيت الصلاة</button>
                <button class="sub-nav-btn" onclick="switchSub('tabTools','tools-ramadan',this)">تقويم رمضان</button>
                <button class="sub-nav-btn" onclick="switchSub('tabTools','tools-tasbeeh',this)">عداد التسبيح</button>
                <button class="sub-nav-btn" onclick="switchSub('tabTools','tools-names',this)">أسماء الله الحسنى</button>
                <button class="sub-nav-btn" onclick="switchSub('tabTools','tools-qibla',this)">القبلة</button>
                <button class="sub-nav-btn" onclick="switchSub('tabTools','tools-calendar',this)">التقويم الهجري</button>
                <button class="sub-nav-btn" onclick="switchSub('tabTools','tools-khatm',this)">ختم القرآن</button>
                <button class="sub-nav-btn" onclick="switchSub('tabTools','tools-hifz',this);renderHifz()">الحفظ</button>
                <button class="sub-nav-btn" onclick="switchSub('tabTools','tools-history',this);renderReadingHistory()">سجل القراءة</button>
            </div>

            <!-- Sub: Prayer times -->
            <div id="tools-prayer" class="sub-section active">
            <h2 class="section-title">مواقيت الصلاة</h2>
            <div id="prayerLocation" style="text-align:center;margin-bottom:15px;color:var(--text-muted);font-size:1.1em"></div>
            <div class="prayer-grid" id="toolsPrayerGrid">
                <div class="prayer-card"><div class="prayer-card-name">الفجر</div><div class="prayer-card-time" id="toolsFajr">--:--</div></div>
                <div class="prayer-card"><div class="prayer-card-name">الشروق</div><div class="prayer-card-time" id="toolsSunrise">--:--</div></div>
                <div class="prayer-card"><div class="prayer-card-name">الظهر</div><div class="prayer-card-time" id="toolsDhuhr">--:--</div></div>
                <div class="prayer-card"><div class="prayer-card-name">العصر</div><div class="prayer-card-time" id="toolsAsr">--:--</div></div>
                <div class="prayer-card"><div class="prayer-card-name">المغرب</div><div class="prayer-card-time" id="toolsMaghrib">--:--</div></div>
                <div class="prayer-card"><div class="prayer-card-name">العشاء</div><div class="prayer-card-time" id="toolsIsha">--:--</div></div>
            </div>
            <div style="text-align:center;margin-top:15px">
                <button class="tasbeeh-ctrl-btn" onclick="fetchPrayerTimes()" id="refreshPrayerBtn">تحديث المواقيت</button>
            </div>
            </div><!-- end tools-prayer -->

            <!-- Sub: Ramadan Calendar -->
            <div id="tools-ramadan" class="sub-section">
            <h2 class="section-title">تقويم رمضان</h2>
            <div id="ramadanCalInfo" style="text-align:center;margin-bottom:15px;color:var(--text-muted);font-size:1.1em"></div>
            <div id="ramadanCalContainer"><div style="text-align:center;padding:30px;color:var(--text-muted)">جاري تحميل التقويم...</div></div>
            </div><!-- end tools-ramadan -->

            <!-- Sub: Tasbeeh counter -->
            <div id="tools-tasbeeh" class="sub-section">
            <h2 class="section-title">عداد التسبيح</h2>
            <div class="tasbeeh-container">
                <div class="tasbeeh-presets">
                    <button class="tasbeeh-preset active" onclick="setTasbeehPreset('سبحان الله',33,this)">سبحان الله</button>
                    <button class="tasbeeh-preset" onclick="setTasbeehPreset('الحمد لله',33,this)">الحمد لله</button>
                    <button class="tasbeeh-preset" onclick="setTasbeehPreset('الله أكبر',34,this)">الله أكبر</button>
                    <button class="tasbeeh-preset" onclick="setTasbeehPreset('لا إله إلا الله',100,this)">لا إله إلا الله</button>
                    <button class="tasbeeh-preset" onclick="setTasbeehPreset('أستغفر الله',100,this)">أستغفر الله</button>
                    <button class="tasbeeh-preset" onclick="setTasbeehPreset('لا حول ولا قوة إلا بالله',0,this)">لا حول ولا قوة إلا بالله</button>
                </div>
                <div class="tasbeeh-target" id="tasbeehTarget">الهدف: ٣٣</div>
                <div class="tasbeeh-count" id="tasbeehCount">٠</div>
                <div id="tasbeehLabel" style="font-size:1.4em;color:var(--gold-soft);margin-bottom:15px;font-family:'Scheherazade New',serif">سبحان الله</div>
                <button class="tasbeeh-btn" onclick="incrementTasbeeh()" id="tasbeehBtn">اضغط</button>
                <div class="tasbeeh-controls">
                    <button class="tasbeeh-ctrl-btn" onclick="resetTasbeeh()">إعادة ٠</button>
                    <button class="tasbeeh-ctrl-btn" id="tasbeehTotalBtn">المجموع: ٠</button>
                </div>
            </div>
            </div><!-- end tools-tasbeeh -->

            <!-- Sub: 99 Names -->
            <div id="tools-names" class="sub-section">
            <h2 class="section-title">أسماء الله الحسنى</h2>
            <div class="intro-box">قال رسول الله ﷺ: «إنَّ لِلَّهِ تِسْعَةً وتِسْعِينَ اسْمًا، مِئَةً إلَّا واحِدًا، مَن أحْصاها دَخَلَ الجَنَّةَ» - متفق عليه</div>
            <div class="names-grid" id="namesGrid"></div>
            </div><!-- end tools-names -->

            <!-- Sub: Qibla Compass -->
            <div id="tools-qibla" class="sub-section">
            <h2 class="section-title">اتجاه القبلة</h2>
            <div class="qibla-container">
                <div class="qibla-compass">
                    <span class="qibla-n">N</span><span class="qibla-e">E</span>
                    <span class="qibla-s">S</span><span class="qibla-w">W</span>
                    <div class="qibla-arrow" id="qiblaArrow"></div>
                </div>
                <div class="qibla-degree" id="qiblaDegree">--°</div>
                <div class="qibla-label" id="qiblaLabel">اضغط لتحديد اتجاه القبلة</div>
                <div style="margin-top:15px">
                    <button class="tasbeeh-ctrl-btn" onclick="calculateQibla()">تحديد القبلة</button>
                </div>
            </div>
            </div><!-- end tools-qibla -->

            <!-- Sub: Islamic Calendar -->
            <div id="tools-calendar" class="sub-section">
            <h2 class="section-title">التقويم الهجري</h2>
            <div class="hijri-cal">
                <div class="hijri-cal-header">
                    <button class="hijri-cal-nav" onclick="navHijriCal(-1)">→</button>
                    <div class="hijri-cal-title" id="hijriCalTitle">...</div>
                    <button class="hijri-cal-nav" onclick="navHijriCal(1)">←</button>
                </div>
                <div class="hijri-cal-grid" id="hijriCalGrid"></div>
            </div>
            </div><!-- end tools-calendar -->

            <!-- Sub: Khatm Tracker -->
            <div id="tools-khatm" class="sub-section">
            <h2 class="section-title">ختم القرآن</h2>
            <div class="khatm-container">
                <div class="khatm-progress-ring">
                    <svg width="200" height="200">
                        <circle cx="100" cy="100" r="88" fill="none" stroke="rgba(255,255,255,0.06)" stroke-width="12"/>
                        <circle cx="100" cy="100" r="88" fill="none" stroke="url(#khatmGrad)" stroke-width="12"
                            stroke-dasharray="553" stroke-dashoffset="553" stroke-linecap="round" id="khatmRing"/>
                        <defs><linearGradient id="khatmGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:var(--gold-warm)"/>
                            <stop offset="100%" style="stop-color:#2ecc71"/>
                        </linearGradient></defs>
                    </svg>
                    <div class="khatm-center">
                        <div class="khatm-pct" id="khatmPct">0%</div>
                        <div class="khatm-label">مكتمل</div>
                    </div>
                </div>
                <div class="khatm-stats">
                    <div class="khatm-stat"><div class="khatm-stat-num" id="khatmDoneJuz">0</div><div class="khatm-stat-label">أجزاء مكتملة</div></div>
                    <div class="khatm-stat"><div class="khatm-stat-num" id="khatmRemain">30</div><div class="khatm-stat-label">أجزاء متبقية</div></div>
                    <div class="khatm-stat"><div class="khatm-stat-num" id="khatmCount">0</div><div class="khatm-stat-label">ختمات سابقة</div></div>
                </div>
                <h3 style="color:var(--gold-soft);margin-bottom:12px;font-family:'Amiri',serif">اضغط على الجزء عند إكماله</h3>
                <div class="khatm-juz-grid" id="khatmGrid"></div>
                <div class="khatm-actions">
                    <button class="tasbeeh-ctrl-btn" onclick="resetKhatm()">ختمة جديدة</button>
                </div>
            </div>
            </div><!-- end tools-khatm -->

            <div id="tools-hifz" class="sub-section">
                <h3 class="section-title">متابعة الحفظ</h3>
                <div class="hifz-container">
                    <div class="hifz-progress-bar" id="hifzBar"></div>
                    <div class="hifz-stats" id="hifzStats"></div>
                    <div class="hifz-legend">
                        <div class="hifz-legend-item"><div class="hifz-legend-dot not-started"></div> لم يبدأ</div>
                        <div class="hifz-legend-item"><div class="hifz-legend-dot in-progress"></div> جاري الحفظ</div>
                        <div class="hifz-legend-item"><div class="hifz-legend-dot memorized"></div> محفوظ</div>
                        <div class="hifz-legend-item"><div class="hifz-legend-dot review"></div> يحتاج مراجعة</div>
                    </div>
                    <div class="hifz-grid" id="hifzGrid"></div>
                    <div class="hifz-actions">
                        <button class="r-btn2" onclick="resetHifz()">تصفير الحفظ</button>
                    </div>
                </div>
            </div>

            <div id="tools-history" class="sub-section">
                <h3 class="section-title">سجل القراءة</h3>
                <div class="reading-history-container">
                    <div class="streak-banner">
                        <div class="streak-flame">🔥</div>
                        <div class="streak-num" id="streakNum">0</div>
                        <div class="streak-label">أيام متتالية</div>
                        <div class="streak-best" id="streakBest"></div>
                    </div>
                    <div class="reading-stats-row" id="readingStatsRow"></div>
                    <div class="week-heatmap" id="weekHeatmap"></div>
                    <h4 style="color:var(--gold-soft);margin-bottom:12px;font-family:'Amiri',serif;font-size:1.2em">آخر القراءات</h4>
                    <div class="history-feed" id="historyFeed"></div>
                </div>
            </div>

        </div><!-- end tabTools -->

        <!-- TAB 7: Full Quran Browser (Enhanced) -->
        <div id="tab7" class="content-area">
            <div class="quran-browser">
                <div class="s-list" id="surahListView">
                    <h2 class="section-title">القرآن الكريم</h2>
                    <div class="last-read-card" id="lastReadCard" style="display:none" onclick="resumeLastRead()">
                        <span style="font-size:2em">📖</span>
                        <div style="flex:1">
                            <div style="font-size:1.25em;color:var(--gold-soft);font-weight:600" id="lrTitle">متابعة القراءة</div>
                            <div style="font-size:1.05em;color:var(--cream-soft);opacity:0.8" id="lrDetail"></div>
                        </div>
                        <span style="font-size:1.4em;color:var(--gold-soft)">←</span>
                    </div>
                    <div class="bookmarks-bar" id="bmBar"></div>
                    <input type="text" class="quran-search" id="surahSearch" placeholder="ابحث عن سورة أو نص في القرآن..." oninput="onQuranSearch()">
                    <div class="q-filters2">
                        <button class="q-filter2 on" onclick="setQFilter('all',this)">الكل (114)</button>
                        <button class="q-filter2" onclick="setQFilter('mec',this)">مكية (86)</button>
                        <button class="q-filter2" onclick="setQFilter('med',this)">مدنية (28)</button>
                        <button class="q-filter2" onclick="setQFilter('hl',this)" id="hlFilterBtn">المميزة</button>
                        <button class="q-filter2" id="offlineBtn" onclick="downloadAllSurahs()">تحميل للقراءة بدون إنترنت</button>
                        <button class="q-filter2" onclick="toggleJuzView()">تصفح بالأجزاء</button>
                    </div>
                    <div class="offline-progress" id="offlineProgress" style="display:none">
                        <div class="offline-bar"><div class="offline-fill" id="offlineFill"></div></div>
                        <div class="offline-label" id="offlineLabel"></div>
                    </div>
                    <div class="quran-search-results" id="quranSearchResults"></div>
                    <div class="juz-grid" id="juzGrid" style="display:none"></div>
                    <div class="surah-grid" id="surahGrid"></div>
                </div>
                <div class="s-reader2" id="surahReaderView">
                    <div class="r-head2">
                        <button class="r-btn2" onclick="backToSurahList()">→ القائمة</button>
                        <div class="r-title2">
                            <h3 id="readerTitle"></h3>
                            <div class="r-meta2" id="readerInfo"></div>
                        </div>
                        <div class="r-nav2">
                            <button class="r-btn2" onclick="navSurah(-1)" id="prevSurahBtn">السابقة →</button>
                            <button class="r-btn2" id="bmSurahBtn" onclick="toggleSurahBM()">🔖</button>
                            <button class="r-btn2" onclick="navSurah(1)" id="nextSurahBtn">← التالية</button>
                        </div>
                    </div>
                    <div id="readerContent"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Generate animated stars
    function createStars() {
        const container = document.getElementById('stars');
        const starCount = 100;

        for (let i = 0; i < starCount; i++) {
            const star = document.createElement('div');
            star.className = 'star';

            // Random position
            star.style.left = Math.random() * 100 + '%';
            star.style.top = Math.random() * 100 + '%';

            // Random size (1-3px)
            const size = Math.random() * 2 + 1;
            star.style.width = size + 'px';
            star.style.height = size + 'px';

            // Random animation duration (3-8 seconds)
            star.style.setProperty('--duration', (Math.random() * 5 + 3) + 's');

            // Random opacity (0.3-0.8)
            star.style.setProperty('--opacity', Math.random() * 0.5 + 0.3);

            // Random animation delay
            star.style.animationDelay = Math.random() * 5 + 's';

            container.appendChild(star);
        }
    }

    // Initialize stars
    createStars();

    // Scroll to top button visibility
    const scrollTopBtn = document.getElementById('scrollTopBtn');
    window.addEventListener('scroll', function() {
        if (window.scrollY > 300) {
            scrollTopBtn.classList.add('visible');
        } else {
            scrollTopBtn.classList.remove('visible');
        }
    });

    function switchTab(tabId, button) {
        // Hide all content areas
        const contentAreas = document.querySelectorAll('.content-area');
        contentAreas.forEach(area => area.classList.remove('active'));

        // Remove active class from all buttons
        const buttons = document.querySelectorAll('.tab-btn');
        buttons.forEach(btn => btn.classList.remove('active'));

        // Show selected tab
        document.getElementById(tabId).classList.add('active');
        button.classList.add('active');

        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });

        // Init Quran browser when tab7 is shown
        if (tabId === 'tab7') initQuran();
        // Init tools when tools tab is shown
        if (tabId === 'tabTools') initTools();
        // Init home data
        if (tabId === 'tabHome') initHome();
    }

    // Sub-navigation within tabs
    function switchSub(tabId, subId, btn) {
        var tab = document.getElementById(tabId);
        if (!tab) return;
        tab.querySelectorAll('.sub-section').forEach(function(s) { s.classList.remove('active'); });
        tab.querySelectorAll('.sub-nav-btn').forEach(function(b) { b.classList.remove('active'); });
        var sub = document.getElementById(subId);
        if (sub) sub.classList.add('active');
        if (btn) btn.classList.add('active');
    }

    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 'ArrowRight') {
            const currentBtn = document.querySelector('.tab-btn.active');
            const nextBtn = currentBtn.nextElementSibling;
            if (nextBtn && nextBtn.classList.contains('tab-btn')) {
                nextBtn.click();
            }
        } else if ((e.ctrlKey || e.metaKey) && e.key === 'ArrowLeft') {
            const currentBtn = document.querySelector('.tab-btn.active');
            const prevBtn = currentBtn.previousElementSibling;
            if (prevBtn && prevBtn.classList.contains('tab-btn')) {
                prevBtn.click();
            }
        }
    });

    // Add subtle parallax effect to stars on scroll
    window.addEventListener('scroll', function() {
        const scrollTop = window.scrollY;
        const stars = document.getElementById('stars');
        stars.style.transform = `translateY(${scrollTop * 0.1}px)`;
    });
</script>

<script>
    // ═══════════════════════════════════════
    // Enhanced Quran Browser with Bookmarks & Auto-Resume
    // ═══════════════════════════════════════
    const SURAH_DATA = [
        {n:1,name:"الفاتحة",en:"Al-Fatihah",ayahs:7,type:"meccan"},
        {n:2,name:"البقرة",en:"Al-Baqarah",ayahs:286,type:"medinan"},
        {n:3,name:"آل عمران",en:"Aal-Imran",ayahs:200,type:"medinan"},
        {n:4,name:"النساء",en:"An-Nisa",ayahs:176,type:"medinan"},
        {n:5,name:"المائدة",en:"Al-Ma'idah",ayahs:120,type:"medinan"},
        {n:6,name:"الأنعام",en:"Al-An'am",ayahs:165,type:"meccan"},
        {n:7,name:"الأعراف",en:"Al-A'raf",ayahs:206,type:"meccan"},
        {n:8,name:"الأنفال",en:"Al-Anfal",ayahs:75,type:"medinan"},
        {n:9,name:"التوبة",en:"At-Tawbah",ayahs:129,type:"medinan"},
        {n:10,name:"يونس",en:"Yunus",ayahs:109,type:"meccan"},
        {n:11,name:"هود",en:"Hud",ayahs:123,type:"meccan"},
        {n:12,name:"يوسف",en:"Yusuf",ayahs:111,type:"meccan"},
        {n:13,name:"الرعد",en:"Ar-Ra'd",ayahs:43,type:"medinan"},
        {n:14,name:"إبراهيم",en:"Ibrahim",ayahs:52,type:"meccan"},
        {n:15,name:"الحجر",en:"Al-Hijr",ayahs:99,type:"meccan"},
        {n:16,name:"النحل",en:"An-Nahl",ayahs:128,type:"meccan"},
        {n:17,name:"الإسراء",en:"Al-Isra",ayahs:111,type:"meccan"},
        {n:18,name:"الكهف",en:"Al-Kahf",ayahs:110,type:"meccan"},
        {n:19,name:"مريم",en:"Maryam",ayahs:98,type:"meccan"},
        {n:20,name:"طه",en:"Ta-Ha",ayahs:135,type:"meccan"},
        {n:21,name:"الأنبياء",en:"Al-Anbiya",ayahs:112,type:"meccan"},
        {n:22,name:"الحج",en:"Al-Hajj",ayahs:78,type:"medinan"},
        {n:23,name:"المؤمنون",en:"Al-Mu'minun",ayahs:118,type:"meccan"},
        {n:24,name:"النور",en:"An-Nur",ayahs:64,type:"medinan"},
        {n:25,name:"الفرقان",en:"Al-Furqan",ayahs:77,type:"meccan"},
        {n:26,name:"الشعراء",en:"Ash-Shu'ara",ayahs:227,type:"meccan"},
        {n:27,name:"النمل",en:"An-Naml",ayahs:93,type:"meccan"},
        {n:28,name:"القصص",en:"Al-Qasas",ayahs:88,type:"meccan"},
        {n:29,name:"العنكبوت",en:"Al-Ankabut",ayahs:69,type:"meccan"},
        {n:30,name:"الروم",en:"Ar-Rum",ayahs:60,type:"meccan"},
        {n:31,name:"لقمان",en:"Luqman",ayahs:34,type:"meccan"},
        {n:32,name:"السجدة",en:"As-Sajdah",ayahs:30,type:"meccan"},
        {n:33,name:"الأحزاب",en:"Al-Ahzab",ayahs:73,type:"medinan"},
        {n:34,name:"سبأ",en:"Saba",ayahs:54,type:"meccan"},
        {n:35,name:"فاطر",en:"Fatir",ayahs:45,type:"meccan"},
        {n:36,name:"يس",en:"Ya-Sin",ayahs:83,type:"meccan"},
        {n:37,name:"الصافات",en:"As-Saffat",ayahs:182,type:"meccan"},
        {n:38,name:"ص",en:"Sad",ayahs:88,type:"meccan"},
        {n:39,name:"الزمر",en:"Az-Zumar",ayahs:75,type:"meccan"},
        {n:40,name:"غافر",en:"Ghafir",ayahs:85,type:"meccan"},
        {n:41,name:"فصلت",en:"Fussilat",ayahs:54,type:"meccan"},
        {n:42,name:"الشورى",en:"Ash-Shura",ayahs:53,type:"meccan"},
        {n:43,name:"الزخرف",en:"Az-Zukhruf",ayahs:89,type:"meccan"},
        {n:44,name:"الدخان",en:"Ad-Dukhan",ayahs:59,type:"meccan"},
        {n:45,name:"الجاثية",en:"Al-Jathiyah",ayahs:37,type:"meccan"},
        {n:46,name:"الأحقاف",en:"Al-Ahqaf",ayahs:35,type:"meccan"},
        {n:47,name:"محمد",en:"Muhammad",ayahs:38,type:"medinan"},
        {n:48,name:"الفتح",en:"Al-Fath",ayahs:29,type:"medinan"},
        {n:49,name:"الحجرات",en:"Al-Hujurat",ayahs:18,type:"medinan"},
        {n:50,name:"ق",en:"Qaf",ayahs:45,type:"meccan"},
        {n:51,name:"الذاريات",en:"Adh-Dhariyat",ayahs:60,type:"meccan"},
        {n:52,name:"الطور",en:"At-Tur",ayahs:49,type:"meccan"},
        {n:53,name:"النجم",en:"An-Najm",ayahs:62,type:"meccan"},
        {n:54,name:"القمر",en:"Al-Qamar",ayahs:55,type:"meccan"},
        {n:55,name:"الرحمن",en:"Ar-Rahman",ayahs:78,type:"medinan"},
        {n:56,name:"الواقعة",en:"Al-Waqi'ah",ayahs:96,type:"meccan"},
        {n:57,name:"الحديد",en:"Al-Hadid",ayahs:29,type:"medinan"},
        {n:58,name:"المجادلة",en:"Al-Mujadilah",ayahs:22,type:"medinan"},
        {n:59,name:"الحشر",en:"Al-Hashr",ayahs:24,type:"medinan"},
        {n:60,name:"الممتحنة",en:"Al-Mumtahanah",ayahs:13,type:"medinan"},
        {n:61,name:"الصف",en:"As-Saff",ayahs:14,type:"medinan"},
        {n:62,name:"الجمعة",en:"Al-Jumu'ah",ayahs:11,type:"medinan"},
        {n:63,name:"المنافقون",en:"Al-Munafiqun",ayahs:11,type:"medinan"},
        {n:64,name:"التغابن",en:"At-Taghabun",ayahs:18,type:"medinan"},
        {n:65,name:"الطلاق",en:"At-Talaq",ayahs:12,type:"medinan"},
        {n:66,name:"التحريم",en:"At-Tahrim",ayahs:12,type:"medinan"},
        {n:67,name:"الملك",en:"Al-Mulk",ayahs:30,type:"meccan"},
        {n:68,name:"القلم",en:"Al-Qalam",ayahs:52,type:"meccan"},
        {n:69,name:"الحاقة",en:"Al-Haqqah",ayahs:52,type:"meccan"},
        {n:70,name:"المعارج",en:"Al-Ma'arij",ayahs:44,type:"meccan"},
        {n:71,name:"نوح",en:"Nuh",ayahs:28,type:"meccan"},
        {n:72,name:"الجن",en:"Al-Jinn",ayahs:28,type:"meccan"},
        {n:73,name:"المزمل",en:"Al-Muzzammil",ayahs:20,type:"meccan"},
        {n:74,name:"المدثر",en:"Al-Muddathir",ayahs:56,type:"meccan"},
        {n:75,name:"القيامة",en:"Al-Qiyamah",ayahs:40,type:"meccan"},
        {n:76,name:"الإنسان",en:"Al-Insan",ayahs:31,type:"medinan"},
        {n:77,name:"المرسلات",en:"Al-Mursalat",ayahs:50,type:"meccan"},
        {n:78,name:"النبأ",en:"An-Naba",ayahs:40,type:"meccan"},
        {n:79,name:"النازعات",en:"An-Nazi'at",ayahs:46,type:"meccan"},
        {n:80,name:"عبس",en:"Abasa",ayahs:42,type:"meccan"},
        {n:81,name:"التكوير",en:"At-Takwir",ayahs:29,type:"meccan"},
        {n:82,name:"الانفطار",en:"Al-Infitar",ayahs:19,type:"meccan"},
        {n:83,name:"المطففين",en:"Al-Mutaffifin",ayahs:36,type:"meccan"},
        {n:84,name:"الانشقاق",en:"Al-Inshiqaq",ayahs:25,type:"meccan"},
        {n:85,name:"البروج",en:"Al-Buruj",ayahs:22,type:"meccan"},
        {n:86,name:"الطارق",en:"At-Tariq",ayahs:17,type:"meccan"},
        {n:87,name:"الأعلى",en:"Al-A'la",ayahs:19,type:"meccan"},
        {n:88,name:"الغاشية",en:"Al-Ghashiyah",ayahs:26,type:"meccan"},
        {n:89,name:"الفجر",en:"Al-Fajr",ayahs:30,type:"meccan"},
        {n:90,name:"البلد",en:"Al-Balad",ayahs:20,type:"meccan"},
        {n:91,name:"الشمس",en:"Ash-Shams",ayahs:15,type:"meccan"},
        {n:92,name:"الليل",en:"Al-Layl",ayahs:21,type:"meccan"},
        {n:93,name:"الضحى",en:"Ad-Duha",ayahs:11,type:"meccan"},
        {n:94,name:"الشرح",en:"Ash-Sharh",ayahs:8,type:"meccan"},
        {n:95,name:"التين",en:"At-Tin",ayahs:8,type:"meccan"},
        {n:96,name:"العلق",en:"Al-Alaq",ayahs:19,type:"meccan"},
        {n:97,name:"القدر",en:"Al-Qadr",ayahs:5,type:"meccan"},
        {n:98,name:"البينة",en:"Al-Bayyinah",ayahs:8,type:"medinan"},
        {n:99,name:"الزلزلة",en:"Az-Zalzalah",ayahs:8,type:"medinan"},
        {n:100,name:"العاديات",en:"Al-Adiyat",ayahs:11,type:"meccan"},
        {n:101,name:"القارعة",en:"Al-Qari'ah",ayahs:11,type:"meccan"},
        {n:102,name:"التكاثر",en:"At-Takathur",ayahs:8,type:"meccan"},
        {n:103,name:"العصر",en:"Al-Asr",ayahs:3,type:"meccan"},
        {n:104,name:"الهمزة",en:"Al-Humazah",ayahs:9,type:"meccan"},
        {n:105,name:"الفيل",en:"Al-Fil",ayahs:5,type:"meccan"},
        {n:106,name:"قريش",en:"Quraysh",ayahs:4,type:"meccan"},
        {n:107,name:"الماعون",en:"Al-Ma'un",ayahs:7,type:"meccan"},
        {n:108,name:"الكوثر",en:"Al-Kawthar",ayahs:3,type:"meccan"},
        {n:109,name:"الكافرون",en:"Al-Kafirun",ayahs:6,type:"meccan"},
        {n:110,name:"النصر",en:"An-Nasr",ayahs:3,type:"medinan"},
        {n:111,name:"المسد",en:"Al-Masad",ayahs:5,type:"meccan"},
        {n:112,name:"الإخلاص",en:"Al-Ikhlas",ayahs:4,type:"meccan"},
        {n:113,name:"الفلق",en:"Al-Falaq",ayahs:5,type:"meccan"},
        {n:114,name:"الناس",en:"An-Nas",ayahs:6,type:"meccan"}
    ];

    let currentSurahNum = 0, curFilter = 'all';
    const BM_KEY = 'iq_bookmarks', LR_KEY = 'iq_last_read';
    function toArabicNum(n) { return String(n).replace(/\d/g, function(d) { return '٠١٢٣٤٥٦٧٨٩'[d]; }); }

    function getBM() { try { return JSON.parse(localStorage.getItem(BM_KEY)) || []; } catch(e) { return []; } }
    function saveBM(bm) { localStorage.setItem(BM_KEY, JSON.stringify(bm)); }
    function getLR() { try { return JSON.parse(localStorage.getItem(LR_KEY)); } catch(e) { return null; } }
    function saveLR(d) { localStorage.setItem(LR_KEY, JSON.stringify(d)); }

    function initQuran() { renderSurahGrid2(); renderBM(); renderLR(); checkOfflineStatus(); updateHLCount(); }

    function getHighlightedSurahs() {
        try { return JSON.parse(localStorage.getItem('iq_hl_surahs')) || []; } catch(e) { return []; }
    }
    function saveHighlightedSurahs(arr) {
        try { localStorage.setItem('iq_hl_surahs', JSON.stringify(arr)); } catch(e) {}
    }
    function toggleSurahHL(num, e) {
        e.stopPropagation();
        var hl = getHighlightedSurahs();
        var idx = hl.indexOf(num);
        if (idx >= 0) hl.splice(idx, 1); else hl.push(num);
        saveHighlightedSurahs(hl);
        renderSurahGrid2();
        updateHLCount();
    }
    function updateHLCount() {
        var btn = document.getElementById('hlFilterBtn');
        if (!btn) return;
        var count = getHighlightedSurahs().length;
        btn.textContent = 'المميزة' + (count ? ' (' + count + ')' : '');
    }

    function renderSurahGrid2() {
        const grid = document.getElementById('surahGrid');
        if (!grid) return;
        const q = (document.getElementById('surahSearch').value || '').trim().toLowerCase();
        const bm = getBM();
        const hl = getHighlightedSurahs();
        grid.innerHTML = SURAH_DATA.filter(function(s) {
            if (curFilter === 'mec' && s.type !== 'meccan') return false;
            if (curFilter === 'med' && s.type !== 'medinan') return false;
            if (curFilter === 'hl' && hl.indexOf(s.n) < 0) return false;
            if (q && !s.name.includes(q) && !s.en.toLowerCase().includes(q) && !String(s.n).includes(q)) return false;
            return true;
        }).map(function(s) {
            const hasBM = bm.some(function(b) { return b.s === s.n; });
            const isHL = hl.indexOf(s.n) >= 0;
            const tCls = s.type === 'meccan' ? 'meccan' : 'medinan';
            const tLbl = s.type === 'meccan' ? 'مكية' : 'مدنية';
            return '<div class="surah-card'+(isHL?' highlighted':'')+'" onclick="openSurah('+s.n+')">'
                + '<button class="surah-hl-btn'+(isHL?' on':'')+'" onclick="toggleSurahHL('+s.n+',event)" title="تمييز السورة">'+(isHL?'★':'☆')+'</button>'
                + (hasBM ? '<span style="position:absolute;top:8px;left:38px;color:var(--gold-bright)">🔖</span>' : '')
                + '<div class="surah-card-num">'+s.n+'</div>'
                + '<div class="surah-card-info">'
                + '<div class="surah-card-name">سورة '+s.name+'</div>'
                + '<div class="surah-card-meta">'+s.ayahs+' آية <span class="surah-card-type '+tCls+'">'+tLbl+'</span></div>'
                + '</div></div>';
        }).join('') || '<div style="text-align:center;padding:40px;color:var(--text-muted);font-size:1.3em;grid-column:1/-1">لا توجد نتائج</div>';
    }

    function filterSurahs2() { renderSurahGrid2(); }

    function setQFilter(f, btn) {
        curFilter = f;
        document.querySelectorAll('.q-filter2').forEach(function(b) { b.classList.remove('on'); });
        btn.classList.add('on');
        renderSurahGrid2();
    }

    function renderBM() {
        const bar = document.getElementById('bmBar');
        if (!bar) return;
        const bm = getBM();
        if (!bm.length) { bar.innerHTML = ''; return; }
        bar.innerHTML = bm.map(function(b, i) {
            const s = SURAH_DATA.find(function(x) { return x.n === b.s; });
            if (!s) return '';
            const label = b.a ? s.name + ' - آية ' + b.a : s.name;
            return '<div class="bm-chip" onclick="openSurah('+b.s+(b.a?','+b.a:'')+')">'
                + '🔖 ' + label
                + ' <span class="bm-x" onclick="event.stopPropagation();removeBM('+i+')">✕</span>'
                + '</div>';
        }).join('');
    }

    function removeBM(idx) {
        const bm = getBM(); bm.splice(idx, 1); saveBM(bm);
        renderBM(); renderSurahGrid2();
    }

    function renderLR() {
        const lr = getLR();
        const card = document.getElementById('lastReadCard');
        if (!card) return;
        if (!lr) { card.style.display = 'none'; return; }
        const s = SURAH_DATA.find(function(x) { return x.n === lr.s; });
        if (!s) { card.style.display = 'none'; return; }
        document.getElementById('lrTitle').textContent = 'متابعة القراءة - سورة ' + s.name;
        document.getElementById('lrDetail').textContent = lr.a ? 'الآية ' + lr.a + ' من ' + s.ayahs : s.ayahs + ' آية';
        card.style.display = 'flex';
    }

    function resumeLastRead() {
        const lr = getLR();
        if (lr) openSurah(lr.s, lr.a);
    }

    async function openSurah(num, scrollToAyah) {
        currentSurahNum = num;
        const surah = SURAH_DATA.find(function(s) { return s.n === num; });

        document.getElementById('surahListView').classList.add('off');
        document.getElementById('surahReaderView').classList.add('on');

        document.getElementById('readerTitle').textContent = 'سورة ' + surah.name;
        document.getElementById('readerInfo').textContent = surah.en + ' | ' + surah.ayahs + ' آية | ' + (surah.type === 'meccan' ? 'مكية' : 'مدنية');

        document.getElementById('prevSurahBtn').disabled = (num <= 1);
        document.getElementById('nextSurahBtn').disabled = (num >= 114);

        const bm = getBM();
        var bmBtn = document.getElementById('bmSurahBtn');
        if (bmBtn) bmBtn.classList.toggle('bm-on', bm.some(function(b) { return b.s === num && !b.a; }));

        document.getElementById('readerContent').innerHTML = '<div class="q-loading2">جاري تحميل السورة...<div class="q-spinner2"></div></div>';
        window.scrollTo({ top: 0, behavior: 'smooth' });

        try {
            const ayahs = await fetchSurah(num);
            let html = '';
            if (num !== 1 && num !== 9) {
                html += '<div class="bismillah-box2">بِسْمِ ٱللَّهِ ٱلرَّحْمَـٰنِ ٱلرَّحِيمِ</div>';
            }
            const ayahBMs = bm.filter(function(b) { return b.s === num && b.a; });
            const lr = getLR();
            html += '<div class="surah-para">';
            ayahs.forEach(function(a) {
                var text = a.text;
                if (a.numberInSurah === 1 && num !== 1 && num !== 9) {
                    text = text.replace(/^بِسْمِ ٱللَّهِ ٱلرَّحْمَٰنِ ٱلرَّحِيمِ\s*/, '');
                }
                var isABM = ayahBMs.some(function(b) { return b.a === a.numberInSurah; });
                var isLR = lr && lr.s === num && lr.a === a.numberInSurah;
                var cls = 'ayah-span' + (isLR ? ' lr-hl' : '') + (isABM ? ' bm-hl' : '');
                var anum = toArabicNum(a.numberInSurah);
                html += '<span class="'+cls+'" data-ayah="'+a.numberInSurah+'" id="ayah-'+a.numberInSurah+'">'+text+'</span>'
                    + '<span class="ayah-num-inline'+(isABM?' on':'')+'" onclick="toggleAyahBM('+num+','+a.numberInSurah+',this)"> ﴿'+anum+'﴾ </span>';
            });
            html += '</div>';
            document.getElementById('readerContent').innerHTML = html;
            var para = document.querySelector('.surah-para');
            if (para) para.addEventListener('click', onAyahTap);
        } catch (err) {
            document.getElementById('readerContent').innerHTML =
                '<div class="q-loading2" style="color:#e74c3c">حدث خطأ في تحميل السورة. تأكد من اتصال الإنترنت.<br><br>'
                + '<button class="r-btn2" onclick="openSurah('+num+')">إعادة المحاولة</button></div>';
            return;
        }

        hideAyahPopup();
        saveLR({ s: num, a: scrollToAyah || 1, t: Date.now() });

        if (scrollToAyah) {
            setTimeout(function() {
                var el = document.getElementById('ayah-' + scrollToAyah);
                if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 150);
        }
        setupAutoSave();
    }

    async function fetchSurah(num) {
        const cacheKey = 'quran-surah-' + num;
        const cached = localStorage.getItem(cacheKey);
        if (cached) return JSON.parse(cached);

        const resp = await fetch('https://api.alquran.cloud/v1/surah/' + num);
        if (!resp.ok) throw new Error('API error');
        const data = await resp.json();
        const ayahs = data.data.ayahs.map(function(a) { return { text: a.text, numberInSurah: a.numberInSurah }; });

        try { localStorage.setItem(cacheKey, JSON.stringify(ayahs)); } catch (e) {}
        return ayahs;
    }

    async function downloadAllSurahs() {
        var btn = document.getElementById('offlineBtn');
        var prog = document.getElementById('offlineProgress');
        var fill = document.getElementById('offlineFill');
        var label = document.getElementById('offlineLabel');

        // Count already cached
        var cached = 0;
        for (var i = 1; i <= 114; i++) {
            if (localStorage.getItem('quran-surah-' + i)) cached++;
        }
        if (cached === 114) {
            btn.textContent = 'تم التحميل بالكامل ✓';
            btn.classList.add('on');
            return;
        }

        btn.disabled = true;
        btn.textContent = 'جاري التحميل...';
        prog.style.display = 'block';
        var done = 0, failed = 0;

        for (var i = 1; i <= 114; i++) {
            if (localStorage.getItem('quran-surah-' + i)) {
                done++;
                fill.style.width = Math.round((done / 114) * 100) + '%';
                label.textContent = done + ' / 114';
                continue;
            }
            try {
                await fetchSurah(i);
                done++;
            } catch (e) {
                done++;
                failed++;
            }
            fill.style.width = Math.round((done / 114) * 100) + '%';
            label.textContent = done + ' / 114' + (failed ? ' (' + failed + ' فشل)' : '');
            // Small delay to avoid hammering the API
            await new Promise(function(r) { setTimeout(r, 80); });
        }

        btn.disabled = false;
        if (failed === 0) {
            btn.textContent = 'تم التحميل بالكامل ✓';
            btn.classList.add('on');
            label.textContent = 'جميع السور متاحة بدون إنترنت';
        } else {
            btn.textContent = 'إعادة المحاولة (' + failed + ' متبقية)';
            label.textContent = 'بعض السور لم تُحمّل - حاول مرة أخرى';
        }
    }

    function checkOfflineStatus() {
        var cached = 0;
        for (var i = 1; i <= 114; i++) {
            if (localStorage.getItem('quran-surah-' + i)) cached++;
        }
        var btn = document.getElementById('offlineBtn');
        if (!btn) return;
        if (cached === 114) {
            btn.textContent = 'متاح بدون إنترنت ✓';
            btn.classList.add('on');
        } else if (cached > 0) {
            btn.textContent = 'تحميل للقراءة بدون إنترنت (' + cached + '/114)';
        }
    }

    function backToSurahList() {
        document.getElementById('surahReaderView').classList.remove('on');
        document.getElementById('surahListView').classList.remove('off');
        currentSurahNum = 0;
        renderBM(); renderLR(); renderSurahGrid2();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function navSurah(dir) {
        var next = currentSurahNum + dir;
        if (next >= 1 && next <= 114) openSurah(next);
    }

    function toggleSurahBM() {
        if (!currentSurahNum) return;
        var bm = getBM();
        var idx = bm.findIndex(function(b) { return b.s === currentSurahNum && !b.a; });
        if (idx >= 0) { bm.splice(idx, 1); } else { bm.push({ s: currentSurahNum }); }
        saveBM(bm);
        var btn = document.getElementById('bmSurahBtn');
        if (btn) btn.classList.toggle('bm-on', idx < 0);
    }

    function toggleAyahBM(surah, ayah, el) {
        var bm = getBM();
        var idx = bm.findIndex(function(b) { return b.s === surah && b.a === ayah; });
        var ayahSpan = document.getElementById('ayah-' + ayah);
        if (idx >= 0) { bm.splice(idx, 1); el.classList.remove('on'); if (ayahSpan) ayahSpan.classList.remove('bm-hl'); }
        else { bm.push({ s: surah, a: ayah }); el.classList.add('on'); if (ayahSpan) ayahSpan.classList.add('bm-hl'); }
        saveBM(bm);
    }

    // --- Ayah tap-to-select ---
    var selectedAyahNum = null;
    function onAyahTap(e) {
        var span = e.target.closest('.ayah-span');
        if (!span || !currentSurahNum) return;
        var ayahNum = parseInt(span.dataset.ayah);
        if (selectedAyahNum === ayahNum) { hideAyahPopup(); return; }
        document.querySelectorAll('.ayah-span.selected').forEach(function(el) { el.classList.remove('selected'); });
        span.classList.add('selected');
        selectedAyahNum = ayahNum;
        var surah = SURAH_DATA.find(function(s) { return s.n === currentSurahNum; });
        var label = 'آية ' + ayahNum + ' - سورة ' + surah.name;
        document.getElementById('ayahPopupLabel').textContent = label;
        var bm = getBM();
        var isBM = bm.some(function(b) { return b.s === currentSurahNum && b.a === ayahNum; });
        document.getElementById('ayahPopupSave').textContent = isBM ? 'إزالة 🔖' : 'حفظ 🔖';
        document.getElementById('ayahPopup').classList.add('show');
    }
    function hideAyahPopup() {
        document.getElementById('ayahPopup').classList.remove('show');
        document.querySelectorAll('.ayah-span.selected').forEach(function(el) { el.classList.remove('selected'); });
        selectedAyahNum = null;
    }
    function saveSelectedAyah() {
        if (!selectedAyahNum || !currentSurahNum) return;
        var numEl = null;
        var nums = document.querySelectorAll('.ayah-num-inline');
        for (var i = 0; i < nums.length; i++) {
            var prev = nums[i].previousElementSibling;
            if (prev && parseInt(prev.dataset.ayah) === selectedAyahNum) { numEl = nums[i]; break; }
        }
        if (numEl) toggleAyahBM(currentSurahNum, selectedAyahNum, numEl);
        var bm = getBM();
        var isBM = bm.some(function(b) { return b.s === currentSurahNum && b.a === selectedAyahNum; });
        document.getElementById('ayahPopupSave').textContent = isBM ? 'إزالة 🔖' : 'حفظ 🔖';
    }
    function resumeFromSelected() {
        if (!selectedAyahNum || !currentSurahNum) return;
        saveLR({ s: currentSurahNum, a: selectedAyahNum, t: Date.now() });
        document.querySelectorAll('.ayah-span.lr-hl').forEach(function(el) { el.classList.remove('lr-hl'); });
        var span = document.getElementById('ayah-' + selectedAyahNum);
        if (span) span.classList.add('lr-hl');
        hideAyahPopup();
    }
    document.addEventListener('click', function(e) {
        if (e.target.closest('.ayah-popup') || e.target.closest('.ayah-span') || e.target.closest('.ayah-num-inline')) return;
        hideAyahPopup();
    });

    // ═══════════════════════════════════════
    // Tafseer Feature
    // ═══════════════════════════════════════
    var currentTafseerSlug = 'ar-tafseer-al-saddi';
    var tafseerCache = {};

    function openTafseer() {
        if (!selectedAyahNum || !currentSurahNum) return;
        var surah = SURAH_DATA.find(function(s) { return s.n === currentSurahNum; });
        document.getElementById('tafseerTitle').textContent = 'تفسير آية ' + selectedAyahNum + ' - سورة ' + surah.name;
        document.getElementById('tafseerOverlay').classList.add('show');
        document.getElementById('tafseerPanel').classList.add('show');
        fetchTafseer(currentTafseerSlug, currentSurahNum, selectedAyahNum);
    }

    function closeTafseer() {
        document.getElementById('tafseerOverlay').classList.remove('show');
        document.getElementById('tafseerPanel').classList.remove('show');
    }

    function switchTafseer(slug, btn) {
        currentTafseerSlug = slug;
        document.querySelectorAll('.tafseer-tab').forEach(function(t) { t.classList.remove('active'); });
        if (btn) btn.classList.add('active');
        if (selectedAyahNum && currentSurahNum) {
            fetchTafseer(slug, currentSurahNum, selectedAyahNum);
        }
    }

    function fetchTafseer(slug, surah, ayah) {
        var body = document.getElementById('tafseerBody');
        var cacheKey = slug + '-' + surah + '-' + ayah;

        if (tafseerCache[cacheKey]) {
            renderTafseer(tafseerCache[cacheKey], surah, ayah);
            return;
        }

        body.innerHTML = '<div class="tafseer-loading">جاري تحميل التفسير...</div>';

        var url = 'https://cdn.jsdelivr.net/gh/spa5k/tafsir_api@main/tafsir/' + slug + '/' + surah + '/' + ayah + '.json';
        fetch(url)
            .then(function(r) {
                if (!r.ok) throw new Error('Not found');
                return r.json();
            })
            .then(function(d) {
                tafseerCache[cacheKey] = d.text || '';
                renderTafseer(d.text || '', surah, ayah);
            })
            .catch(function() {
                body.innerHTML = '<div class="tafseer-loading">لم يتوفر تفسير لهذه الآية. جرب تفسيراً آخر.</div>';
            });
    }

    function renderTafseer(text, surah, ayah) {
        var body = document.getElementById('tafseerBody');
        var ayahSpan = document.getElementById('ayah-' + ayah);
        var ayahText = ayahSpan ? ayahSpan.textContent.trim() : '';
        var html = '';
        if (ayahText) {
            html += '<div class="tafseer-ayah-text">﴿ ' + ayahText + ' ﴾</div>';
        }
        html += '<div>' + text.replace(/\n/g, '<br>') + '</div>';
        body.innerHTML = html;
        body.scrollTop = 0;
    }

    var autoSaveTimer = null;
    function setupAutoSave() {
        window.removeEventListener('scroll', onReaderScroll);
        window.addEventListener('scroll', onReaderScroll);
    }
    function onReaderScroll() {
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(function() {
            if (!currentSurahNum) return;
            var spans = document.querySelectorAll('.ayah-span');
            var visAyah = null;
            for (var i = 0; i < spans.length; i++) {
                var r = spans[i].getBoundingClientRect();
                if (r.top >= -100 && r.top <= window.innerHeight) {
                    visAyah = parseInt(spans[i].dataset.ayah);
                    break;
                }
            }
            if (visAyah) saveLR({ s: currentSurahNum, a: visAyah, t: Date.now() });
        }, 600);
    }

    // Initialize surah grid
    renderSurahGrid2();
</script>

<script>
    // ═══════════════════════════════════════
    // Home Tab: Prayer Times, Daily Ayah, Hijri Date
    // ═══════════════════════════════════════
    var prayerTimesCache = null;

    var userLat = null, userLng = null;
    var currentHijriDay = 0, currentHijriMonth = 0, currentHijriYear = 0;

    function initHome() {
        loadDailyAyah();
        if (!prayerTimesCache) fetchPrayerTimes();
        startLiveCountdown();
        initHijriCal();
    }

    function loadDailyAyah() {
        var textEl = document.getElementById('dailyAyahText');
        var refEl = document.getElementById('dailyAyahRef');
        if (!textEl) return;
        var dailyVerses = [
            {s:2,a:286},{s:3,a:8},{s:2,a:201},{s:21,a:87},{s:40,a:60},
            {s:65,a:3},{s:94,a:6},{s:2,a:152},{s:13,a:28},{s:3,a:139},
            {s:39,a:53},{s:16,a:97},{s:29,a:69},{s:73,a:8},{s:6,a:162}
        ];
        var dayIdx = Math.floor(Date.now() / 86400000) % dailyVerses.length;
        var pick = dailyVerses[dayIdx];
        // Check localStorage cache first
        var cacheKey = 'iq_daily_ayah';
        try {
            var cached = JSON.parse(localStorage.getItem(cacheKey));
            if (cached && cached.day === dayIdx) {
                textEl.textContent = cached.text;
                if (refEl) { refEl.style.display = 'block'; refEl.textContent = cached.ref; }
                return;
            }
        } catch(e) {}
        fetch('https://api.alquran.cloud/v1/ayah/' + pick.s + ':' + pick.a)
            .then(function(r) { return r.json(); })
            .then(function(d) {
                if (d.code === 200) {
                    textEl.textContent = d.data.text;
                    var surahName = SURAH_DATA.find(function(x) { return x.n === pick.s; });
                    var refText = 'سورة ' + (surahName ? surahName.name : pick.s) + ' - آية ' + pick.a;
                    if (refEl) {
                        refEl.style.display = 'block';
                        refEl.textContent = refText;
                    }
                    try { localStorage.setItem(cacheKey, JSON.stringify({day:dayIdx, text:d.data.text, ref:refText})); } catch(e) {}
                }
            }).catch(function() {
                textEl.textContent = 'وَإِذَا سَأَلَكَ عِبَادِي عَنِّي فَإِنِّي قَرِيبٌ';
                if (refEl) { refEl.style.display = 'block'; refEl.textContent = 'سورة البقرة - آية 186'; }
            });
    }

    function fetchPrayerTimes() {
        var btn = document.getElementById('refreshPrayerBtn');
        if (btn) btn.textContent = 'جاري التحديث...';

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(pos) {
                fetchPrayerByCoords(pos.coords.latitude, pos.coords.longitude);
            }, function() {
                // Default to Mecca if location denied
                fetchPrayerByCoords(21.4225, 39.8262);
            });
        } else {
            fetchPrayerByCoords(21.4225, 39.8262);
        }
    }

    function fetchPrayerByCoords(lat, lng) {
        userLat = lat; userLng = lng;
        try { localStorage.setItem('iq_coords', JSON.stringify({lat:lat,lng:lng})); } catch(e){}
        var today = new Date();
        var url = 'https://api.aladhan.com/v1/timings/' + Math.floor(today.getTime()/1000)
            + '?latitude=' + lat + '&longitude=' + lng + '&method=4';
        fetch(url).then(function(r) { return r.json(); }).then(function(d) {
            if (d.code === 200 && d.data && d.data.timings) {
                prayerTimesCache = d.data.timings;
                displayPrayerTimes(d.data.timings);
                updateLiveCountdown();
                updateFastingInfo();
                if (notifEnabled) startPrayerChecker();
                // Extract Hijri date from timings response
                if (d.data.date && d.data.date.hijri) {
                    var h = d.data.date.hijri;
                    var hijriEl = document.getElementById('hijriDate');
                    if (hijriEl) hijriEl.textContent = h.day + ' ' + h.month.ar + ' ' + h.year + ' هـ';
                    calculateEventCountdowns(parseInt(h.day), parseInt(h.month.number), parseInt(h.year));
                    // Store globally for Ramadan calendar
                    currentHijriDay = parseInt(h.day);
                    currentHijriMonth = parseInt(h.month.number);
                    currentHijriYear = parseInt(h.year);
                    // Auto-load Ramadan calendar
                    loadRamadanCalendar();
                }
                // Show location
                var locEl = document.getElementById('prayerLocation');
                if (locEl && d.data.meta && d.data.meta.timezone) {
                    locEl.textContent = d.data.meta.timezone;
                }
                // Save for offline
                try { localStorage.setItem('iq_prayer_times', JSON.stringify({t: Date.now(), data: d.data.timings, hijri: d.data.date ? d.data.date.hijri : null, lat:lat, lng:lng})); } catch(e){}
            }
        }).catch(function() {
            // Try offline cache
            try {
                var c = JSON.parse(localStorage.getItem('iq_prayer_times'));
                if (c && c.data) {
                    prayerTimesCache = c.data; displayPrayerTimes(c.data); updateLiveCountdown(); updateFastingInfo();
                    if (c.hijri) {
                        var hijriEl = document.getElementById('hijriDate');
                        if (hijriEl) hijriEl.textContent = c.hijri.day + ' ' + c.hijri.month.ar + ' ' + c.hijri.year + ' هـ';
                        calculateEventCountdowns(parseInt(c.hijri.day), parseInt(c.hijri.month.number), parseInt(c.hijri.year));
                        currentHijriDay = parseInt(c.hijri.day);
                        currentHijriMonth = parseInt(c.hijri.month.number);
                        currentHijriYear = parseInt(c.hijri.year);
                        loadRamadanCalendar();
                    }
                }
            } catch(e){}
        }).finally(function() {
            var btn = document.getElementById('refreshPrayerBtn');
            if (btn) btn.textContent = 'تحديث المواقيت';
        });
    }

    function displayPrayerTimes(t) {
        var map = {Fajr:'Fajr',Sunrise:'Sunrise',Dhuhr:'Dhuhr',Asr:'Asr',Maghrib:'Maghrib',Isha:'Isha'};
        var names = {Fajr:'الفجر',Sunrise:'الشروق',Dhuhr:'الظهر',Asr:'العصر',Maghrib:'المغرب',Isha:'العشاء'};
        var prefixes = ['home', 'tools'];
        var now = new Date();
        var nowMin = now.getHours() * 60 + now.getMinutes();
        var nextPrayer = null;

        Object.keys(map).forEach(function(key) {
            var time = t[key];
            prefixes.forEach(function(p) {
                var el = document.getElementById(p + key);
                if (el) el.textContent = time;
            });
            // Find next prayer
            if (time && !nextPrayer) {
                var parts = time.split(':');
                var pMin = parseInt(parts[0]) * 60 + parseInt(parts[1]);
                if (pMin > nowMin) nextPrayer = key;
            }
        });

        // Highlight next prayer
        if (nextPrayer) {
            prefixes.forEach(function(p) {
                var grid = document.getElementById(p + 'PrayerGrid');
                if (grid) {
                    grid.querySelectorAll('.prayer-card').forEach(function(c) { c.classList.remove('next'); });
                    var el = document.getElementById(p + nextPrayer);
                    if (el) el.closest('.prayer-card').classList.add('next');
                }
            });
        }
    }

    // ═══════════════════════════════════════
    // Event Countdowns (Ramadan, Eid al-Fitr, Eid al-Adha)
    // ═══════════════════════════════════════
    function calculateEventCountdowns(hDay, hMonth, hYear) {
        // Hijri months: 1=Muharram...9=Ramadan,10=Shawwal,12=DhulHijjah
        // Target events with their Hijri month and day
        var events = [
            { id: 'ramadan', month: 9, day: 1, name: 'رمضان' },
            { id: 'fitr', month: 10, day: 1, name: 'عيد الفطر' },
            { id: 'adha', month: 12, day: 10, name: 'عيد الأضحى' }
        ];
        var hijriMonthNames = ['','محرم','صفر','ربيع الأول','ربيع الثاني','جمادى الأولى','جمادى الآخرة','رجب','شعبان','رمضان','شوال','ذو القعدة','ذو الحجة'];
        // Approximate days in Hijri months (alternating 30/29)
        var mDays = [0,30,29,30,29,30,29,30,29,30,29,30,29];

        events.forEach(function(ev) {
            var targetMonth = ev.month, targetDay = ev.day;
            var targetYear = hYear;
            // If event already passed this Hijri year, target next year
            if (hMonth > targetMonth || (hMonth === targetMonth && hDay > targetDay)) {
                targetYear = hYear + 1;
            }
            // Calculate approximate days remaining
            var daysLeft = 0;
            if (hMonth === targetMonth && targetYear === hYear) {
                daysLeft = targetDay - hDay;
            } else {
                // Days left in current month
                daysLeft = mDays[hMonth] - hDay;
                // Full months in between
                var m = hMonth + 1;
                var y = hYear;
                while (!(m === targetMonth && y === targetYear)) {
                    if (m > 12) { m = 1; y++; }
                    if (m === targetMonth && y === targetYear) break;
                    daysLeft += mDays[m] || 30;
                    m++;
                }
                daysLeft += targetDay;
            }

            var daysEl = document.getElementById(ev.id + 'Days');
            var labelEl = document.getElementById(ev.id + 'Label');
            var dateEl = document.getElementById(ev.id + 'Date');
            var cardEl = document.getElementById('event' + ev.id.charAt(0).toUpperCase() + ev.id.slice(1));

            if (daysEl) {
                if (daysLeft === 0) {
                    daysEl.textContent = 'اليوم!';
                    labelEl.textContent = 'كل عام وأنتم بخير';
                    if (cardEl) cardEl.classList.add('active-event');
                } else if (hMonth === 9 && ev.id === 'ramadan') {
                    // We're IN Ramadan
                    daysEl.textContent = hDay;
                    labelEl.textContent = 'رمضان الآن - اليوم ' + hDay;
                    if (cardEl) cardEl.classList.add('active-event');
                } else {
                    daysEl.textContent = toArabicNum(daysLeft);
                    labelEl.textContent = daysLeft === 1 ? 'يوم واحد متبقي' : 'يوم متبقي';
                }
            }
            if (dateEl) dateEl.textContent = targetDay + ' ' + hijriMonthNames[targetMonth] + ' ' + targetYear + ' هـ';
        });
    }

    // ═══════════════════════════════════════
    // Live Prayer Countdown & Fasting Info
    // ═══════════════════════════════════════
    var liveCountdownInterval = null;
    var prayerOrder = ['Fajr','Sunrise','Dhuhr','Asr','Maghrib','Isha'];
    var prayerNames = {Fajr:'الفجر',Sunrise:'الشروق',Dhuhr:'الظهر',Asr:'العصر',Maghrib:'المغرب',Isha:'العشاء'};

    function startLiveCountdown() {
        if (liveCountdownInterval) clearInterval(liveCountdownInterval);
        liveCountdownInterval = setInterval(updateLiveCountdown, 1000);
        updateLiveCountdown();
    }

    function timeToMinutes(timeStr) {
        if (!timeStr) return -1;
        var parts = timeStr.split(':');
        return parseInt(parts[0]) * 60 + parseInt(parts[1]);
    }

    function formatCountdown(diffMs) {
        if (diffMs < 0) return '--:--:--';
        var totalSec = Math.floor(diffMs / 1000);
        var h = Math.floor(totalSec / 3600);
        var m = Math.floor((totalSec % 3600) / 60);
        var s = totalSec % 60;
        return (h < 10 ? '0' : '') + h + ':' + (m < 10 ? '0' : '') + m + ':' + (s < 10 ? '0' : '') + s;
    }

    function formatHoursMin(minutes) {
        if (minutes < 0) return '--';
        var h = Math.floor(minutes / 60);
        var m = minutes % 60;
        return h + 'h ' + m + 'm';
    }

    function updateLiveCountdown() {
        if (!prayerTimesCache) return;
        var now = new Date();
        var nowMs = now.getTime();
        var todayBase = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();

        var nextPrayer = null, nextPrayerMs = null;
        for (var i = 0; i < prayerOrder.length; i++) {
            var key = prayerOrder[i];
            var tStr = prayerTimesCache[key];
            if (!tStr) continue;
            var pMs = todayBase + timeToMinutes(tStr) * 60000;
            if (pMs > nowMs) {
                nextPrayer = key;
                nextPrayerMs = pMs;
                break;
            }
        }

        var nameEl = document.getElementById('nextPrayerName');
        var timerEl = document.getElementById('nextPrayerTimer');

        if (nextPrayer && nextPrayerMs) {
            if (nameEl) nameEl.textContent = prayerNames[nextPrayer] + ' - ' + prayerTimesCache[nextPrayer];
            if (timerEl) timerEl.textContent = formatCountdown(nextPrayerMs - nowMs);
        } else {
            // All prayers passed today, next is Fajr tomorrow
            if (nameEl) nameEl.textContent = 'الفجر غداً - ' + (prayerTimesCache.Fajr || '--:--');
            if (prayerTimesCache.Fajr) {
                var tomorrowFajr = todayBase + 86400000 + timeToMinutes(prayerTimesCache.Fajr) * 60000;
                if (timerEl) timerEl.textContent = formatCountdown(tomorrowFajr - nowMs);
            }
        }
    }

    function updateFastingInfo() {
        if (!prayerTimesCache) return;
        var now = new Date();
        var nowMs = now.getTime();
        var nowMin = now.getHours() * 60 + now.getMinutes();
        var todayBase = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();

        var fajrMin = timeToMinutes(prayerTimesCache.Fajr);
        var maghribMin = timeToMinutes(prayerTimesCache.Maghrib);

        // Fasting duration (Fajr to Maghrib)
        var durationEl = document.getElementById('fastingDuration');
        if (durationEl && fajrMin >= 0 && maghribMin >= 0) {
            durationEl.textContent = formatHoursMin(maghribMin - fajrMin);
        }

        // Labels and context
        var maghribLabelEl = document.querySelector('#fastingInfo .fasting-item:nth-child(2) .fasting-label');
        var fajrLabelEl = document.querySelector('#fastingInfo .fasting-item:nth-child(3) .fasting-label');
        var maghribEl = document.getElementById('maghribRemaining');
        var fajrEl = document.getElementById('fajrRemaining');

        // Time remaining till Maghrib
        if (maghribEl && maghribMin >= 0) {
            var maghribMs = todayBase + maghribMin * 60000;
            var diffMs = maghribMs - nowMs;
            if (diffMs > 0) {
                // Before Maghrib - show countdown
                if (maghribLabelEl) maghribLabelEl.textContent = 'باقي للمغرب';
                maghribEl.textContent = formatHoursMin(Math.ceil(diffMs / 60000));
            } else {
                // After Maghrib - show tomorrow's Maghrib countdown
                if (maghribLabelEl) maghribLabelEl.textContent = 'المغرب غداً بعد';
                var tomorrowMaghrib = maghribMs + 86400000;
                maghribEl.textContent = formatHoursMin(Math.ceil((tomorrowMaghrib - nowMs) / 60000));
            }
        }

        // Time remaining till Fajr
        if (fajrEl && fajrMin >= 0) {
            var fajrMs = todayBase + fajrMin * 60000;
            var fDiff = fajrMs - nowMs;
            if (fDiff > 0) {
                // Before Fajr - show countdown
                if (fajrLabelEl) fajrLabelEl.textContent = 'باقي للفجر';
                fajrEl.textContent = formatHoursMin(Math.ceil(fDiff / 60000));
            } else {
                // After Fajr - show tomorrow's Fajr countdown
                if (fajrLabelEl) fajrLabelEl.textContent = 'الفجر غداً بعد';
                var tomorrowFajr = fajrMs + 86400000;
                fajrEl.textContent = formatHoursMin(Math.ceil((tomorrowFajr - nowMs) / 60000));
            }
        }
    }

    // Update fasting info every minute
    setInterval(updateFastingInfo, 60000);

    // ═══════════════════════════════════════
    // Ramadan Calendar
    // ═══════════════════════════════════════
    function loadRamadanCalendar() {
        var container = document.getElementById('ramadanCalContainer');

        // Need Hijri date from prayer times
        if (!currentHijriYear) return;

        // Get user coordinates
        var lat = userLat, lng = userLng;
        if (!lat || !lng) {
            try {
                var c = JSON.parse(localStorage.getItem('iq_coords'));
                if (c) { lat = c.lat; lng = c.lng; }
            } catch(e) {}
        }
        if (!lat) { lat = 21.4225; lng = 39.8262; }

        // Use stored Hijri date from prayer times API
        var ramYear = (currentHijriMonth > 9) ? currentHijriYear + 1 : currentHijriYear;
        var currentRamDay = (currentHijriMonth === 9) ? currentHijriDay : -1;

        fetchRamadanMonth(ramYear, lat, lng, currentRamDay)
            .catch(function() {
                if (container) container.innerHTML = '<div style="text-align:center;padding:30px;color:var(--text-muted)">تعذر تحميل التقويم. تأكد من الاتصال بالإنترنت.</div>';
            });
    }

    function fetchRamadanMonth(hijriYear, lat, lng, currentRamDay) {
        var container = document.getElementById('ramadanCalContainer');
        var infoEl = document.getElementById('ramadanCalInfo');
        var ramCacheKey = 'iq_ramadan_' + hijriYear;

        // Try localStorage cache first
        try {
            var cached = JSON.parse(localStorage.getItem(ramCacheKey));
            if (cached && cached.data && cached.data.length) {
                renderRamadanCal(cached.data, hijriYear, currentRamDay, container, infoEl);
                return Promise.resolve();
            }
        } catch(e) {}

        return fetch('https://api.aladhan.com/v1/hijriCalendar?month=9&year=' + hijriYear + '&latitude=' + lat + '&longitude=' + lng + '&method=4')
            .then(function(r) { return r.json(); })
            .then(function(d) {
                if (d.code !== 200 || !d.data || !d.data.length) throw new Error('No data');
                try { localStorage.setItem(ramCacheKey, JSON.stringify({data: d.data})); } catch(e) {}
                renderRamadanCal(d.data, hijriYear, currentRamDay, container, infoEl);
            });
    }

    function renderRamadanCal(days, hijriYear, currentRamDay, container, infoEl) {
        if (infoEl) infoEl.textContent = 'رمضان ' + hijriYear + ' هـ | الحسابات بناءً على موقعك';
        var html = '<div class="ramadan-cal-scroll"><table class="ramadan-cal-table">';
        html += '<thead><tr><th>اليوم</th><th>التاريخ</th><th>الإمساك</th><th>الفجر</th><th>الشروق</th><th>الظهر</th><th>العصر</th><th>المغرب</th><th>العشاء</th><th>مدة الصيام</th></tr></thead><tbody>';
        var dayNames = ['الأحد','الإثنين','الثلاثاء','الأربعاء','الخميس','الجمعة','السبت'];
        function cleanTime(s) { return s ? s.replace(/\s*\(.*\)/, '') : '--:--'; }

        days.forEach(function(day) {
            var t = day.timings;
            var hd = day.date.hijri;
            var gd = day.date.gregorian;
            var dayNum = parseInt(hd.day);
            var gregDate = gd.day + '/' + gd.month.number;
            var jsDate = new Date(gd.year + '-' + gd.month.number.toString().padStart(2,'0') + '-' + gd.day.padStart(2,'0'));
            var dayName = dayNames[jsDate.getDay()] || '';
            var fajrT = cleanTime(t.Fajr);
            var maghribT = cleanTime(t.Maghrib);
            var imsak = cleanTime(t.Imsak);
            var fMin = timeToMinutes(fajrT);
            var mMin = timeToMinutes(maghribT);
            var duration = (fMin >= 0 && mMin >= 0) ? formatHoursMin(mMin - fMin) : '--';
            var isToday = (dayNum === currentRamDay) ? ' class="today-row"' : '';
            html += '<tr' + isToday + '>'
                + '<td>' + toArabicNum(dayNum) + '</td>'
                + '<td>' + dayName + ' ' + gregDate + '</td>'
                + '<td>' + imsak + '</td>'
                + '<td>' + fajrT + '</td>'
                + '<td>' + cleanTime(t.Sunrise) + '</td>'
                + '<td>' + cleanTime(t.Dhuhr) + '</td>'
                + '<td>' + cleanTime(t.Asr) + '</td>'
                + '<td>' + maghribT + '</td>'
                + '<td>' + cleanTime(t.Isha) + '</td>'
                + '<td>' + duration + '</td>'
                + '</tr>';
        });
        html += '</tbody></table></div>';
        if (container) container.innerHTML = html;
        setTimeout(function() {
            var todayRow = container.querySelector('.today-row');
            if (todayRow) todayRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 200);
    }

    // ═══════════════════════════════════════
    // Tasbeeh Counter
    // ═══════════════════════════════════════
    var tasbeehCount = 0, tasbeehTarget = 33, tasbeehTotal = 0, tasbeehText = 'سبحان الله';

    function initTasbeeh() {
        try {
            var saved = JSON.parse(localStorage.getItem('iq_tasbeeh'));
            if (saved) { tasbeehTotal = saved.total || 0; }
        } catch(e){}
        updateTasbeehDisplay();
    }

    function setTasbeehPreset(text, target, btn) {
        tasbeehText = text;
        tasbeehTarget = target;
        tasbeehCount = 0;
        document.querySelectorAll('.tasbeeh-preset').forEach(function(b) { b.classList.remove('active'); });
        if (btn) btn.classList.add('active');
        updateTasbeehDisplay();
    }

    function incrementTasbeeh() {
        tasbeehCount++;
        tasbeehTotal++;
        if (tasbeehTarget > 0 && tasbeehCount >= tasbeehTarget) {
            // Completed - flash effect
            var btn = document.getElementById('tasbeehBtn');
            if (btn) { btn.style.borderColor = '#f1c40f'; setTimeout(function() { btn.style.borderColor = ''; }, 800); }
        }
        updateTasbeehDisplay();
        try { localStorage.setItem('iq_tasbeeh', JSON.stringify({total: tasbeehTotal})); } catch(e){}
    }

    function resetTasbeeh() {
        tasbeehCount = 0;
        updateTasbeehDisplay();
    }

    function updateTasbeehDisplay() {
        var countEl = document.getElementById('tasbeehCount');
        var targetEl = document.getElementById('tasbeehTarget');
        var labelEl = document.getElementById('tasbeehLabel');
        var totalEl = document.getElementById('tasbeehTotalBtn');
        if (countEl) countEl.textContent = toArabicNum(tasbeehCount);
        if (targetEl) targetEl.textContent = tasbeehTarget > 0 ? 'الهدف: ' + toArabicNum(tasbeehTarget) : 'بدون حد';
        if (labelEl) labelEl.textContent = tasbeehText;
        if (totalEl) totalEl.textContent = 'المجموع: ' + toArabicNum(tasbeehTotal);
    }

    // ═══════════════════════════════════════
    // 99 Names of Allah
    // ═══════════════════════════════════════
    var NAMES_99 = [
        ['الله','Allah'],['الرَّحْمَنُ','الرحمن'],['الرَّحِيمُ','الرحيم'],['المَلِكُ','الملك'],['القُدُّوسُ','القدوس'],
        ['السَّلَامُ','السلام'],['المُؤْمِنُ','المؤمن'],['المُهَيْمِنُ','المهيمن'],['العَزِيزُ','العزيز'],['الجَبَّارُ','الجبار'],
        ['المُتَكَبِّرُ','المتكبر'],['الخَالِقُ','الخالق'],['البَارِئُ','البارئ'],['المُصَوِّرُ','المصور'],['الغَفَّارُ','الغفار'],
        ['القَهَّارُ','القهار'],['الوَهَّابُ','الوهاب'],['الرَّزَّاقُ','الرزاق'],['الفَتَّاحُ','الفتاح'],['العَلِيمُ','العليم'],
        ['القَابِضُ','القابض'],['البَاسِطُ','الباسط'],['الخَافِضُ','الخافض'],['الرَّافِعُ','الرافع'],['المُعِزُّ','المعز'],
        ['المُذِلُّ','المذل'],['السَّمِيعُ','السميع'],['البَصِيرُ','البصير'],['الحَكَمُ','الحكم'],['العَدْلُ','العدل'],
        ['اللَّطِيفُ','اللطيف'],['الخَبِيرُ','الخبير'],['الحَلِيمُ','الحليم'],['العَظِيمُ','العظيم'],['الغَفُورُ','الغفور'],
        ['الشَّكُورُ','الشكور'],['العَلِيُّ','العلي'],['الكَبِيرُ','الكبير'],['الحَفِيظُ','الحفيظ'],['المُقِيتُ','المقيت'],
        ['الحَسِيبُ','الحسيب'],['الجَلِيلُ','الجليل'],['الكَرِيمُ','الكريم'],['الرَّقِيبُ','الرقيب'],['المُجِيبُ','المجيب'],
        ['الوَاسِعُ','الواسع'],['الحَكِيمُ','الحكيم'],['الوَدُودُ','الودود'],['المَجِيدُ','المجيد'],['البَاعِثُ','الباعث'],
        ['الشَّهِيدُ','الشهيد'],['الحَقُّ','الحق'],['الوَكِيلُ','الوكيل'],['القَوِيُّ','القوي'],['المَتِينُ','المتين'],
        ['الوَلِيُّ','الولي'],['الحَمِيدُ','الحميد'],['المُحْصِي','المحصي'],['المُبْدِئُ','المبدئ'],['المُعِيدُ','المعيد'],
        ['المُحْيِي','المحيي'],['المُمِيتُ','المميت'],['الحَيُّ','الحي'],['القَيُّومُ','القيوم'],['الوَاجِدُ','الواجد'],
        ['المَاجِدُ','الماجد'],['الوَاحِدُ','الواحد'],['الصَّمَدُ','الصمد'],['القَادِرُ','القادر'],['المُقْتَدِرُ','المقتدر'],
        ['المُقَدِّمُ','المقدم'],['المُؤَخِّرُ','المؤخر'],['الأَوَّلُ','الأول'],['الآخِرُ','الآخر'],['الظَّاهِرُ','الظاهر'],
        ['البَاطِنُ','الباطن'],['الوَالِي','الوالي'],['المُتَعَالِي','المتعالي'],['البَرُّ','البر'],['التَّوَّابُ','التواب'],
        ['المُنْتَقِمُ','المنتقم'],['العَفُوُّ','العفو'],['الرَّؤُوفُ','الرؤوف'],['مَالِكُ المُلْكِ','مالك الملك'],
        ['ذُو الجَلَالِ وَالإِكْرَامِ','ذو الجلال والإكرام'],['المُقْسِطُ','المقسط'],['الجَامِعُ','الجامع'],
        ['الغَنِيُّ','الغني'],['المُغْنِي','المغني'],['المَانِعُ','المانع'],['الضَّارُّ','الضار'],['النَّافِعُ','النافع'],
        ['النُّورُ','النور'],['الهَادِي','الهادي'],['البَدِيعُ','البديع'],['البَاقِي','الباقي'],['الوَارِثُ','الوارث'],
        ['الرَّشِيدُ','الرشيد'],['الصَّبُورُ','الصبور']
    ];

    function renderNames() {
        var grid = document.getElementById('namesGrid');
        if (!grid) return;
        grid.innerHTML = NAMES_99.map(function(n, i) {
            return '<div class="name-card"><div class="name-card-ar">' + n[0] + '</div><div class="name-card-meaning">' + toArabicNum(i+1) + '</div></div>';
        }).join('');
    }

    // ═══════════════════════════════════════
    // Tools Tab Init
    // ═══════════════════════════════════════
    var toolsInited = false;
    function initTools() {
        if (toolsInited) return;
        toolsInited = true;
        initTasbeeh();
        renderNames();
        renderHifz();
        renderReadingHistory();
        if (!prayerTimesCache) fetchPrayerTimes();
    }

    // ═══════════════════════════════════════
    // Night Mode & Reading Controls
    // ═══════════════════════════════════════
    var nightMode = localStorage.getItem('iq_night') === '1';
    var fontSize = parseInt(localStorage.getItem('iq_fontsize')) || 0;
    if (nightMode) document.body.classList.add('night-mode');
    if (fontSize) document.documentElement.style.fontSize = (100 + fontSize * 5) + '%';

    function toggleNightMode() {
        nightMode = !nightMode;
        document.body.classList.toggle('night-mode', nightMode);
        localStorage.setItem('iq_night', nightMode ? '1' : '0');
        var btn = document.getElementById('nightModeBtn');
        if (btn) btn.classList.toggle('on', nightMode);
    }
    function changeFontSize(dir) {
        fontSize = Math.max(-4, Math.min(6, fontSize + dir));
        document.documentElement.style.fontSize = (100 + fontSize * 5) + '%';
        localStorage.setItem('iq_fontsize', fontSize);
    }

    // ═══════════════════════════════════════
    // Prayer Notifications (iOS-compatible)
    // ═══════════════════════════════════════
    var PRAYER_KEYS = ['Fajr','Dhuhr','Asr','Maghrib','Isha'];
    var PRAYER_NAMES_AR = {Fajr:'الفجر',Dhuhr:'الظهر',Asr:'العصر',Maghrib:'المغرب',Isha:'العشاء'};

    // Load per-prayer toggle states (default all on if notif enabled)
    function getNotifPrefs() {
        try { return JSON.parse(localStorage.getItem('iq_notif_prefs')) || {}; } catch(e) { return {}; }
    }
    function saveNotifPrefs(p) { localStorage.setItem('iq_notif_prefs', JSON.stringify(p)); }

    var notifEnabled = localStorage.getItem('iq_notif') === '1';
    var notifVolume = parseInt(localStorage.getItem('iq_notif_vol') || '70') / 100;
    var notifPrefs = getNotifPrefs();
    var notifShownToday = {}; // track which prayers already notified today
    var prayerCheckInterval = null;
    var athanAudioCtx = null;

    if (notifEnabled) { var nb = document.getElementById('notifBtn'); if (nb) nb.classList.add('on'); }

    // Initialize Web Audio on first user interaction (iOS requirement)
    function initAudioContext() {
        if (athanAudioCtx) return;
        try {
            athanAudioCtx = new (window.AudioContext || window.webkitAudioContext)();
            // iOS requires resume after creation in user gesture
            if (athanAudioCtx.state === 'suspended') athanAudioCtx.resume();
        } catch(e) { /* no audio support */ }
    }
    document.addEventListener('touchstart', initAudioContext, { once: true });
    document.addEventListener('click', initAudioContext, { once: true });

    // Play athan-like tone sequence
    function playAthanTone() {
        if (!athanAudioCtx || notifVolume === 0) return;
        try {
            if (athanAudioCtx.state === 'suspended') athanAudioCtx.resume();
            var now = athanAudioCtx.currentTime;
            var vol = notifVolume * 0.4;
            // Melodic athan-inspired notes (D4, F4, G4, A4, Bb4 - Hijaz-like scale)
            var notes = [293.66, 349.23, 392.00, 440.00, 466.16, 440.00, 392.00, 349.23];
            var durations = [0.5, 0.4, 0.5, 0.6, 0.5, 0.4, 0.5, 0.8];
            var t = now + 0.05;
            notes.forEach(function(freq, i) {
                var osc = athanAudioCtx.createOscillator();
                var gain = athanAudioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.value = freq;
                gain.gain.setValueAtTime(0, t);
                gain.gain.linearRampToValueAtTime(vol, t + 0.06);
                gain.gain.setValueAtTime(vol, t + durations[i] - 0.1);
                gain.gain.linearRampToValueAtTime(0, t + durations[i]);
                osc.connect(gain);
                gain.connect(athanAudioCtx.destination);
                osc.start(t);
                osc.stop(t + durations[i]);
                t += durations[i] + 0.05;
            });
        } catch(e) { /* audio error, silently ignore */ }
    }

    // Show in-app notification banner
    function showPrayerNotifBanner(prayerKey) {
        var el = document.getElementById('prayerNotif');
        var titleEl = document.getElementById('prayerNotifTitle');
        var textEl = document.getElementById('prayerNotifText');
        if (!el) return;
        titleEl.textContent = '🕌 حان وقت صلاة ' + PRAYER_NAMES_AR[prayerKey];
        textEl.textContent = 'الوقت: ' + (prayerTimesCache ? prayerTimesCache[prayerKey] : '');
        el.classList.add('show');
        playAthanTone();
        // Also try native notification if permission granted (for background on Android/desktop)
        if ('Notification' in window && Notification.permission === 'granted') {
            try {
                new Notification('حان وقت صلاة ' + PRAYER_NAMES_AR[prayerKey], {
                    body: 'الوقت: ' + (prayerTimesCache ? prayerTimesCache[prayerKey] : ''),
                    icon: '🕌', tag: 'prayer-' + prayerKey
                });
            } catch(e) {}
        }
        // Auto-dismiss after 15 seconds
        setTimeout(function() { dismissPrayerNotif(); }, 15000);
    }

    function dismissPrayerNotif() {
        var el = document.getElementById('prayerNotif');
        if (el) el.classList.remove('show');
    }

    // Periodic prayer time checker (runs every 30 seconds)
    function checkPrayerTimes() {
        if (!prayerTimesCache || !notifEnabled) return;
        var now = new Date();
        var todayKey = now.getFullYear() + '-' + now.getMonth() + '-' + now.getDate();
        // Reset shown tracker on new day
        if (notifShownToday._day !== todayKey) {
            notifShownToday = { _day: todayKey };
        }
        var todayBase = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
        var prefs = getNotifPrefs();
        PRAYER_KEYS.forEach(function(key) {
            // Skip if this prayer is toggled off
            if (prefs[key] === false) return;
            // Skip if already shown today
            if (notifShownToday[key]) return;
            var tStr = prayerTimesCache[key];
            if (!tStr) return;
            var pMs = todayBase + timeToMinutes(tStr) * 60000;
            var diff = now.getTime() - pMs;
            // Trigger if we're within 0-90 seconds after prayer time
            if (diff >= 0 && diff < 90000) {
                notifShownToday[key] = true;
                showPrayerNotifBanner(key);
            }
        });
    }

    function startPrayerChecker() {
        if (prayerCheckInterval) clearInterval(prayerCheckInterval);
        prayerCheckInterval = setInterval(checkPrayerTimes, 30000);
        checkPrayerTimes(); // check immediately
    }

    function stopPrayerChecker() {
        if (prayerCheckInterval) { clearInterval(prayerCheckInterval); prayerCheckInterval = null; }
    }

    // Settings panel
    function openNotifSettings() {
        initAudioContext();
        var overlay = document.getElementById('notifOverlay');
        var panel = document.getElementById('notifSettings');
        if (overlay) overlay.classList.add('show');
        if (panel) panel.classList.add('show');
        // Sync toggles with saved prefs
        var prefs = getNotifPrefs();
        PRAYER_KEYS.forEach(function(key) {
            var btn = document.getElementById('notif' + key);
            if (!btn) return;
            var isOn = notifEnabled && prefs[key] !== false;
            btn.classList.toggle('on', isOn);
        });
        var volSlider = document.getElementById('notifVolume');
        if (volSlider) volSlider.value = Math.round(notifVolume * 100);
    }

    function closeNotifSettings() {
        var overlay = document.getElementById('notifOverlay');
        var panel = document.getElementById('notifSettings');
        if (overlay) overlay.classList.remove('show');
        if (panel) panel.classList.remove('show');
    }

    function togglePrayerNotif(key) {
        initAudioContext();
        var prefs = getNotifPrefs();
        var btn = document.getElementById('notif' + key);
        var wasOn = prefs[key] !== false;
        prefs[key] = !wasOn;
        if (btn) btn.classList.toggle('on', !wasOn);
        saveNotifPrefs(prefs);
        // Enable master notification if any prayer is toggled on
        var anyOn = PRAYER_KEYS.some(function(k) { return prefs[k] !== false; });
        if (anyOn && !notifEnabled) {
            notifEnabled = true;
            localStorage.setItem('iq_notif', '1');
            var nb = document.getElementById('notifBtn'); if (nb) nb.classList.add('on');
            startPrayerChecker();
            // Try requesting native notification permission (for Android/desktop)
            if ('Notification' in window && Notification.permission === 'default') {
                try { Notification.requestPermission(); } catch(e) {}
            }
        }
        if (!anyOn) {
            notifEnabled = false;
            localStorage.setItem('iq_notif', '0');
            var nb2 = document.getElementById('notifBtn'); if (nb2) nb2.classList.remove('on');
            stopPrayerChecker();
        }
    }

    function setNotifVolume(val) {
        notifVolume = parseInt(val) / 100;
        localStorage.setItem('iq_notif_vol', val);
    }

    function testPrayerNotif() {
        initAudioContext();
        showPrayerNotifBanner('Fajr');
    }

    // iOS detection & install prompt
    function checkIosInstallPrompt() {
        var isIos = /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        var isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
        var dismissed = localStorage.getItem('iq_ios_prompt_dismissed');
        if (isIos && !isStandalone && !dismissed) {
            setTimeout(function() {
                var prompt = document.getElementById('iosInstallPrompt');
                if (prompt) prompt.classList.add('show');
            }, 3000);
        }
    }

    function dismissIosPrompt() {
        var prompt = document.getElementById('iosInstallPrompt');
        if (prompt) prompt.classList.remove('show');
        localStorage.setItem('iq_ios_prompt_dismissed', '1');
    }

    // Legacy compatibility - keep old function name working
    function toggleNotifications() { openNotifSettings(); }

    // Start checker if notifications were previously enabled
    if (notifEnabled) startPrayerChecker();
    checkIosInstallPrompt();

    // ═══════════════════════════════════════
    // Qibla Compass
    // ═══════════════════════════════════════
    function calculateQibla() {
        var label = document.getElementById('qiblaLabel');
        if (label) label.textContent = 'جاري تحديد الموقع...';
        var lat = userLat, lng = userLng;
        if (lat && lng) { showQibla(lat, lng); return; }
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(pos) {
                showQibla(pos.coords.latitude, pos.coords.longitude);
            }, function() {
                if (label) label.textContent = 'تعذر تحديد الموقع. فعّل خدمة الموقع.';
            });
        } else {
            if (label) label.textContent = 'المتصفح لا يدعم تحديد الموقع';
        }
    }
    function showQibla(lat, lng) {
        // Kaaba: 21.4225°N, 39.8262°E
        var kLat = 21.4225 * Math.PI / 180;
        var kLng = 39.8262 * Math.PI / 180;
        var uLat = lat * Math.PI / 180;
        var uLng = lng * Math.PI / 180;
        var dLng = kLng - uLng;
        var x = Math.sin(dLng) * Math.cos(kLat);
        var y = Math.cos(uLat) * Math.sin(kLat) - Math.sin(uLat) * Math.cos(kLat) * Math.cos(dLng);
        var bearing = Math.atan2(x, y) * 180 / Math.PI;
        bearing = (bearing + 360) % 360;
        var arrow = document.getElementById('qiblaArrow');
        var degEl = document.getElementById('qiblaDegree');
        var label = document.getElementById('qiblaLabel');
        if (arrow) arrow.style.transform = 'translateX(-50%) rotate(' + bearing + 'deg)';
        if (degEl) degEl.textContent = Math.round(bearing) + '°';
        if (label) label.textContent = 'اتجاه القبلة من موقعك';
    }

    // ═══════════════════════════════════════
    // Khatm (Quran Completion) Tracker
    // ═══════════════════════════════════════
    function getKhatm() {
        try { return JSON.parse(localStorage.getItem('iq_khatm')) || {juz:[], count:0}; } catch(e) { return {juz:[], count:0}; }
    }
    function saveKhatm(k) { try { localStorage.setItem('iq_khatm', JSON.stringify(k)); } catch(e) {} }

    function renderKhatm() {
        var k = getKhatm();
        var done = k.juz.length;
        var pct = Math.round((done / 30) * 100);
        var el = document.getElementById('khatmPct'); if (el) el.textContent = pct + '%';
        var ring = document.getElementById('khatmRing');
        if (ring) ring.setAttribute('stroke-dashoffset', 553 - (553 * pct / 100));
        var dj = document.getElementById('khatmDoneJuz'); if (dj) dj.textContent = done;
        var rm = document.getElementById('khatmRemain'); if (rm) rm.textContent = 30 - done;
        var ct = document.getElementById('khatmCount'); if (ct) ct.textContent = k.count;
        var grid = document.getElementById('khatmGrid');
        if (grid) {
            var html = '';
            for (var i = 1; i <= 30; i++) {
                var isDone = k.juz.indexOf(i) >= 0;
                html += '<div class="khatm-juz' + (isDone ? ' done' : '') + '" onclick="toggleKhatmJuz(' + i + ')">'
                    + 'الجزء ' + i + (isDone ? ' ✓' : '') + '</div>';
            }
            grid.innerHTML = html;
        }
    }
    function toggleKhatmJuz(n) {
        var k = getKhatm();
        var idx = k.juz.indexOf(n);
        if (idx >= 0) k.juz.splice(idx, 1); else k.juz.push(n);
        // Check if all 30 done
        if (k.juz.length === 30) {
            k.count = (k.count || 0) + 1;
            k.juz = [];
            setTimeout(function() { alert('تبارك الله! أكملت ختمة كاملة! العدد: ' + k.count); }, 100);
        }
        saveKhatm(k);
        renderKhatm();
    }
    function resetKhatm() {
        var k = getKhatm();
        if (k.juz.length > 0 && !confirm('هل تريد بدء ختمة جديدة؟ سيتم تصفير التقدم الحالي.')) return;
        k.juz = [];
        saveKhatm(k);
        renderKhatm();
    }
    renderKhatm();

    // ═══════════════════════════════════════
    // Hifz (Memorization) Tracker
    // ═══════════════════════════════════════
    // States: 0=not started, 1=in progress, 2=memorized, 3=needs review
    var HIFZ_STATES = ['not-started', 'in-progress', 'memorized', 'review'];
    var HIFZ_LABELS = ['لم يبدأ', 'جاري الحفظ', 'محفوظ', 'مراجعة'];

    function getHifz() {
        try { return JSON.parse(localStorage.getItem('iq_hifz')) || {}; } catch(e) { return {}; }
    }
    function saveHifz(h) { try { localStorage.setItem('iq_hifz', JSON.stringify(h)); } catch(e) {} }

    function cycleHifzState(surahNum) {
        var h = getHifz();
        var curr = h[surahNum] || 0;
        h[surahNum] = (curr + 1) % 4;
        if (h[surahNum] === 0) delete h[surahNum]; // Clean up not-started entries
        saveHifz(h);
        renderHifz();
    }

    function renderHifz() {
        var h = getHifz();
        var counts = [0, 0, 0, 0]; // not started, in progress, memorized, review
        for (var i = 1; i <= 114; i++) {
            var state = h[i] || 0;
            counts[state]++;
        }

        // Stats
        var statsEl = document.getElementById('hifzStats');
        if (statsEl) {
            statsEl.innerHTML =
                '<div class="hifz-stat"><div class="hifz-stat-num memorized">' + counts[2] + '</div><div class="hifz-stat-label">محفوظ</div></div>'
                + '<div class="hifz-stat"><div class="hifz-stat-num in-progress">' + counts[1] + '</div><div class="hifz-stat-label">جاري الحفظ</div></div>'
                + '<div class="hifz-stat"><div class="hifz-stat-num review">' + counts[3] + '</div><div class="hifz-stat-label">مراجعة</div></div>'
                + '<div class="hifz-stat"><div class="hifz-stat-num not-started">' + counts[0] + '</div><div class="hifz-stat-label">لم يبدأ</div></div>';
        }

        // Progress bar
        var barEl = document.getElementById('hifzBar');
        if (barEl) {
            var total = 114;
            barEl.innerHTML =
                '<div class="hifz-bar-seg memorized" style="width:' + (counts[2] / total * 100) + '%"></div>'
                + '<div class="hifz-bar-seg in-progress" style="width:' + (counts[1] / total * 100) + '%"></div>'
                + '<div class="hifz-bar-seg review" style="width:' + (counts[3] / total * 100) + '%"></div>';
        }

        // Grid
        var grid = document.getElementById('hifzGrid');
        if (grid) {
            var html = '';
            for (var i = 1; i <= 114; i++) {
                var state = h[i] || 0;
                var surah = SURAH_DATA.find(function(s) { return s.n === i; });
                var name = surah ? surah.name : i;
                var cls = HIFZ_STATES[state];
                html += '<div class="hifz-cell ' + cls + '" onclick="cycleHifzState(' + i + ')" title="' + HIFZ_LABELS[state] + '">'
                    + '<span class="hifz-cell-num">' + i + '</span>'
                    + '<span class="hifz-cell-name">' + name + '</span>'
                    + '</div>';
            }
            grid.innerHTML = html;
        }
    }

    function resetHifz() {
        if (!confirm('هل تريد تصفير تقدم الحفظ بالكامل؟')) return;
        localStorage.removeItem('iq_hifz');
        renderHifz();
    }

    // ═══════════════════════════════════════
    // Reading History & Gamification
    // ═══════════════════════════════════════
    var readingStartTime = 0;
    var readingStartSurah = 0;

    function getReadingHistory() {
        try { return JSON.parse(localStorage.getItem('iq_reading_history')) || []; } catch(e) { return []; }
    }
    function saveReadingHistory(h) {
        // Keep max 200 entries
        if (h.length > 200) h = h.slice(-200);
        try { localStorage.setItem('iq_reading_history', JSON.stringify(h)); } catch(e) {}
    }

    function logReadingSession(surahNum, durationSec, lastAyah) {
        if (durationSec < 30) return; // Ignore very short visits
        var history = getReadingHistory();
        var surah = SURAH_DATA.find(function(s) { return s.n === surahNum; });
        history.push({
            s: surahNum,
            name: surah ? surah.name : 'سورة ' + surahNum,
            dur: Math.round(durationSec),
            ayah: lastAyah || 1,
            ts: Date.now()
        });
        saveReadingHistory(history);
        updateStreak();
    }

    function getStreak() {
        try { return JSON.parse(localStorage.getItem('iq_streak')) || { current: 0, best: 0, lastDay: '' }; } catch(e) { return { current: 0, best: 0, lastDay: '' }; }
    }
    function saveStreak(s) { try { localStorage.setItem('iq_streak', JSON.stringify(s)); } catch(e) {} }

    function updateStreak() {
        var streak = getStreak();
        var today = new Date().toISOString().slice(0, 10);
        if (streak.lastDay === today) return; // Already counted today

        var yesterday = new Date(Date.now() - 86400000).toISOString().slice(0, 10);
        if (streak.lastDay === yesterday) {
            streak.current++;
        } else if (streak.lastDay !== today) {
            streak.current = 1;
        }
        streak.lastDay = today;
        if (streak.current > streak.best) streak.best = streak.current;
        saveStreak(streak);
    }

    function checkStreakValidity() {
        var streak = getStreak();
        if (!streak.lastDay) return;
        var today = new Date().toISOString().slice(0, 10);
        var yesterday = new Date(Date.now() - 86400000).toISOString().slice(0, 10);
        if (streak.lastDay !== today && streak.lastDay !== yesterday) {
            streak.current = 0;
            saveStreak(streak);
        }
    }
    checkStreakValidity();

    function renderReadingHistory() {
        var streak = getStreak();
        var history = getReadingHistory();

        // Streak banner
        var streakNum = document.getElementById('streakNum');
        if (streakNum) streakNum.textContent = streak.current;
        var streakBest = document.getElementById('streakBest');
        if (streakBest && streak.best > 0) streakBest.textContent = 'أفضل سلسلة: ' + streak.best + ' يوم';

        // Stats
        var totalSessions = history.length;
        var totalTime = history.reduce(function(sum, h) { return sum + (h.dur || 0); }, 0);
        var uniqueSurahs = {};
        history.forEach(function(h) { uniqueSurahs[h.s] = true; });
        var statsEl = document.getElementById('readingStatsRow');
        if (statsEl) {
            var hrs = Math.floor(totalTime / 3600);
            var mins = Math.floor((totalTime % 3600) / 60);
            var timeStr = hrs > 0 ? hrs + 'س ' + mins + 'د' : mins + ' دقيقة';
            statsEl.innerHTML =
                '<div class="reading-stat-card"><div class="reading-stat-num">' + totalSessions + '</div><div class="reading-stat-label">جلسة قراءة</div></div>'
                + '<div class="reading-stat-card"><div class="reading-stat-num">' + timeStr + '</div><div class="reading-stat-label">وقت القراءة</div></div>'
                + '<div class="reading-stat-card"><div class="reading-stat-num">' + Object.keys(uniqueSurahs).length + '</div><div class="reading-stat-label">سور مختلفة</div></div>';
        }

        // Week heatmap
        var weekEl = document.getElementById('weekHeatmap');
        if (weekEl) {
            var dayNames = ['أحد','إثن','ثلا','أرب','خمي','جمع','سبت'];
            var today = new Date();
            var todayDay = today.getDay();
            var html = '';
            for (var d = 0; d < 7; d++) {
                var date = new Date(today);
                date.setDate(today.getDate() - todayDay + d);
                var dayStr = date.toISOString().slice(0, 10);
                var hasReading = history.some(function(h) {
                    return new Date(h.ts).toISOString().slice(0, 10) === dayStr;
                });
                var isToday = d === todayDay;
                html += '<div class="week-day-cell' + (hasReading ? ' active' : '') + (isToday ? ' today' : '') + '">'
                    + '<div class="week-day-name">' + dayNames[d] + '</div>'
                    + '<div class="week-day-dot"></div></div>';
            }
            weekEl.innerHTML = html;
        }

        // History feed
        var feedEl = document.getElementById('historyFeed');
        if (feedEl) {
            if (history.length === 0) {
                feedEl.innerHTML = '<div class="history-empty">لا توجد قراءات بعد. افتح أي سورة وابدأ القراءة!</div>';
            } else {
                var html = '';
                var recent = history.slice().reverse().slice(0, 30);
                recent.forEach(function(h) {
                    var date = new Date(h.ts);
                    var timeAgo = getTimeAgo(h.ts);
                    var mins = Math.floor(h.dur / 60);
                    var secs = h.dur % 60;
                    var durStr = mins > 0 ? mins + ' دقيقة' : secs + ' ثانية';
                    html += '<div class="history-item" onclick="openSurah(' + h.s + ',' + h.ayah + ')">'
                        + '<div class="history-icon">📖</div>'
                        + '<div class="history-info">'
                        + '<div class="history-title">سورة ' + h.name + '</div>'
                        + '<div class="history-meta">آية ' + h.ayah + ' | ' + durStr + '</div>'
                        + '</div>'
                        + '<div class="history-time">' + timeAgo + '</div></div>';
                });
                feedEl.innerHTML = html;
            }
        }
    }

    function getTimeAgo(ts) {
        var diff = Date.now() - ts;
        var mins = Math.floor(diff / 60000);
        if (mins < 1) return 'الآن';
        if (mins < 60) return mins + ' د';
        var hrs = Math.floor(mins / 60);
        if (hrs < 24) return hrs + ' س';
        var days = Math.floor(hrs / 24);
        if (days < 7) return days + ' يوم';
        return Math.floor(days / 7) + ' أسبوع';
    }

    // Hook into surah opening/closing to auto-track reading
    var _origOpenSurah = openSurah;
    openSurah = async function(num, scrollToAyah) {
        // Log previous reading session if any
        if (readingStartSurah && readingStartTime) {
            var elapsed = (Date.now() - readingStartTime) / 1000;
            var lastAyah = 1;
            try {
                var spans = document.querySelectorAll('.ayah-span');
                for (var i = 0; i < spans.length; i++) {
                    var r = spans[i].getBoundingClientRect();
                    if (r.top >= -100 && r.top <= window.innerHeight) {
                        lastAyah = parseInt(spans[i].dataset.ayah) || 1;
                        break;
                    }
                }
            } catch(e) {}
            logReadingSession(readingStartSurah, elapsed, lastAyah);
        }
        readingStartSurah = num;
        readingStartTime = Date.now();
        return _origOpenSurah(num, scrollToAyah);
    };

    var _origBackToSurahList = backToSurahList;
    backToSurahList = function() {
        // Log reading session when leaving reader
        if (readingStartSurah && readingStartTime) {
            var elapsed = (Date.now() - readingStartTime) / 1000;
            var lastAyah = 1;
            try {
                var spans = document.querySelectorAll('.ayah-span');
                for (var i = 0; i < spans.length; i++) {
                    var r = spans[i].getBoundingClientRect();
                    if (r.top >= -100 && r.top <= window.innerHeight) {
                        lastAyah = parseInt(spans[i].dataset.ayah) || 1;
                        break;
                    }
                }
            } catch(e) {}
            logReadingSession(readingStartSurah, elapsed, lastAyah);
        }
        readingStartSurah = 0;
        readingStartTime = 0;
        return _origBackToSurahList();
    };

    // Also log when leaving page
    window.addEventListener('beforeunload', function() {
        if (readingStartSurah && readingStartTime) {
            var elapsed = (Date.now() - readingStartTime) / 1000;
            logReadingSession(readingStartSurah, elapsed, 1);
        }
    });

    // ═══════════════════════════════════════
    // Islamic (Hijri) Calendar
    // ═══════════════════════════════════════
    var hijriCalMonth = 0, hijriCalYear = 0;
    var hijriMonthNamesArr = ['','محرم','صفر','ربيع الأول','ربيع الثاني','جمادى الأولى','جمادى الآخرة','رجب','شعبان','رمضان','شوال','ذو القعدة','ذو الحجة'];

    function initHijriCal() {
        if (currentHijriMonth && currentHijriYear) {
            hijriCalMonth = currentHijriMonth;
            hijriCalYear = currentHijriYear;
        } else {
            hijriCalMonth = 8; hijriCalYear = 1447; // default
        }
        renderHijriCal();
    }
    function navHijriCal(dir) {
        hijriCalMonth += dir;
        if (hijriCalMonth > 12) { hijriCalMonth = 1; hijriCalYear++; }
        if (hijriCalMonth < 1) { hijriCalMonth = 12; hijriCalYear--; }
        renderHijriCal();
    }
    function renderHijriCal() {
        var title = document.getElementById('hijriCalTitle');
        if (title) title.textContent = hijriMonthNamesArr[hijriCalMonth] + ' ' + hijriCalYear + ' هـ';
        var grid = document.getElementById('hijriCalGrid');
        if (!grid) return;
        // Fetch calendar from API
        var lat = userLat || 21.4225, lng = userLng || 39.8262;
        fetch('https://api.aladhan.com/v1/hijriCalendar?month=' + hijriCalMonth + '&year=' + hijriCalYear + '&latitude=' + lat + '&longitude=' + lng + '&method=4')
            .then(function(r) { return r.json(); })
            .then(function(d) {
                if (d.code !== 200 || !d.data) return;
                var dayLabels = ['أحد','إثن','ثلا','أرب','خمي','جمع','سبت'];
                var html = dayLabels.map(function(n) { return '<div class="hijri-cal-day-name">' + n + '</div>'; }).join('');
                // Find first day's weekday
                var first = d.data[0];
                var firstDate = new Date(first.date.gregorian.year + '-' + first.date.gregorian.month.number.toString().padStart(2,'0') + '-' + first.date.gregorian.day.padStart(2,'0'));
                var startDay = firstDate.getDay();
                for (var e = 0; e < startDay; e++) html += '<div class="hijri-cal-day empty"></div>';
                d.data.forEach(function(day) {
                    var dn = parseInt(day.date.hijri.day);
                    var isToday = (dn === currentHijriDay && hijriCalMonth === currentHijriMonth && hijriCalYear === currentHijriYear);
                    html += '<div class="hijri-cal-day' + (isToday ? ' today' : '') + '">' + dn + '</div>';
                });
                grid.innerHTML = html;
            }).catch(function() {
                grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--text-muted);padding:20px">تعذر تحميل التقويم</div>';
            });
    }

    // ═══════════════════════════════════════
    // Hadith of the Day
    // ═══════════════════════════════════════
    var DAILY_HADITHS = [
        {text:'إنَّما الأعمالُ بالنِّيَّاتِ، وإنَّما لكلِّ امْرِئٍ ما نَوَى', ref:'متفق عليه'},
        {text:'مَن كانَ يُؤْمِنُ باللَّهِ والْيَوْمِ الآخِرِ فَلْيَقُلْ خَيْرًا أوْ لِيَصْمُتْ', ref:'متفق عليه'},
        {text:'لا يُؤمِنُ أحَدُكُم حتَّى يُحِبَّ لِأخيهِ ما يُحِبُّ لِنَفسِهِ', ref:'متفق عليه'},
        {text:'مَنْ سَلَكَ طَريقاً يَلتَمِسُ فيهِ عِلماً سَهَّلَ اللهُ لهُ بِهِ طَريقاً إلى الجنَّةِ', ref:'رواه مسلم'},
        {text:'الطُّهورُ شَطْرُ الإيمانِ، والحمدُ للهِ تَمْلأُ الميزانَ', ref:'رواه مسلم'},
        {text:'تَبَسُّمُكَ في وَجْهِ أخيكَ صَدقةٌ', ref:'رواه الترمذي'},
        {text:'خَيرُكُم مَن تَعَلَّمَ القُرآنَ وعَلَّمَهُ', ref:'رواه البخاري'},
        {text:'الدُّعاءُ هُوَ العِبادَةُ', ref:'رواه الترمذي'},
        {text:'إنَّ اللهَ رفيقٌ يُحِبُّ الرِّفقَ في الأمرِ كُلِّهِ', ref:'متفق عليه'},
        {text:'مَن قالَ سُبحانَ اللهِ وبِحَمدِهِ في يومٍ مِائةَ مَرَّةٍ حُطَّت خَطاياهُ وإن كانت مِثلَ زَبَدِ البَحرِ', ref:'متفق عليه'},
        {text:'ما مِن مُسلمٍ يَغرِسُ غَرساً أو يَزرَعُ زَرعاً فيأكُلُ مِنهُ طَيرٌ أو إنسانٌ أو بَهيمةٌ إلَّا كان لهُ بهِ صَدقةٌ', ref:'متفق عليه'},
        {text:'اتَّقِ اللهَ حَيثُما كُنتَ، وأتبِعِ السَّيِّئَةَ الحسَنَةَ تَمحُها، وخالِقِ النَّاسَ بِخُلُقٍ حَسَنٍ', ref:'رواه الترمذي'},
        {text:'مَن صَلَّى عَلَيَّ صَلاةً صَلَّى اللهُ عَليهِ بِها عَشراً', ref:'رواه مسلم'},
        {text:'لا تَحاسَدوا، ولا تَناجَشوا، ولا تَباغَضوا، ولا تَدابَروا، وكونوا عِبادَ اللهِ إخواناً', ref:'رواه مسلم'},
        {text:'الْمُسْلِمُ مَنْ سَلِمَ الْمُسْلِمُونَ مِنْ لِسَانِهِ وَيَدِهِ', ref:'متفق عليه'},
        {text:'إنَّ اللهَ لا يَنظُرُ إلى أجسامِكُم ولا إلى صُوَرِكُم ولكِن يَنظُرُ إلى قُلوبِكُم', ref:'رواه مسلم'},
        {text:'ما نَقَصَت صَدقةٌ مِن مالٍ، وما زادَ اللهُ عَبداً بِعَفوٍ إلَّا عِزّاً', ref:'رواه مسلم'},
        {text:'مَنْ يُرِدِ اللهُ بِهِ خَيْرًا يُفَقِّهْهُ فِي الدِّينِ', ref:'متفق عليه'},
        {text:'أَحَبُّ الأعمالِ إلى اللهِ أدوَمُها وإن قَلَّ', ref:'متفق عليه'},
        {text:'الدُّنيا سِجنُ المُؤمِنِ وجَنَّةُ الكافِرِ', ref:'رواه مسلم'},
        {text:'إذا مات ابنُ آدَمَ انقَطَعَ عَمَلُهُ إلَّا مِن ثَلاثٍ: صَدقةٍ جاريةٍ، أو عِلمٍ يُنتَفَعُ بهِ، أو ولَدٍ صالِحٍ يَدعو لهُ', ref:'رواه مسلم'},
        {text:'بَلِّغُوا عَنِّي ولو آيةً', ref:'رواه البخاري'},
        {text:'مَنْ صامَ رمضانَ إيماناً واحتساباً غُفِرَ لهُ ما تَقدَّمَ مِن ذَنبِهِ', ref:'متفق عليه'},
        {text:'أقرَبُ ما يَكونُ العبدُ مِن رَبِّهِ وهو ساجِدٌ، فأكثِروا الدُّعاءَ', ref:'رواه مسلم'},
        {text:'لَا تَغْضَبْ', ref:'رواه البخاري'},
        {text:'الجنَّةُ تحتَ أقدامِ الأمَّهاتِ', ref:'رواه النسائي'},
        {text:'إنَّ مِنْ أحَبِّكُم إلَيَّ وأقرَبِكُم مِنِّي مَجلِساً يومَ القيامَةِ أحاسِنُكُم أخلاقاً', ref:'رواه الترمذي'},
        {text:'مَثَلُ المُؤمِنينَ في تَوادِّهِم وتَراحُمِهِم كَمَثَلِ الجَسدِ الواحِدِ', ref:'متفق عليه'},
        {text:'اقرَؤوا القُرآنَ فإنَّهُ يَأتي يومَ القِيامةِ شَفيعاً لأصحابِهِ', ref:'رواه مسلم'},
        {text:'كلُّ مَعروفٍ صَدقةٌ', ref:'متفق عليه'}
    ];
    function loadDailyHadith() {
        var textEl = document.getElementById('dailyHadithText');
        var refEl = document.getElementById('dailyHadithRef');
        if (!textEl) return;
        var dayIdx = Math.floor(Date.now() / 86400000) % DAILY_HADITHS.length;
        var h = DAILY_HADITHS[dayIdx];
        textEl.textContent = '«' + h.text + '»';
        if (refEl) refEl.textContent = h.ref;
    }

    // ═══════════════════════════════════════
    // Juz Navigation
    // ═══════════════════════════════════════
    var JUZ_DATA = [
        {n:1,s:1,a:1,es:2,ea:141},{n:2,s:2,a:142,es:2,ea:252},{n:3,s:2,a:253,es:3,ea:92},
        {n:4,s:3,a:93,es:4,ea:23},{n:5,s:4,a:24,es:4,ea:147},{n:6,s:4,a:148,es:5,ea:81},
        {n:7,s:5,a:82,es:6,ea:110},{n:8,s:6,a:111,es:7,ea:87},{n:9,s:7,a:88,es:8,ea:40},
        {n:10,s:8,a:41,es:9,ea:92},{n:11,s:9,a:93,es:11,ea:5},{n:12,s:11,a:6,es:12,ea:52},
        {n:13,s:12,a:53,es:14,ea:52},{n:14,s:15,a:1,es:16,ea:128},{n:15,s:17,a:1,es:18,ea:74},
        {n:16,s:18,a:75,es:20,ea:135},{n:17,s:21,a:1,es:22,ea:78},{n:18,s:23,a:1,es:25,ea:20},
        {n:19,s:25,a:21,es:27,ea:55},{n:20,s:27,a:56,es:29,ea:45},{n:21,s:29,a:46,es:33,ea:30},
        {n:22,s:33,a:31,es:36,ea:27},{n:23,s:36,a:28,es:39,ea:31},{n:24,s:39,a:32,es:41,ea:46},
        {n:25,s:41,a:47,es:45,ea:37},{n:26,s:46,a:1,es:51,ea:30},{n:27,s:51,a:31,es:57,ea:29},
        {n:28,s:58,a:1,es:66,ea:12},{n:29,s:67,a:1,es:77,ea:50},{n:30,s:78,a:1,es:114,ea:6}
    ];
    var juzVisible = false;
    function toggleJuzView() {
        juzVisible = !juzVisible;
        var grid = document.getElementById('juzGrid');
        var surahGrid = document.getElementById('surahGrid');
        if (juzVisible) {
            if (grid) { grid.style.display = 'grid'; renderJuzGrid(); }
            if (surahGrid) surahGrid.style.display = 'none';
        } else {
            if (grid) grid.style.display = 'none';
            if (surahGrid) surahGrid.style.display = '';
        }
    }
    function renderJuzGrid() {
        var grid = document.getElementById('juzGrid');
        if (!grid) return;
        grid.innerHTML = JUZ_DATA.map(function(j) {
            var startName = SURAH_DATA.find(function(s) { return s.n === j.s; });
            var endName = SURAH_DATA.find(function(s) { return s.n === j.es; });
            return '<div class="juz-card" onclick="openJuz(' + j.n + ')">'
                + '<div class="juz-card-num">الجزء ' + j.n + '</div>'
                + '<div class="juz-card-range">' + (startName ? startName.name : j.s) + ' → ' + (endName ? endName.name : j.es) + '</div>'
                + '</div>';
        }).join('');
    }
    function openJuz(n) {
        var j = JUZ_DATA.find(function(x) { return x.n === n; });
        if (j) openSurah(j.s, j.a);
    }

    // ═══════════════════════════════════════
    // Quran Text Search
    // ═══════════════════════════════════════
    var searchTimer = null;
    function onQuranSearch() {
        clearTimeout(searchTimer);
        var q = (document.getElementById('surahSearch').value || '').trim();
        var resultsDiv = document.getElementById('quranSearchResults');
        var surahGrid = document.getElementById('surahGrid');
        // If short query, treat as surah filter
        if (q.length < 3) {
            if (resultsDiv) resultsDiv.style.display = 'none';
            if (surahGrid) surahGrid.style.display = '';
            renderSurahGrid2();
            return;
        }
        // Check if it matches a surah name/number
        var matchesSurah = SURAH_DATA.some(function(s) {
            return s.name.includes(q) || s.en.toLowerCase().includes(q.toLowerCase()) || String(s.n) === q;
        });
        if (matchesSurah) {
            if (resultsDiv) resultsDiv.style.display = 'none';
            if (surahGrid) surahGrid.style.display = '';
            renderSurahGrid2();
            return;
        }
        // Full text search across cached surahs
        searchTimer = setTimeout(function() { searchQuranText(q); }, 300);
    }
    function searchQuranText(query) {
        var resultsDiv = document.getElementById('quranSearchResults');
        var surahGrid = document.getElementById('surahGrid');
        if (!resultsDiv) return;
        resultsDiv.style.display = 'block';
        if (surahGrid) surahGrid.style.display = 'none';
        resultsDiv.innerHTML = '<div style="text-align:center;padding:20px;color:var(--text-muted)">جاري البحث...</div>';
        var results = [];
        for (var i = 1; i <= 114; i++) {
            try {
                var cached = localStorage.getItem('quran-surah-' + i);
                if (!cached) continue;
                var ayahs = JSON.parse(cached);
                ayahs.forEach(function(a) {
                    if (a.text.includes(query)) {
                        var surahInfo = SURAH_DATA.find(function(s) { return s.n === i; });
                        results.push({surah: i, ayah: a.numberInSurah, name: surahInfo ? surahInfo.name : i, text: a.text});
                    }
                });
            } catch(e) {}
        }
        if (results.length === 0) {
            resultsDiv.innerHTML = '<div style="text-align:center;padding:30px;color:var(--text-muted)">لا توجد نتائج. تأكد من تحميل السور للقراءة بدون إنترنت أولاً.</div>';
            return;
        }
        var html = '<div style="padding:10px;color:var(--text-muted);font-size:0.95em">' + results.length + ' نتيجة</div>';
        results.slice(0, 50).forEach(function(r) {
            var highlighted = r.text.replace(new RegExp('(' + query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ')', 'g'), '<mark>$1</mark>');
            html += '<div class="qsr-item" onclick="openSurah(' + r.surah + ',' + r.ayah + ')">'
                + '<div class="qsr-ref">سورة ' + r.name + ' - آية ' + r.ayah + '</div>'
                + '<div class="qsr-text">' + highlighted + '</div></div>';
        });
        if (results.length > 50) html += '<div style="text-align:center;padding:15px;color:var(--text-muted)">عرض أول 50 نتيجة من ' + results.length + '</div>';
        resultsDiv.innerHTML = html;
    }

    // Initialize home on load
    initHome();
    loadDailyHadith();

    // Handle URL hash shortcuts
    (function handleHash() {
        var h = window.location.hash.replace('#','');
        if (h === 'quran') switchTab('tab7', document.querySelectorAll('.tab-btn')[3]);
        else if (h === 'athkar') switchTab('tabAthkar', document.querySelectorAll('.tab-btn')[1]);
        else if (h === 'prayer') { switchTab('tabTools', document.querySelectorAll('.tab-btn')[4]); }
        else if (h === 'tasbeeh') { switchTab('tabTools', document.querySelectorAll('.tab-btn')[4]); setTimeout(function(){ switchSub('tabTools','tools-tasbeeh',null); }, 100); }
        else if (h === 'hifz') { switchTab('tabTools', document.querySelectorAll('.tab-btn')[4]); setTimeout(function(){ switchSub('tabTools','tools-hifz',null); renderHifz(); }, 100); }
        else if (h === 'history') { switchTab('tabTools', document.querySelectorAll('.tab-btn')[4]); setTimeout(function(){ switchSub('tabTools','tools-history',null); renderReadingHistory(); }, 100); }
    })();

    // Auto-sync all Quran surahs in background on first visit
    (function autoSyncSurahs() {
        var cached = 0;
        for (var i = 1; i <= 114; i++) {
            if (localStorage.getItem('quran-surah-' + i)) cached++;
        }
        if (cached >= 114) return; // Already fully cached
        // Delay to not compete with initial page load
        setTimeout(async function() {
            for (var i = 1; i <= 114; i++) {
                if (localStorage.getItem('quran-surah-' + i)) continue;
                try { await fetchSurah(i); } catch(e) {}
                await new Promise(function(r) { setTimeout(r, 100); });
            }
            checkOfflineStatus();
        }, 3000);
    })();
</script>

<script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js');
    }
</script>

</body>
</html>
